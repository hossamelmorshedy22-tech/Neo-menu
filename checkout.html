<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>إتمام الطلب - NEO CAFÉ</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --neo-green: #124d33;
  --neo-green-2: #2f6b46;
  --neo-beige: #f6efe6;
  --muted: #6b6b6b;
  --card-radius: 12px;
  --shadow: 0 12px 30px rgba(15,40,25,0.06);
  --accent: #ffd54a;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;padding:0;background:var(--neo-beige);font-family:"Cairo",sans-serif;color:#111}
.container{max-width:760px;margin:12px auto;padding:14px;background:#fff;border-radius:var(--card-radius);box-shadow:var(--shadow);overflow:hidden}
h2{margin:0 0 12px;color:var(--neo-green);font-weight:900;text-align:right}
.field{margin-bottom:12px}
label{display:block;margin-bottom:8px;font-weight:800;text-align:right}
input[type="text"],input[type="tel"],select,textarea{
  width:100%;
  padding:12px 14px;
  border-radius:10px;
  border:1px solid #eee;
  font-size:15px;
  background:#fff;
  color:#111;
  outline:none;
  box-shadow:none;
}
input[type="text"]:focus,input[type="tel"]:focus,select:focus,textarea:focus{border-color:rgba(18,77,51,0.14);box-shadow:0 6px 18px rgba(18,77,51,0.06)}
.row{display:flex;gap:8px;align-items:center}
.row .col{flex:1}
.small-select{width:49%}
.phone-wrap{display:flex;gap:8px;align-items:center}
.phone-wrap .phone-icon{
  width:40px;height:40px;border-radius:10px;background:var(--neo-green);display:flex;align-items:center;justify-content:center;color:#fff;cursor:pointer;flex:0 0 40px;border:2px solid rgba(255,255,255,0.06);
  box-shadow:0 8px 20px rgba(18,77,51,0.12)
}
.btn{background:var(--neo-green);color:#fff;padding:12px 14px;border-radius:10px;border:0;font-weight:900;cursor:pointer}
.btn-secondary{background:#888;color:#fff;padding:12px 14px;border-radius:10px;border:0;font-weight:900;cursor:pointer}

/* order */
.order-summary{margin-top:10px;border-top:1px dashed #eee;padding-top:12px}
.item-line{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid #fafafa;font-weight:700}
.total{display:flex;justify-content:space-between;font-weight:900;color:var(--neo-green);padding-top:8px}
.note{margin-top:8px;color:var(--muted);font-size:14px}

/* modal for loyalty info */
.modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.45);display:none;align-items:center;justify-content:center;z-index:9999;padding:20px}
.modal-backdrop.show{display:flex}
.modal-card{width:100%;max-width:720px;background:#fff;border-radius:12px;padding:16px;box-shadow:0 24px 70px rgba(0,0,0,0.25);direction:rtl}
.modal-card h3{margin:0 0 10px;color:var(--neo-green);font-weight:900}
.modal-card p{margin:0;color:#222;line-height:1.6;white-space:pre-wrap}

/* responsive */
@media (max-width:520px){
  .container{margin:8px;padding:12px}
  .small-select{width:48%}
  .phone-wrap .phone-icon{width:40px;height:40px}
  .modal-card{padding:14px}
}
</style>
</head>
<body>

<div class="container" role="main">
  <h2>إتمام الطلب — Neo Café</h2>

  <div class="field">
    <label for="nickname">اسم الشهرة</label>
    <input id="nickname" type="text" placeholder="اكتب اسم الشهرة">
  </div>

  <div class="field">
    <label>تاريخ الميلاد</label>
    <div class="row">
      <select id="birth-day" class="small-select" aria-label="اليوم">
        <option value="">اليوم</option>
      </select>
      <select id="birth-month" class="small-select" aria-label="الشهر">
        <option value="">الشهر</option>
      </select>
    </div>
    <div style="font-size:13px;color:var(--muted);margin-top:6px;text-align:right">نختار اليوم والشهر فقط للاحتفالات والعروض</div>
  </div>

  <div class="field">
    <label for="table-number">رقم الطاولة</label>
    <select id="table-number">
      <option value="">اختر رقم الطاولة</option>
    </select>
  </div>

  <div class="field">
    <label for="phone">رقم الهاتف (مهم لنظام الولاء)</label>
    <div class="phone-wrap">
      <input id="phone" type="tel" placeholder="010xxxxxxxx" inputmode="tel" pattern="[0-9]*" aria-describedby="phoneHelp">
      <div class="phone-icon" id="phoneInfoBtn" title="معلومات نظام الولاء">
        <!-- simple i icon -->
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" style="display:block" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z" fill="#fff"/>
          <path d="M11 10h2v6h-2v-6zm0-4h2v2h-2V6z" fill="#124d33"/>
        </svg>
      </div>
    </div>
    <div id="phoneHelp" style="font-size:13px;color:var(--muted);margin-top:6px;text-align:right">لمزيد من التفاصيل اضغط على أيقونة المعلومات.</div>
  </div>

  <div class="field">
    <label for="notes">ملاحظات إضافية (اختياري)</label>
    <textarea id="notes" rows="3" placeholder="ملاحظات..."></textarea>
  </div>

  <div class="order-summary" aria-live="polite">
    <div style="font-weight:900;margin-bottom:8px;text-align:right">السلة</div>
    <div id="itemsList" style="min-height:40px;color:var(--muted);text-align:right">جاري جلب محتويات السلة...</div>

    <div class="total" style="margin-top:8px">
      <div>الإجمالي</div>
      <div id="grandTotal">0 ج</div>
    </div>

    <div class="note" id="loyaltyNote" style="text-align:right"></div>
  </div>

  <div style="margin-top:14px;display:flex;gap:8px;justify-content:flex-end">
    <button id="sendBtn" class="btn">إرسال الطلب عبر واتساب للمحل</button>
    <button id="backBtn" class="btn-secondary">العودة للمنيو</button>
  </div>

  <div class="note" style="text-align:right;margin-top:8px">سيتم فتح واتساب على رقم المحل لإكمال الطلب. تأكد من كتابة رقم الهاتف بشكل صحيح.</div>
</div>

<!-- modal -->
<div id="modalBackdrop" class="modal-backdrop" role="dialog" aria-modal="true" aria-hidden="true">
  <div class="modal-card" role="document">
    <h3>نظام الولاء - نيو كافية</h3>
    <p id="loyaltyText"></p>
    <div style="text-align:left;margin-top:12px">
      <button id="closeModal" class="btn" style="background:var(--neo-green);padding:10px 14px;border-radius:8px">حسناً</button>
    </div>
  </div>
</div>

<script>
/* ====== إعداد الحقول (يوم/شهر) ورقم الطاولة ====== */
const dayEl = document.getElementById('birth-day');
const monthEl = document.getElementById('birth-month');
const tableEl = document.getElementById('table-number');
for(let d=1; d<=31; d++){ const o = document.createElement('option'); o.value = d; o.textContent = d; dayEl.appendChild(o); }
const monthNames = ['1','2','3','4','5','6','7','8','9','10','11','12'];
for(let i=0;i<12;i++){ const o = document.createElement('option'); o.value = i+1; o.textContent = (i+1); monthEl.appendChild(o); }
for(let t=1; t<=10; t++){ const o = document.createElement('option'); o.value = t; o.textContent = t; tableEl.appendChild(o); }

/* ====== نص نظام الولاء كما طلبته بالضبط ====== */
const LOYALTY_TEXT = `عشان احنا بنحبكم وبنقدر كل عملاء نيو كافيه المخلصين ، فقررنا كل ما قعدتوا عندنا اكتر كل ماكان ليكم حق في انك تشاركونا النجاح ده فخلال الوقت وعلي مدار قعدتكم لماتعدي اجمالي طلباتكم الف جنيه هايكون ليكم مشروب مجاني من اختياركم ايَا كان ، فاحنا مهتمين تكتبوا ارقامكم صح عشان نقدر نتابع وكل ماتطلب اكتر لازم تبقي مميز عندنا اكتر .. شكرًا علي اختياركم نيو كافيه`;

/* modal handlers */
const modalBackdrop = document.getElementById('modalBackdrop');
const phoneInfoBtn = document.getElementById('phoneInfoBtn');
const closeModal = document.getElementById('closeModal');
const loyaltyTextEl = document.getElementById('loyaltyText');
loyaltyTextEl.textContent = LOYALTY_TEXT;
phoneInfoBtn.addEventListener('click', ()=> {
  modalBackdrop.classList.add('show');
  modalBackdrop.setAttribute('aria-hidden','false');
});
closeModal.addEventListener('click', ()=> {
  modalBackdrop.classList.remove('show');
  modalBackdrop.setAttribute('aria-hidden','true');
});
modalBackdrop.addEventListener('click', (e)=>{
  if(e.target === modalBackdrop){ modalBackdrop.classList.remove('show'); modalBackdrop.setAttribute('aria-hidden','true'); }
});

/* ====== cart & render logic (يتطابق مع index.html key) ====== */
const CART_KEY = 'neoCafe_cart_v1';
const SHOP_PHONE_WA = '201034311119'; // رقم المحل

function loadCart(){ try{ const d = localStorage.getItem(CART_KEY); return d ? JSON.parse(d) : []; } catch(e){ return []; } }
function calcTotals(cart){ let total=0; cart.forEach(i=> total += (Number(i.price)||0)*(Number(i.qty)||0)); return total; }

/* render cart */
const itemsList = document.getElementById('itemsList');
const grandTotalEl = document.getElementById('grandTotal');
const loyaltyNote = document.getElementById('loyaltyNote');

function renderCartOnCheckout(){
  const cart = loadCart();
  itemsList.innerHTML = '';
  if(!cart || cart.length===0){
    itemsList.innerHTML = '<div style="color:var(--muted);text-align:right">السلة فارغة — اذهب للمنيو لإضافة طلبات</div>';
    grandTotalEl.textContent = '0 ج';
    loyaltyNote.textContent = '';
    return;
  }
  cart.forEach((it, idx)=>{
    const div = document.createElement('div');
    div.className = 'item-line';
    div.innerHTML = `<div style="text-align:right">${idx+1}. ${it.name} × ${it.qty}</div><div style="text-align:left">${it.price*it.qty} ج</div>`;
    itemsList.appendChild(div);
  });
  const total = calcTotals(cart);
  grandTotalEl.textContent = total + ' ج';

  const threshold = 1000;
  if(total >= threshold){
    loyaltyNote.textContent = `مبروك! وصلت لـ ${threshold} ج أو أكثر — تستحق مشروب مجاني.`;
  } else {
    const remain = threshold - total;
    loyaltyNote.textContent = `متبقي ${remain} ج لتحصل على مشروب مجاني (نظام الولاء عند 1000 ج).`;
  }
}

/* init render */
renderCartOnCheckout();

/* send via wa.me (كما اتفقنا سابقاً) */
document.getElementById('sendBtn').addEventListener('click', ()=>{
  const nickname = document.getElementById('nickname').value.trim() || '-';
  const day = document.getElementById('birth-day').value || '-';
  const month = document.getElementById('birth-month').value || '-';
  const table = document.getElementById('table-number').value || '-';
  const phone = document.getElementById('phone').value.trim() || '-';
  const notes = document.getElementById('notes').value.trim() || '-';
  const cart = loadCart();
  if(!cart || cart.length===0){ alert('السلة فارغة'); return; }

  let msg = `طلب من Neo Café\nاسم الشهرة: ${nickname}\nتاريخ الميلاد: ${day}/${month}\nرقم الطاولة: ${table}\nالهاتف: ${phone}\n\nالسلة:\n`;
  cart.forEach((it,idx)=> msg += `${idx+1}. ${it.name} × ${it.qty} = ${it.price*it.qty} ج\n`);
  const total = calcTotals(cart);
  msg += `\nالإجمالي: ${total} ج\nملاحظات: ${notes}\n`;
  const threshold = 1000;
  let remain = threshold - total; if(remain < 0) remain = 0;
  msg += `\nالمبلغ المتبقي لنيل مشروب مجاني: ${remain} ج\n`;
  const encoded = encodeURIComponent(msg);
  window.open(`https://wa.me/${SHOP_PHONE_WA}?text=${encoded}`, '_blank');
});

/* back */
document.getElementById('backBtn').addEventListener('click', ()=> window.location.href = 'index.html');
</script>

</body>
</html>
