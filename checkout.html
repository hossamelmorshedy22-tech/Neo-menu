<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ â€” NEO CAFÃ‰</title>

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">

<style>
:root{
  --neo-green:#124d33;
  --neo-green-2:#2f6b46;
  --neo-beige:#f6efe6;
  --neo-cream:#f7ead6;
  --muted:#6b6b6b;
}
*{box-sizing:border-box}
html,body{margin:0;padding:0;height:100%;font-family:"Cairo",sans-serif;background:var(--neo-beige);color:#111}
.container{max-width:760px;margin:10px auto;padding:14px}
.header{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:6px}
.header h1{margin:0;color:var(--neo-green);font-size:20px;font-weight:800}
.logo-small{width:68px;height:auto}
.card{background:#fff;border-radius:12px;padding:12px;box-shadow:0 10px 30px rgba(15,40,25,0.06);margin-bottom:12px}
.label{font-weight:800;color:var(--neo-green-2);margin-bottom:8px}
.input, select{width:100%;padding:12px;border-radius:10px;border:1px solid #eee;font-size:15px}
.row{display:flex;gap:8px;align-items:center}
.row .col{flex:1}
.hrow{display:flex;gap:8px;align-items:center;flex-wrap:nowrap}
.hrow select{flex:1}
.small{font-size:13px;color:var(--muted);margin-top:6px}

/* cart items list */
.items-list{display:flex;flex-direction:column;gap:10px}
.item{display:flex;align-items:center;gap:10px;justify-content:space-between}
.item .left{display:flex;gap:10px;align-items:center}
.item .name{font-weight:800}
.item .qty{background:#f6f6f6;padding:6px 8px;border-radius:8px}

/* totals */
.totals{display:flex;justify-content:space-between;align-items:center;margin-top:10px;font-weight:900;color:var(--neo-green);font-size:17px}

/* submit */
.actions{display:flex;gap:8px;flex-direction:column;margin-top:12px}
.btn{padding:12px;border-radius:12px;border:0;font-weight:900;cursor:pointer}
.btn-primary{background:var(--neo-green);color:#fff}
.btn-outline{background:#fff;border:1px solid #eee;color:#444}

/* responsive: make selects horizontal on mobile */
.birth-row{display:flex;gap:8px;align-items:center}
.birth-row select{flex:1;padding:10px;border-radius:10px;border:1px solid #eee}

/* note */
.note{margin-top:10px;background:#fff3d9;padding:12px;border-radius:10px;border:1px solid #f0d9b7;color:#6b4b2d}

/* small screens adjustments */
@media (max-width:420px){
  .header h1{font-size:18px}
  .logo-small{width:58px}
  .birth-row{flex-direction:row}
  .item .name{font-size:15px}
}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ â€” Neo CafÃ©</h1>
    <img src="assets/images/logo.png" alt="NEO Logo" class="logo-small" onerror="this.style.display='none'">
  </div>

  <!-- Customer info -->
  <div class="card">
    <div class="label">Ø§Ø³Ù… Ø§Ù„Ø´Ù‡Ø±Ø©</div>
    <input id="nickname" class="input" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ø´Ù‡Ø±Ø© ">

    <div style="height:8px"></div>

    <div class="label">ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯</div>
    <div class="birth-row" style="margin-bottom:6px;">
      <select id="day" aria-label="ÙŠÙˆÙ…">
        <option value="">Ø§Ù„ÙŠÙˆÙ…</option>
      </select>
      <select id="month" aria-label="Ø´Ù‡Ø±">
        <option value="">Ø§Ù„Ø´Ù‡Ø±</option>
      </select>
      <select id="year" aria-label="Ø³Ù†Ø©">
        <option value="">Ø§Ù„Ø³Ù†Ø©</option>
      </select>
    </div>

    <div class="label" style="margin-top:10px">Ø±Ù‚Ù… Ø§Ù„Ø·Ø§ÙˆÙ„Ø©</div>
    <input id="tableNumber" class="input" placeholder="Ø§Ø®ØªØ± Ø±Ù‚Ù… Ø§Ù„Ø·Ø§ÙˆÙ„Ø©">

    <div style="height:8px"></div>

    <div class="label">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (Ù…Ù‡Ù… Ù„Ù†Ø¸Ø§Ù… Ø§Ù„ÙˆÙ„Ø§Ø¡)</div>
    <input id="phone" class="input" placeholder="010xxxxxxxx - Ø§ÙƒØªØ¨ Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„">
    <div class="small">Ø¨Ø±Ø¬Ø§Ø¡ ÙƒØªØ§Ø¨Ø© Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ (Ù…Ø«Ø§Ù„: 01012345678)</div>
  </div>

  <!-- Cart preview -->
  <div class="card">
    <div class="label">Ø§Ù„Ø³Ù„Ø©</div>
    <div id="items" class="items-list"></div>

    <div class="totals">
      <div>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</div>
      <div id="totalAmount">0 Ø¬</div>
    </div>

    <div class="note" id="loyaltyNote">
      Ù†Ø¸Ø§Ù… Ø§Ù„ÙˆÙ„Ø§Ø¡: ÙƒÙ„ Ù…Ø±Ø© ØªØ·Ù„Ø¨ ÙÙŠÙ‡Ø§ Ù…Ù† Ù†ÙŠÙˆ ÙƒØ§ÙÙŠØ© ÙˆØªØ­Ø· Ø±Ù‚Ù… Ù…ÙˆØ¨Ø§ÙŠÙ„ÙƒØŒ Ø¨Ø¹Ø¯ Ø¬Ù…Ø¹ 1000 Ø¬ ØªØ­ØµÙ„ Ø¹Ù„Ù‰ Ù…Ø´Ø±ÙˆØ¨ Ù…Ø¬Ø§Ù†ÙŠ. Ø³ÙŠØªÙ… Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ù„Ùƒ Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø´Ø±ÙˆØ¨ Ø¨Ø¹Ø¯ Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨.
    </div>
  </div>

  <!-- Notes -->
  <div class="card">
    <div class="label">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</div>
    <textarea id="notes" class="input" placeholder="Ù…Ø«Ø§Ù„: Ù…Ù† ÙØ¶Ù„Ùƒ Ø¨Ø¯ÙˆÙ† Ø³ÙƒØ±"></textarea>
  </div>

  <!-- actions -->
  <div class="actions">
    <button id="sendBtn" class="btn btn-primary">Ø£Ø±Ø³Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨</button>
    <button id="clearBtn" class="btn btn-outline">ØªÙØ±ÙŠØº Ø§Ù„Ø³Ù„Ø©</button>
  </div>
</div>

<script>
/* ====== checkout.js embedded ====== */

/* config */
const CART_KEY = 'neoCafe_cart_v1';
const LOYALTY_TARGET = 1000; // Ø¬Ù†ÙŠÙ‡

/* populate day/month/year selects */
const dayEl = document.getElementById('day');
const monthEl = document.getElementById('month');
const yearEl = document.getElementById('year');

for(let d=1; d<=31; d++){
  const o = document.createElement('option'); o.value = d; o.textContent = d; dayEl.appendChild(o);
}
const months = ['ÙŠÙ†Ø§ÙŠØ±','ÙØ¨Ø±Ø§ÙŠØ±','Ù…Ø§Ø±Ø³','Ø£Ø¨Ø±ÙŠÙ„','Ù…Ø§ÙŠÙˆ','ÙŠÙˆÙ†ÙŠÙˆ','ÙŠÙˆÙ„ÙŠÙˆ','Ø£ØºØ³Ø·Ø³','Ø³Ø¨ØªÙ…Ø¨Ø±','Ø£ÙƒØªÙˆØ¨Ø±','Ù†ÙˆÙÙ…Ø¨Ø±','Ø¯ÙŠØ³Ù…Ø¨Ø±'];
for(let m=0; m<12; m++){
  const o = document.createElement('option'); o.value = m+1; o.textContent = months[m]; monthEl.appendChild(o);
}
/* years from 1960 to current year */
const currentYear = new Date().getFullYear();
for(let y=currentYear; y>=1960; y--){
  const o = document.createElement('option'); o.value = y; o.textContent = y; yearEl.appendChild(o);
}

/* load cart from localStorage */
function loadCart(){
  try{
    const d = localStorage.getItem(CART_KEY);
    return d ? JSON.parse(d) : [];
  }catch(e){ return []; }
}

/* render items */
const itemsContainer = document.getElementById('items');
const totalAmountEl = document.getElementById('totalAmount');
function renderCart(){
  const cart = loadCart();
  itemsContainer.innerHTML = '';
  if(!cart || cart.length === 0){
    const p = document.createElement('div');
    p.textContent = 'Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©';
    p.style.color = '#888';
    itemsContainer.appendChild(p);
    totalAmountEl.textContent = '0 Ø¬';
    return;
  }
  let total = 0;
  cart.forEach(it=>{
    const row = document.createElement('div');
    row.className = 'item';
    row.innerHTML = `
      <div class="left">
        <div>
          <div class="name">${it.name}</div>
          <div class="small">${it.price} Ø¬ Ù„ÙƒÙ„ ÙˆØ­Ø¯Ø©</div>
        </div>
      </div>
      <div style="display:flex;flex-direction:column;align-items:flex-end">
        <div class="qty">${it.qty} Ã—</div>
        <div style="font-weight:900;color:var(--neo-green)">${it.price*it.qty} Ø¬</div>
      </div>
    `;
    itemsContainer.appendChild(row);
    total += (Number(it.price)||0) * (Number(it.qty)||0);
  });
  totalAmountEl.textContent = `${total} Ø¬`;
  updateLoyaltyNote(total);
}

/* loyalty note update */
const loyaltyNote = document.getElementById('loyaltyNote');
function updateLoyaltyNote(total){
  const remaining = Math.max(0, LOYALTY_TARGET - Number(total || 0));
  if(remaining <= 0){
    loyaltyNote.textContent = `Ù…Ø¨Ø±ÙˆÙƒ! Ø¨Ø¹Ø¯ Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ Ø£ØµØ¨Ø­Øª Ù…Ø¤Ù‡Ù„Ù‹Ø§ Ù„Ù…Ø´Ø±ÙˆØ¨ Ù…Ø¬Ø§Ù†ÙŠ.`;
  } else {
    loyaltyNote.textContent = `Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…Ø´Ø±ÙˆØ¨ Ù…Ø¬Ø§Ù†ÙŠ: ${remaining} Ø¬`;
  }
}

/* clear cart button */
document.getElementById('clearBtn').addEventListener('click', ()=>{
  if(!confirm('ØªÙØ±ÙŠØº Ø§Ù„Ø³Ù„Ø©ØŸ')) return;
  localStorage.removeItem(CART_KEY);
  renderCart();
});

/* build whatsapp message:
   - orderSummary (multi-line)
   - then ONE loyalty line only (remaining or congrats)
   Per user request: only one loyalty-related line appears.
*/
function buildWhatsAppMessage({nickname, day, month, year, table, phone, notes}) {
  const cart = loadCart();
  let total = 0;
  let summary = `Ø·Ù„Ø¨ Ù…Ù† Neo CafÃ©\n`;
  summary += `Ø§Ø³Ù… Ø§Ù„Ø´Ù‡Ø±Ø©: ${nickname || '-'}\n`;
  // birth:
  if(day && month && year){
    summary += `ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯: ${day}/${month}/${year}\n`;
  }
  if(table) summary += `Ø±Ù‚Ù… Ø§Ù„Ø·Ø§ÙˆÙ„Ø©: ${table}\n`;
  if(phone) summary += `Ø§Ù„Ù‡Ø§ØªÙ: ${phone}\n`;
  summary += `---------------------\n`;
  if(!cart || cart.length===0){
    summary += 'Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©\n';
  } else {
    cart.forEach((it, idx)=>{
      const qty = Number(it.qty)||1;
      const lineTotal = (Number(it.price)||0) * qty;
      summary += `${idx+1}. ${it.name} Ã— ${qty} = ${lineTotal} Ø¬\n`;
      total += lineTotal;
    });
    summary += `---------------------\n`;
    summary += `Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${total} Ø¬\n`;
  }

  // loyalty single-line
  const remaining = Math.max(0, LOYALTY_TARGET - total);
  let loyaltyLine = '';
  if(remaining <= 0){
    loyaltyLine = `Ù…Ø¨Ø±ÙˆÙƒ! Ø£Ù†Øª Ù…Ø¤Ù‡Ù„ Ù„Ù…Ø´Ø±ÙˆØ¨ Ù…Ø¬Ø§Ù†ÙŠ Ù…Ù† Ø§Ø®ØªÙŠØ§Ø±Ùƒ ğŸ‰`;
  } else {
    loyaltyLine = `ØªØ¨Ù‚Ù‰ Ù„Ùƒ ${remaining} Ø¬ Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…Ø´Ø±ÙˆØ¨ Ù…Ø¬Ø§Ù†ÙŠ.`;
  }

  // append notes if present (optional small)
  if(notes && String(notes).trim().length>0){
    summary += `Ù…Ù„Ø§Ø­Ø¸Ø§Øª: ${notes}\n`;
  }

  // final message: order summary + loyalty single line (as requested)
  const finalMessage = `${summary}\n${loyaltyLine}`;
  return { text: finalMessage, total, remaining };
}

/* phone cleaning */
function cleanPhone(input){
  return String(input || '').trim().replace(/\D+/g,'');
}

/* send via whatsapp */
function sendViaWhatsApp(phone, text){
  // If phone absent, open generic WA web with the message
  const encoded = encodeURIComponent(text);
  if(!phone){
    window.open(`https://api.whatsapp.com/send?text=${encoded}`, '_blank');
    return;
  }
  const clean = cleanPhone(phone);
  // ensure starts with country code (if Egypt and user typed 010... convert to 2010...)
  let used = clean;
  if(clean.length === 11 && clean.startsWith('01')) {
    // assume Egyptian local -> add country code 20
    used = '20' + clean;
  }
  window.open(`https://wa.me/${used}?text=${encoded}`, '_blank');
}

/* form submit */
document.getElementById('sendBtn').addEventListener('click', ()=>{
  const nickname = document.getElementById('nickname').value.trim();
  const day = document.getElementById('day').value;
  const month = document.getElementById('month').value;
  const year = document.getElementById('year').value;
  const table = document.getElementById('tableNumber').value.trim();
  const phone = document.getElementById('phone').value.trim();
  const notes = document.getElementById('notes').value.trim();

  // basic validation: phone & cart
  const cart = loadCart();
  if(!cart || cart.length === 0){
    alert('Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ© â€” Ø£Ø¶Ù Ù…Ù†ØªØ¬Ø§Øª Ù…Ù† Ø§Ù„Ù…Ù†ÙŠÙˆ Ø£ÙˆÙ„Ø§Ù‹');
    return;
  }
  if(!phone){
    if(!confirm('Ù„Ù… ØªØ¯Ø®Ù„ Ø±Ù‚Ù… Ù‡Ø§ØªÙ â€” Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø± Ø¨Ø¯ÙˆÙ† Ø±Ù‚Ù…ØŸ')) {
      return;
    }
  }

  // build message
  const { text, total, remaining } = buildWhatsAppMessage({nickname, day, month, year, table, phone, notes});

  // Optional: show confirm summary to the user (small)
  const confirmMsg = `Ø³ÙŠØªÙ… ÙØªØ­ ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨. Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${total} Ø¬\n${remaining>0?('ØªØ¨Ù‚Ù‰ '+remaining+' Ø¬ Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…Ø´Ø±ÙˆØ¨ Ù…Ø¬Ø§Ù†ÙŠ'):'Ø£Ù†Øª Ù…Ø¤Ù‡Ù„ Ù„Ù…Ø´Ø±ÙˆØ¨ Ù…Ø¬Ø§Ù†ÙŠ'}`;
  if(!confirm(confirmMsg + '\n\nÙ‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø±ØŸ')) return;

  // open whatsapp
  sendViaWhatsApp(phone, text);

  // Optional: after sending, you may clear cart:
  // localStorage.removeItem(CART_KEY);
  // renderCart();

});

/* initial render */
renderCart();
</script>
</body>
</html>
