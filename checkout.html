<!doctype html>
<html lang="ar">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ â€” Neo CafÃ©</title>
<style>
  :root{
    --bg:#f7f7f7;
    --card:#fff;
    --accent:#125433;
    --muted:#666;
    --radius:12px;
    --shadow: 0 8px 28px rgba(0,0,0,0.06);
  }
  *{box-sizing:border-box}
  body{margin:0;font-family: "Cairo", "Segoe UI", Tahoma, Arial;direction:rtl;background:var(--bg);color:#111;padding:18px}
  .wrap{max-width:720px;margin:12px auto}
  .card{background:var(--card);border-radius:var(--radius);padding:20px;box-shadow:var(--shadow)}
  h1{margin:0 0 8px;font-size:22px;color:var(--accent)}
  label{display:block;font-weight:700;margin:12px 0 6px}
  .input, select, textarea{
    width:100%;padding:12px;border-radius:10px;border:1px solid #e6e6e6;font-size:15px;background:#fff;
  }
  textarea{min-height:120px;resize:vertical}
  .row{display:flex;gap:12px;align-items:center}
  .date-row{display:flex;gap:12px;align-items:center;margin-top:6px}
  .date-row .col{flex:1;min-width:0}
  .date-row select{width:100%}
  @media(max-width:420px){
    .date-row{gap:8px}
    .date-row .col{min-width:90px}
  }
  .actions{display:flex;gap:12px;align-items:center;justify-content:flex-start;margin-top:16px;flex-wrap:wrap}
  .btn{background:var(--accent);color:#fff;border:0;padding:12px 16px;border-radius:10px;cursor:pointer;font-weight:700}
  .btn.ghost{background:#fff;border:1px solid #ddd;color:#333}
  .note{background:#fff6e8;border-left:4px solid #f3d5a6;padding:10px;border-radius:8px;margin-top:12px;color:#5a4b2a}
  .small{font-size:13px;color:var(--muted);margin-top:8px}
  @media(max-width:600px){
    .row{flex-direction:column;align-items:stretch}
    .actions{justify-content:stretch}
  }
</style>
</head>
<body>
  <div class="wrap">
    <div class="card" role="form" aria-labelledby="formTitle">
      <h1 id="formTitle">Neo CafÃ© â€” Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨</h1>

      <!-- Ø§Ø³Ù… Ø§Ù„Ø´Ù‡Ø±Ø© -->
      <label for="nickname">Ø§Ø³Ù… Ø§Ù„Ø´Ù‡Ø±Ù‡</label>
      <input id="nickname" class="input" type="text" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ø´Ù‡Ø±Ø© Ø§Ù„Ù„ÙŠ ØªØ­Ø¨ ÙŠØ¸Ù‡ÙØ±" autocomplete="nickname">

      <!-- ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ -->
      <label for="birth">ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯</label>
      <div class="date-row" aria-labelledby="birth">
        <div class="col">
          <label class="sr-only" for="birth-day">Ø§Ù„ÙŠÙˆÙ…</label>
          <select id="birth-day" aria-label="ÙŠÙˆÙ… Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯">
            <option value="">Ø§Ù„ÙŠÙˆÙ…</option>
          </select>
        </div>
        <div class="col">
          <label class="sr-only" for="birth-month">Ø§Ù„Ø´Ù‡Ø±</label>
          <select id="birth-month" aria-label="Ø´Ù‡Ø± Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯">
            <option value="">Ø§Ù„Ø´Ù‡Ø±</option>
          </select>
        </div>
        <div class="col">
          <label class="sr-only" for="birth-year">Ø§Ù„Ø³Ù†Ø©</label>
          <select id="birth-year" aria-label="Ø³Ù†Ø© Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯">
            <option value="">Ø§Ù„Ø³Ù†Ø©</option>
          </select>
        </div>
      </div>

      <!-- Ø±Ù‚Ù… Ø§Ù„Ø·Ø§ÙˆÙ„Ø© -->
      <label for="table">Ø±Ù‚Ù… Ø§Ù„Ø·Ø§ÙˆÙ„Ø©</label>
      <select id="table" class="input">
        <option value="">Ø§Ø®ØªØ± Ø±Ù‚Ù… Ø§Ù„Ø·Ø§ÙˆÙ„Ø©</option>
        <option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
        <option>6</option><option>7</option><option>8</option><option>9</option><option>10</option>
      </select>

      <!-- Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ -->
      <label for="phone">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (Ù…Ù‡Ù… Ù„Ù†Ø¸Ø§Ù… Ø§Ù„ÙˆÙ„Ø§Ø¡)</label>
      <input id="phone" class="input" type="tel" placeholder="010xxxxxxxx" inputmode="tel" pattern="[0-9]*">

      <div class="note" role="note">
        <strong>Ù†Ø¸Ø§Ù… Ø§Ù„ÙˆÙ„Ø§Ø¡:</strong> Ø§Ø¬Ù…Ø¹ Ø§Ù„Ø¥Ù†ÙØ§Ù‚ØŒ ÙˆÙƒÙ„Ù…Ø§ ÙˆØµÙ„ Ù…Ø¬Ù…ÙˆØ¹ Ø¥Ù†ÙØ§Ù‚Ùƒ Ø¥Ù„Ù‰ 1000 Ø¬ ØªØ­ØµÙ„ Ø¹Ù„Ù‰ Ù…Ø´Ø±ÙˆØ¨ Ù…Ø¬Ø§Ù†ÙŠ.  
        <br>ÙˆÙƒÙ…Ø§Ù†: ÙƒÙ„ Ø¹Ù…ÙŠÙ„ ÙÙŠ ÙŠÙˆÙ… Ù…ÙŠÙ„Ø§Ø¯Ù‡ ÙŠØ­ØµÙ„ Ø¹Ù„Ù‰ Ù‡Ø¯ÙŠØ© Ù…Ù† Ø§Ù„Ù…Ø­Ù„ (Ù…Ø´Ø±ÙˆØ¨ Ù…Ø¬Ø§Ù†ÙŠ). Ø³ÙŠØªÙ… Ù…Ù†Ø­ Ù‡Ø¯ÙŠØ© ÙˆØ§Ø­Ø¯Ø© Ù„ÙƒÙ„ Ø±Ù‚Ù… Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙŠ ÙƒÙ„ Ø³Ù†Ø©.
      </div>

      <!-- Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ø¶Ø§ÙÙŠØ© -->
      <label for="notes">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
      <textarea id="notes" placeholder="Ù…Ø«Ø§Ù„: Ø¨Ø¯ÙˆÙ† Ø³ÙƒØ±ØŒ Ø²ÙŠØ§Ø¯Ø© Ø­Ù„ÙŠØ¨..."></textarea>

      <!-- Ø§Ù„Ø£Ø²Ø±Ø§Ø± -->
      <div class="actions">
        <button id="submitBtn" class="btn">Ø§Ø±Ø³Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨</button>
        <button id="clearBtn" class="btn ghost" type="button">Ø§ÙØ±Ø§Øº Ø§Ù„Ø­Ù‚ÙˆÙ„</button>
      </div>

      <div class="small">Ù…Ù„Ø§Ø­Ø¸Ø©: ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ø§Ù„ØµØ­ÙŠØ­ Ù„Ø§Ø³ØªÙ„Ø§Ù… Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø·Ù„Ø¨ ÙˆÙ†Ø¸Ø§Ù… Ø§Ù„ÙˆÙ„Ø§Ø¡.</div>
    </div>
  </div>

<script>
/* ====== populate date selects (days, months, years from current down to 1960) ====== */
(function populateDateInputs(){
  const daySel = document.getElementById('birth-day');
  const monthSel = document.getElementById('birth-month');
  const yearSel = document.getElementById('birth-year');

  for(let d=1; d<=31; d++){
    const opt = document.createElement('option');
    opt.value = String(d).padStart(2,'0');
    opt.textContent = d;
    daySel.appendChild(opt);
  }

  const months = [
    {n:1, name:'ÙŠÙ†Ø§ÙŠØ±'},
    {n:2, name:'ÙØ¨Ø±Ø§ÙŠØ±'},
    {n:3, name:'Ù…Ø§Ø±Ø³'},
    {n:4, name:'Ø£Ø¨Ø±ÙŠÙ„'},
    {n:5, name:'Ù…Ø§ÙŠÙˆ'},
    {n:6, name:'ÙŠÙˆÙ†ÙŠÙˆ'},
    {n:7, name:'ÙŠÙˆÙ„ÙŠÙˆ'},
    {n:8, name:'Ø£ØºØ³Ø·Ø³'},
    {n:9, name:'Ø³Ø¨ØªÙ…Ø¨Ø±'},
    {n:10, name:'Ø£ÙƒØªÙˆØ¨Ø±'},
    {n:11, name:'Ù†ÙˆÙÙ…Ø¨Ø±'},
    {n:12, name:'Ø¯ÙŠØ³Ù…Ø¨Ø±'},
  ];
  months.forEach(m=>{
    const opt = document.createElement('option');
    opt.value = String(m.n).padStart(2,'0');
    opt.textContent = `${m.name} (${m.n})`;
    monthSel.appendChild(opt);
  });

  const currentYear = new Date().getFullYear();
  for(let y = currentYear; y >= 1960; y--){
    const opt = document.createElement('option');
    opt.value = String(y);
    opt.textContent = y;
    yearSel.appendChild(opt);
  }
})();

/* ====== LOYALTY + BIRTHDAY GIFT + ORDER SUBMIT ====== */
(function setupFormWithLoyaltyAndBirthday(){
  const submitBtn = document.getElementById('submitBtn');
  const clearBtn = document.getElementById('clearBtn');

  // keys
  const LOYAL_KEY = 'neoCafe_loyalty_v1'; // stores { phone: cumulativeSpentRemainder }
  const BIRTH_KEY = 'neoCafe_birthday_v1'; // stores { phone: lastGiftYear }

  // helpers load/save
  function loadJson(key){ try{ const r = localStorage.getItem(key); return r ? JSON.parse(r) : {}; }catch(e){ return {}; } }
  function saveJson(key,obj){ try{ localStorage.setItem(key, JSON.stringify(obj)); }catch(e){ console.error(e); } }

  function loadCart(){
    try{ const raw = localStorage.getItem('neoCafe_cart_v1'); return raw ? JSON.parse(raw) : []; }catch(e){ return []; }
  }

  submitBtn.addEventListener('click', function(){
    // collect fields
    const nickname = document.getElementById('nickname').value.trim() || 'â€”';
    const day = document.getElementById('birth-day').value;
    const month = document.getElementById('birth-month').value;
    const year = document.getElementById('birth-year').value;
    const table = document.getElementById('table').value || 'â€”';
    let phone = (document.getElementById('phone').value || '').trim();
    const notes = document.getElementById('notes').value.trim() || 'â€”';

    // normalize phone
    const phoneDigits = phone.replace(/[^\d+]/g, '');
    if(!phoneDigits){
      alert('Ù…Ù† ÙØ¶Ù„Ùƒ Ø§ÙƒØªØ¨ Ø±Ù‚Ù… Ù…ÙˆØ¨Ø§ÙŠÙ„ ØµØ§Ù„Ø­ Ù„ÙŠØªÙ… Ø§Ø­ØªØ³Ø§Ø¨ Ø§Ù„ÙˆÙ„Ø§Ø¡ ÙˆØ¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨.');
      return;
    }
    phone = phoneDigits;

    // load cart & compute total
    const cart = loadCart();
    let total = 0;
    const cartLines = [];
    if(cart && cart.length){
      cart.forEach((it, idx) => {
        const qty = Number(it.qty) || 1;
        const price = Number(it.price) || 0;
        const lineTotal = price * qty;
        total += lineTotal;
        cartLines.push(`${idx+1}. ${it.name} Ã— ${qty} = ${lineTotal} Ø¬`);
      });
    }

    // ===== loyalty (cumulative spending) =====
    const loyalMap = loadJson(LOYAL_KEY);
    const beforeSpent = Number(loyalMap[phone] || 0); // remainder toward next reward
    const newCumulative = beforeSpent + total;

    const rewardThreshold = 1000; // every 1000 Ø¬ => 1 free drink
    const rewards = Math.floor(newCumulative / rewardThreshold); // number of free drinks earned now
    const remaining = newCumulative % rewardThreshold; // remainder after awarding rewards

    // update loyalty store: keep remaining value
    loyalMap[phone] = remaining;
    saveJson(LOYAL_KEY, loyalMap);

    // ===== birthday gift logic =====
    const birthMap = loadJson(BIRTH_KEY);
    let birthdayGiftGranted = false;
    let birthdayAlreadyThisYear = false;
    const today = new Date();
    const todayDay = String(today.getDate()).padStart(2,'0');
    const todayMonth = String(today.getMonth() + 1).padStart(2,'0');
    // check if user provided day & month
    if(day && month){
      if(day === todayDay && month === todayMonth){
        const lastYear = Number(birthMap[phone] || 0);
        const thisYear = today.getFullYear();
        if(lastYear === thisYear){
          birthdayAlreadyThisYear = true; // already claimed
        } else {
          // grant birthday gift now (one per year)
          birthdayGiftGranted = true;
          birthMap[phone] = thisYear;
          saveJson(BIRTH_KEY, birthMap);
        }
      }
    }

    // ===== build message =====
    const lines = [];
    lines.push('Ø·Ù„Ø¨ Ù…Ù† Neo CafÃ©');
    lines.push(`Ø§Ø³Ù… Ø§Ù„Ø´Ù‡Ø±Ø©: ${nickname}`);
    if(day || month || year){
      const dateText = `${day || '--'}/${month || '--'}/${year || '--'}`;
      lines.push(`ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯: ${dateText}`);
    }
    lines.push(`Ø±Ù‚Ù… Ø§Ù„Ø·Ø§ÙˆÙ„Ø©: ${table}`);
    lines.push(`Ø§Ù„Ù‡Ø§ØªÙ: ${phone}`);
    lines.push('----------------------');

    if(cartLines.length){
      lines.push('Ø§Ù„Ø³Ù„Ø©:');
      cartLines.forEach(l => lines.push(l));
      lines.push('----------------------');
      lines.push(`Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${total} Ø¬`);
    } else {
      lines.push('Ø§Ù„Ø³Ù„Ø©: ÙØ§Ø±ØºØ©');
    }

    lines.push('----------------------');
    // loyalty summary
    lines.push(`Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ù†Ø­Ùˆ Ø§Ù„Ø¬Ø§Ø¦Ø²Ø© Ù‚Ø¨Ù„ Ø§Ù„Ø·Ù„Ø¨: ${beforeSpent} Ø¬`);
    lines.push(`Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¶Ø§Ù Ù…Ù† Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨: ${total} Ø¬`);
    lines.push(`Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªØ±Ø§ÙƒÙ…ÙŠ Ø¨Ø¹Ø¯ Ø§Ù„Ø·Ù„Ø¨: ${newCumulative} Ø¬`);

    if(rewards > 0){
      lines.push(`ğŸ‰ Ø­ØµÙ„Øª Ø¹Ù„Ù‰ ${rewards} Ù…Ø´Ø±ÙˆØ¨ Ù…Ø¬Ø§Ù†ÙŠ (Ø¨Ø³Ø¨Ø¨ Ø§Ø¬Ù…Ø§Ù„ÙŠ Ø¥Ù†ÙØ§Ù‚Ùƒ).`);
      lines.push(`Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ù„ØµØ§Ù„Ø­ Ø§Ù„Ø¬Ø§Ø¦Ø²Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©: ${remaining} Ø¬`);
    } else {
      const need = rewardThreshold - newCumulative;
      lines.push(`ØªØ¨Ù‚Ù‰ ${need} Ø¬ Ù„ØªØ­ØµÙ„ Ø¹Ù„Ù‰ Ù…Ø´Ø±ÙˆØ¨ Ù…Ø¬Ø§Ù†ÙŠ (Ø­Ø³Ø¨ Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ù†ÙØ§Ù‚).`);
      lines.push(`Ø­Ø§Ù„ØªÙƒ Ø§Ù„Ø¢Ù† Ø¨Ø¹Ø¯ Ø§Ù„Ø·Ù„Ø¨: ${remaining} Ø¬ Ù†Ø­Ùˆ Ø§Ù„Ø¬Ø§Ø¦Ø²Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©.`);
    }

    // birthday lines
    if(birthdayGiftGranted){
      lines.push('----------------------');
      lines.push('ğŸ‚ Ù‡Ø¯ÙŠØ© Ø¹ÙŠØ¯ Ù…ÙŠÙ„Ø§Ø¯: Ù…Ø¨Ø±ÙˆÙƒ! Ø­ØµÙ„Øª Ø¹Ù„Ù‰ Ù…Ø´Ø±ÙˆØ¨ Ù…Ø¬Ø§Ù†ÙŠ Ø¨Ù…Ù†Ø§Ø³Ø¨Ø© Ø¹ÙŠØ¯ Ù…ÙŠÙ„Ø§Ø¯Ùƒ. (Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙŠ Ø§Ù„Ø³Ù†Ø©)');
    } else if (birthdayAlreadyThisYear){
      lines.push('----------------------');
      lines.push('ğŸ‚ Ù…Ù„Ø§Ø­Ø¸Ø©: Ù„Ù‚Ø¯ Ø§Ø³ØªÙ„Ù…Øª Ù‡Ø¯ÙŠØ© Ø¹ÙŠØ¯ Ù…ÙŠÙ„Ø§Ø¯Ùƒ Ø¨Ø§Ù„ÙØ¹Ù„ Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø§Ù….');
    } else {
      // nothing
    }

    lines.push('----------------------');
    lines.push(`Ù…Ù„Ø§Ø­Ø¸Ø§Øª: ${notes}`);

    // open whatsapp
    const text = encodeURIComponent(lines.join('\n'));
    const businessPhone = '201034311119'; // Ø¹Ø¯Ù‘Ù„ Ù„Ùˆ Ù…Ø­ØªØ§Ø¬ Ø±Ù‚Ù… Ø¢Ø®Ø±
    window.open(`https://wa.me/${businessPhone}?text=${text}`, '_blank');
  });

  // clear button handler
  clearBtn.addEventListener('click', function(){
    if(!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ ÙØ¹Ù„Ø§Ù‹ Ø¥ÙØ±Ø§Øº Ø§Ù„Ø­Ù‚ÙˆÙ„ØŸ')) return;
    document.getElementById('nickname').value = '';
    document.getElementById('birth-day').value = '';
    document.getElementById('birth-month').value = '';
    document.getElementById('birth-year').value = '';
    document.getElementById('table').value = '';
    document.getElementById('phone').value = '';
    document.getElementById('notes').value = '';
  });

})(); // end setup
</script>
</body>
</html>
