<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø·Ù„Ø¨ â€” Neo CafÃ©</title>
<style>
  :root{ --primary:#0D615B; --muted:#6B6B6B; --card:#fff; --bg:#F5F2EE; }
  body{font-family: "Noto Sans Arabic", system-ui, sans-serif;background:linear-gradient(180deg,#fff,#faf8f6);margin:0;color:#111;padding:18px;}
  .wrap{max-width:960px;margin:18px auto;background:#fff;border-radius:12px;padding:18px;box-shadow:0 8px 30px rgba(13,97,91,0.06)}
  h1{margin:0 0 12px;font-size:20px;color:var(--primary)}
  label{display:block;margin:10px 0 6px;font-weight:700;color:#333}
  input[type="text"], select, textarea{width:100%;padding:10px;border-radius:8px;border:1px solid #e6e6e6;box-shadow:none;font-size:15px}
  textarea{min-height:80px;resize:vertical}
  .row{display:flex;gap:12px;align-items:center}
  .col{flex:1}
  .small{font-size:13px;color:var(--muted)}
  .cart-box{margin-top:14px;padding:12px;border-radius:10px;background:linear-gradient(180deg,#fafafa,#fff);border:1px solid rgba(0,0,0,0.03)}
  .cart-item{display:flex;align-items:center;gap:12px;padding:8px;border-radius:10px;border:1px solid rgba(0,0,0,0.03);margin-bottom:8px;background:#fff}
  .mini{width:72px;height:56px;object-fit:cover;border-radius:8px;background:#f4f4f4}
  .cart-item .title{font-weight:800}
  .cart-bottom{display:flex;justify-content:space-between;align-items:center;margin-top:12px}
  .total{font-weight:900;color:var(--primary)}
  .btn{background:var(--primary);color:#fff;padding:10px 14px;border-radius:10px;border:none;font-weight:800;cursor:pointer}
  .btn.ghost{background:transparent;color:var(--primary);border:2px solid rgba(13,97,91,0.12)}
  .loyal-wrap{margin-top:12px;padding:10px;border-radius:10px;background:#f6fffb;border:1px solid rgba(13,97,91,0.06);color:var(--primary)}
  .loyal-progress{font-size:14px;margin-top:8px}
  .hint{font-size:13px;color:#666;margin-top:8px}
  .small-btn{padding:6px 10px;border-radius:8px;border:1px solid rgba(0,0,0,0.06);background:#fff;cursor:pointer}
  .center{text-align:center}
  .info-box{font-size:13px;color:#444;background:#fff9f0;padding:10px;border-radius:8px;border:1px solid rgba(0,0,0,0.03);margin-top:8px}
  .note-text{font-size:13px;color:#333}
  @media (max-width:760px){ .row{flex-direction:column} .mini{width:64px;height:48px} }
</style>
</head>
<body>
  <div class="wrap">
    <h1>Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ â€” Neo CafÃ©</h1>

    <!-- Form -->
    <div>
      <label for="cust-name">Ø§Ù„Ø§Ø³Ù…</label>
      <input id="cust-name" type="text" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ" />

      <div class="row" style="margin-top:8px">
        <div class="col">
          <label for="dob-day">Ø§Ù„ÙŠÙˆÙ…</label>
          <select id="dob-day" aria-label="Ø§Ù„ÙŠÙˆÙ…">
            <!-- days injected by script -->
          </select>
        </div>
        <div class="col">
          <label for="dob-month">Ø§Ù„Ø´Ù‡Ø± (Ø±Ù‚Ù…)</label>
          <select id="dob-month" aria-label="Ø§Ù„Ø´Ù‡Ø±">
            <!-- months injected by script -->
          </select>
        </div>
        <div class="col">
          <label for="dob-year">Ø§Ù„Ø³Ù†Ø©</label>
          <select id="dob-year" aria-label="Ø§Ù„Ø³Ù†Ø©">
            <!-- years injected by script -->
          </select>
        </div>
      </div>

      <label for="cust-table" style="margin-top:12px">Ø±Ù‚Ù… Ø§Ù„Ø·Ø§ÙˆÙ„Ø©</label>
      <select id="cust-table">
        <option value="">Ø§Ø®ØªØ± Ø±Ù‚Ù… Ø§Ù„Ø·Ø§ÙˆÙ„Ø©</option>
        <option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
        <option>6</option><option>7</option><option>8</option><option>9</option><option>10</option>
      </select>

      <label for="loyal-phone" style="margin-top:12px">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (Ù…Ù‡Ù… Ù„Ù†Ø¸Ø§Ù… Ø§Ù„ÙˆÙ„Ø§Ø¡)</label>
      <input id="loyal-phone" type="text" placeholder="010xxxxxxxx" />
      <!-- loyalty explanatory text -->
      <div class="info-box" style="margin-top:8px">
        <div class="note-text"><strong>Ù†Ø¸Ø§Ù… Ø§Ù„ÙˆÙ„Ø§Ø¡:</strong> ÙƒÙ„ Ù…Ø±Ø© ØªØ·Ù„Ø¨ ÙÙŠÙ‡Ø§ Ù…Ù† Ù†ÙŠÙˆ ÙƒØ§ÙÙŠÙ‡ ÙˆØªØ­Ø· Ø±Ù‚Ù… Ù…ÙˆØ¨Ø§ÙŠÙ„Ùƒ ØªØ³Ø¬Ù‘Ù„ Ù†Ù‚Ø·Ø© (Ø®ØªÙ…Ø©). Ø¨Ø¹Ø¯ 5 Ù†Ù‚Ø§Ø· Ø³ØªØ­ØµÙ„ Ø¹Ù„Ù‰ Ù…Ø´Ø±ÙˆØ¨ Ù…Ø¬Ø§Ù†ÙŠ Ù…Ù† Ø§Ø®ØªÙŠØ§Ø±Ùƒ. ÙÙ‚Ø· Ø§Ø³ØªØ®Ø¯Ù… Ù†ÙØ³ Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ ÙˆØ³ÙŠÙØ­ØªØ³Ø¨ Ù„Ùƒ Ø§Ù„ØªÙ‚Ø¯Ù… â€” Ù„Ø§ Ø­Ø§Ø¬Ø© Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø£Ùˆ ØªØ³Ø¬ÙŠÙ„ Ø¥Ø¶Ø§ÙÙŠ.</div>
      </div>

      <!-- loyalty status area -->
      <div id="loyal-status" class="loyal-wrap" style="display:none">
        <div id="loyal-msg" style="font-weight:800"></div>
        <div id="loyal-progress" class="loyal-progress"></div>
        <div style="margin-top:8px">
          <button id="redeem-free" class="small-btn" style="display:none">Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¨ Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠ</button>
        </div>
      </div>

      <label for="notes" style="margin-top:12px">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
      <textarea id="notes" placeholder="Ù…Ø«Ø§Ù„: Ø³ÙƒØ± Ø®ÙÙŠÙØŒ Ø¨Ø¯ÙˆÙ† Ù„Ø¨Ù†..."></textarea>
    </div>

    <!-- Cart -->
    <div class="cart-box" style="margin-top:16px">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <div style="font-weight:900">Ø§Ù„Ø·Ù„Ø¨Ø§Øª:</div>
        <div class="small">Ø§ÙØ­Øµ Ø§Ù„Ø·Ù„Ø¨ Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„</div>
      </div>

      <div id="cart-items-area"></div>

      <div class="cart-bottom">
        <div class="small">ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙƒÙ…ÙŠØ§Øª Ù…Ù† Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
        <div style="display:flex;gap:10px;align-items:center">
          <div class="total" id="cart-total">0 Ø¬</div>
        </div>
      </div>
    </div>

    <div style="margin-top:14px;display:flex;gap:10px;justify-content:flex-end">
      <button id="back-to-menu" class="btn ghost">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…Ù†ÙŠÙˆ</button>
      <button id="send-order" class="btn">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</button>
    </div>

    <p class="hint center" style="margin-top:12px">Ø³ÙŠØªÙ… Ø¥Ø¹Ø¯Ø§Ø¯ Ø±Ø³Ø§Ù„Ø© Ù…Ù†Ø¸Ù…Ø© ØªÙØªØ­ ØªØ·Ø¨ÙŠÙ‚ ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¥Ù„Ù‰ Neo CafÃ©.</p>
  </div>

<script>
/* =========================
   Checkout page - full updated
   - DOB selects (day/month/year)
   - Loyalty persistent by phone only
   - Loyalty message exactly as requested
   - Explanatory text under phone field
   - Builds WhatsApp message (each item on new line)
   =========================*/

// config
const DEST_WHATSAPP = '201034311119'; // Ø±Ù‚Ù… Ø§Ù„Ù…Ø·Ø¹Ù… Ø¨ØµÙŠØºØ© Ø¯ÙˆÙ„ÙŠ Ø¨Ø¯ÙˆÙ† + (Ø¹Ø¯Ù‘Ù„Ù‡ Ù„Ùˆ Ø­Ø§Ø¨Ø¨)
const CART_KEY = 'neo_cart_v3';
const LOYAL_KEY = 'neo_loyalty_v1';

// fallback items list if checkout opened standalone
if(!window.items) {
  window.items = [
    { name: 'Ø§Ø³Ø¨Ø±ÙŠØ³Ùˆ', price:45, category:'Ù…Ø´Ø±ÙˆØ¨Ø§Øª Ø³Ø§Ø®Ù†Ø©', img:'espresso.jpg'},
    { name: 'ÙƒØ§Ø¨ØªØ´ÙŠÙ†Ùˆ', price:55, category:'Ù…Ø´Ø±ÙˆØ¨Ø§Øª Ø³Ø§Ø®Ù†Ø©', img:'cappuccino.jpg'},
    { name: 'Ù„Ø§ØªÙŠÙ‡ ÙƒØ§Ø±Ø§Ù…ÙŠÙ„', price:60, category:'Ù…Ø´Ø±ÙˆØ¨Ø§Øª Ø³Ø§Ø®Ù†Ø©', img:'latte-caramel.jpg'},
    { name: 'Ù‚Ù‡ÙˆØ© ØªØ±ÙƒÙŠ', price:50, category:'Ù…Ø´Ø±ÙˆØ¨Ø§Øª Ø³Ø§Ø®Ù†Ø©', img:'turkish-coffee.jpg'},
    { name: 'Ø§ÙŠØ³ Ù„Ø§ØªÙŠÙ‡', price:55, category:'Ù…Ø´Ø±ÙˆØ¨Ø§Øª Ø¨Ø§Ø±Ø¯Ø©', img:'iced-latte.jpg'},
    { name: 'ÙˆØ§ÙÙ„', price:65, category:'Ù…Ø®Ø¨ÙˆØ²Ø§Øª', img:'waffle.jpg'},
    { name: 'ÙƒØ±ÙˆØ§Ø³ÙˆÙ†', price:45, category:'Ù…Ø®Ø¨ÙˆØ²Ø§Øª', img:'croissant.jpg'},
    { name: 'Ø¨Ø±Ø§ÙˆÙ†ÙŠ Ø¨Ø§Ù„Ø´ÙˆÙƒÙˆÙ„Ø§ØªØ©', price:55, category:'Ø­Ù„ÙˆÙŠØ§Øª', img:'brownie.jpg'}
  ];
}

// helpers
function loadCart(){ try{ return JSON.parse(localStorage.getItem(CART_KEY) || '[]'); }catch(e){return [];} }
function saveCart(cart){ try{ localStorage.setItem(CART_KEY, JSON.stringify(cart)); }catch(e){} }
function loadLoyalty(){ try{ return JSON.parse(localStorage.getItem(LOYAL_KEY) || '{}'); }catch(e){return {}; } }
function saveLoyalty(obj){ try{ localStorage.setItem(LOYAL_KEY, JSON.stringify(obj)); }catch(e){} }
function fmtPrice(n){ return n + ' Ø¬'; }

// ===== DOB selects populate =====
(function populateDOB(){
  const daySel = document.getElementById('dob-day');
  const monthSel = document.getElementById('dob-month');
  const yearSel = document.getElementById('dob-year');
  // days 1..31
  daySel.innerHTML = '<option value="">Ø§Ù„ÙŠÙˆÙ…</option>';
  for(let d=1; d<=31; d++){
    daySel.innerHTML += `<option value="${d}">${d}</option>`;
  }
  // months 1..12
  monthSel.innerHTML = '<option value="">Ø§Ù„Ø´Ù‡Ø±</option>';
  for(let m=1; m<=12; m++){
    monthSel.innerHTML += `<option value="${m}">${m}</option>`;
  }
  // years: from 1940 to current year (reverse order so recent first)
  const currentYear = new Date().getFullYear();
  yearSel.innerHTML = '<option value="">Ø§Ù„Ø³Ù†Ø©</option>';
  for(let y=currentYear; y>=1940; y--){
    yearSel.innerHTML += `<option value="${y}">${y}</option>`;
  }
})();

// ===== phone normalization =====
function normalizePhoneRaw(v){
  if(!v) return '';
  const digits = (''+v).replace(/\D+/g,''); // remove non-digits
  if(digits.length === 0) return '';
  if(digits.startsWith('20') && digits.length >= 11){
    return '0' + digits.slice(2);
  }
  if(digits.startsWith('0')) return digits;
  if(digits.length === 10 && digits.startsWith('1')) return '0' + digits;
  return digits;
}
function getPhoneVal(){ const el = document.getElementById('loyal-phone'); if(!el) return ''; return normalizePhoneRaw(el.value.trim()); }

// ===== render cart =====
function renderCart(){
  const wrap = document.getElementById('cart-items-area');
  const cart = loadCart();
  wrap.innerHTML = '';
  if(cart.length === 0){
    wrap.innerHTML = '<div style="padding:10px;color:#666">Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©</div>';
    document.getElementById('cart-total').innerText = '0 Ø¬';
    return;
  }
  let total = 0;
  cart.forEach((it, idx) => {
    const div = document.createElement('div');
    div.className = 'cart-item';
    const imgSrc = it.img ? `assets/images/${it.img}` : '';
    const priceText = it.price === 0 ? 'Ù…Ø¬Ø§Ù†ÙŠ' : fmtPrice(it.price);
    total += (it.price || 0) * (it.qty || 1);
    div.innerHTML = `
      <img class="mini" src="${imgSrc}" alt="${it.name}" onerror="this.style.display='none'">
      <div style="flex:1">
        <div class="title">${it.name}</div>
        <div class="small">${priceText} Ã— ${it.qty || 1}</div>
        ${it.free && it.price === 0 ? `<div style="color:var(--primary);font-weight:700;margin-top:6px">Ù…Ù‚Ø¯Ù… ÙƒÙ‡Ø¯ÙŠØ©</div>` : ''}
      </div>
      <div style="text-align:center">
        <div class="small">#${idx+1}</div>
      </div>
    `;
    wrap.appendChild(div);
  });
  document.getElementById('cart-total').innerText = fmtPrice(total);
}

// ===== loyalty core functions =====
function showLoyalStatus(phone){
  const wrap = document.getElementById('loyal-status');
  const msg = document.getElementById('loyal-msg');
  const progress = document.getElementById('loyal-progress');
  const redeemBtn = document.getElementById('redeem-free');
  const normalized = normalizePhoneRaw(phone || '');
  if(!normalized){
    wrap.style.display = 'none';
    return;
  }
  const db = loadLoyalty();
  const entry = db[normalized] || {stamps:0, rewards:0};
  wrap.style.display = 'block';
  msg.innerText = `Ù†Ù‚Ø§Ø· Ø§Ù„ÙˆÙ„Ø§Ø¡: ${entry.stamps} / 5  â€” ${entry.rewards > 0 ? 'Ù„Ø¯ÙŠÙƒ Ù…Ø´Ø±ÙˆØ¨ Ù…Ø¬Ø§Ù†ÙŠ Ù…ØªØ§Ø­!' : 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø´Ø±ÙˆØ¨Ø§Øª Ù…Ø¬Ø§Ù†ÙŠØ© Ø­Ø§Ù„ÙŠØ§Ù‹'}`;
  progress.innerText = `Ø§Ù„ØªÙ‚Ø¯Ù‘Ù…: ${'â—'.repeat(entry.stamps)}${'â—‹'.repeat(Math.max(0,5-entry.stamps))}`;
  redeemBtn.style.display = entry.rewards > 0 ? 'inline-block' : 'none';
}

function addStampForPhone(phone){
  const normalized = normalizePhoneRaw(phone || '');
  console.log('[Loyalty] addStampForPhone called with:', phone, '->', normalized);
  if(!normalized) return {ok:false,msg:'no phone'};
  const db = loadLoyalty();
  const entry = db[normalized] || {stamps:0, rewards:0, last:0};
  entry.stamps = (entry.stamps || 0) + 1;
  entry.last = Date.now();
  let rewardGranted = false;
  if(entry.stamps >= 5){
    entry.stamps = 0;
    entry.rewards = (entry.rewards || 0) + 1;
    rewardGranted = true;
  }
  db[normalized] = entry;
  saveLoyalty(db);
  console.log('[Loyalty] updated:', normalized, entry);

  // if rewardGranted return also the friendly message in Arabic as requested
  if(rewardGranted){
    const congratMsg = `ğŸ‰ Ø§Ù†Øª Ù…Ù† Ø¹Ù…Ù„Ø§Ø¡ Ù†ÙŠÙˆ ÙƒØ§ÙÙŠÙ‡ Ø§Ù„Ù…Ù…ÙŠØ²ÙŠÙ†\nÙƒØ³Ø¨Øª Ù…Ø´Ø±ÙˆØ¨ Ù…Ø¬Ø§Ù†ÙŠ Ù…Ù† Ø§Ø®ØªÙŠØ§Ø±Ùƒ ğŸ’š\nØ¨Ù†Ø´ÙƒØ±Ùƒ Ø¹Ù„Ù‰ Ø«Ù‚ØªÙƒ ÙÙŠÙ†Ø§ ÙˆØ¨Ù†ØªÙ…Ù†Ù‰ Ù†ÙƒÙˆÙ† Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ø¹Ù†Ø¯ Ø­Ø³Ù† Ø¸Ù†Ùƒ ÙÙŠÙ†Ø§.`;
    return {ok:true, reward:true, entry, congratMsg};
  }
  return {ok:true, reward:false, entry};
}

function redeemReward(phone){
  const normalized = normalizePhoneRaw(phone || '');
  if(!normalized) return {ok:false,msg:'no phone'};
  const db = loadLoyalty();
  const entry = db[normalized];
  if(!entry || (entry.rewards || 0) <= 0) return {ok:false,msg:'no rewards'};
  entry.rewards = entry.rewards - 1;
  entry.last = Date.now();
  db[normalized] = entry;
  saveLoyalty(db);
  return {ok:true, entry};
}

// ===== build order message =====
function buildDOBString(){
  const d = document.getElementById('dob-day').value;
  const m = document.getElementById('dob-month').value;
  const y = document.getElementById('dob-year').value;
  if(!d && !m && !y) return '-';
  return `${d || '-'}-${m || '-'}-${y || '-'}`;
}

function buildOrderMessage(name, dob, table, phone, notes){
  const cart = loadCart();
  let lines = [];
  lines.push(`Ø·Ù„Ø¨ Ù…Ù† Neo CafÃ©`);
  lines.push(`Ø§Ù„Ø§Ø³Ù…: ${name || '-'}`);
  lines.push(`ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯: ${dob || '-'}`);
  lines.push(`Ø±Ù‚Ù… Ø§Ù„Ø·Ø§ÙˆÙ„Ø©: ${table || '-'}`);
  lines.push(`Ù‡Ø§ØªÙ Ø§Ù„Ø¹Ù…ÙŠÙ„: ${phone || '-'}`);
  lines.push(`---------------------`);
  lines.push(`Ø§Ù„Ø£ØµÙ†Ø§Ù:`);
  if(cart.length === 0) {
    lines.push('- Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£ØµÙ†Ø§Ù');
  } else {
    cart.forEach(it => {
      const qty = it.qty || 1;
      const priceText = it.price === 0 ? '0 Ø¬ (Ù…Ø¬Ø§Ù†ÙŠ)' : `${it.price} Ø¬`;
      lines.push(`â€¢ ${it.name} Ã— ${qty} = ${priceText}`);
    });
  }
  lines.push(`---------------------`);
  if(notes && notes.trim()){
    lines.push(`Ù…Ù„Ø§Ø­Ø¸Ø§Øª: ${notes.trim()}`);
  }
  const db = loadLoyalty();
  const entry = db[normalizePhoneRaw(phone)] || {stamps:0, rewards:0};
  lines.push(`Ø­Ø§Ù„Ø© Ø§Ù„ÙˆÙ„Ø§Ø¡: ${entry.stamps}/5 ØŒ Ø¬ÙˆØ§Ø¦Ø² Ù…ØªØ§Ø­Ø©: ${entry.rewards}`);
  lines.push(`Ø´ÙƒØ±Ø§Ù‹ Ù„Ø§Ø®ØªÙŠØ§Ø±Ùƒ Neo CafÃ© â€” Make It NEO Time`);
  return lines.join('\n');
}

// ===== main send handler =====
document.getElementById('send-order').addEventListener('click', function(){
  const name = document.getElementById('cust-name').value.trim();
  const dob = buildDOBString();
  const table = document.getElementById('cust-table').value || '';
  const phoneRaw = document.getElementById('loyal-phone').value || '';
  const phone = normalizePhoneRaw(phoneRaw);
  const notes = document.getElementById('notes').value || '';

  if(!phone || phone.length < 8){
    alert('Ù…Ù† ÙØ¶Ù„Ùƒ Ø§ÙƒØªØ¨ Ø±Ù‚Ù… Ù‡Ø§ØªÙ ØµØ§Ù„Ø­ (Ù…Ù‡Ù… Ù„Ù†Ø¸Ø§Ù… Ø§Ù„ÙˆÙ„Ø§Ø¡ ÙˆÙ„ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨)');
    document.getElementById('loyal-phone').focus();
    return;
  }

  // add stamp for this phone (loyalty)
  const loyaltyRes = addStampForPhone(phone);
  // if reward granted, show the exact congrat message requested
  if(loyaltyRes.ok && loyaltyRes.reward){
    // message in Arabic as asked
    const msg = `ğŸ‰ Ø§Ù†Øª Ù…Ù† Ø¹Ù…Ù„Ø§Ø¡ Ù†ÙŠÙˆ ÙƒØ§ÙÙŠÙ‡ Ø§Ù„Ù…Ù…ÙŠØ²ÙŠÙ†\nÙƒØ³Ø¨Øª Ù…Ø´Ø±ÙˆØ¨ Ù…Ø¬Ø§Ù†ÙŠ Ù…Ù† Ø§Ø®ØªÙŠØ§Ø±Ùƒ ğŸ’š\nØ¨Ù†Ø´ÙƒØ±Ùƒ Ø¹Ù„Ù‰ Ø«Ù‚ØªÙƒ ÙÙŠÙ†Ø§ ÙˆØ¨Ù†ØªÙ…Ù†Ù‰ Ù†ÙƒÙˆÙ† Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ø¹Ù†Ø¯ Ø­Ø³Ù† Ø¸Ù†Ùƒ ÙÙŠÙ†Ø§.`;
    // show in alert (you can change to modal if prefer)
    alert(msg);
  }

  // build & open whatsapp message
  const msg = buildOrderMessage(name, dob, table, phone, notes);
  const waUrl = `https://api.whatsapp.com/send?phone=${encodeURIComponent(DEST_WHATSAPP)}&text=${encodeURIComponent(msg)}`;
  window.open(waUrl, '_blank');
  // keep cart as-is (or clear if you prefer)
});

// ===== redeem handler =====
document.getElementById('redeem-free').addEventListener('click', function(){
  const phone = getPhoneVal();
  if(!phone){ alert('Ù…Ù† ÙØ¶Ù„Ùƒ Ø§ÙƒØªØ¨ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ø£ÙˆÙ„Ø§Ù‹'); return; }
  const db = loadLoyalty();
  const entry = db[phone] || {stamps:0,rewards:0};
  if(!entry || entry.rewards <= 0){ alert('Ù…Ø¹ÙƒØ´ Ù…Ø´Ø±ÙˆØ¨ Ù…Ø¬Ø§Ù†ÙŠ Ø¯Ù„ÙˆÙ‚ØªÙŠ'); return; }

  const menuItems = window.items || [];
  if(!menuItems.length){ alert('Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ØºÙŠØ± Ù…ØªØ§Ø­Ø© Ø§Ù„Ø¢Ù†'); return; }
  let list = 'Ø§Ø®ØªØ§Ø± Ø±Ù‚Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¨ Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©:\n';
  menuItems.forEach((m,i)=> list += `${i+1}. ${m.name}\n`);
  const pick = prompt(list + '\nØ§ÙƒØªØ¨ Ø±Ù‚Ù… Ø§Ù„Ù…Ù†ØªØ¬');
  const idx = parseInt(pick) - 1;
  if(isNaN(idx) || idx < 0 || idx >= menuItems.length){ alert('Ø§Ø®ØªÙŠØ§Ø± ØºÙŠØ± ØµØ§Ù„Ø­'); return; }
  const chosen = menuItems[idx];

  const res = redeemReward(phone);
  if(!res.ok){ alert('Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ø¬Ø§Ø¦Ø²Ø©'); return; }
  const cart = loadCart();
  cart.push({ name: chosen.name + ' (Ù…Ø¬Ø§Ù†ÙŠ)', price: 0, qty: 1, img: chosen.img || '', free:true });
  saveCart(cart);
  renderCart();
  showLoyalStatus(phone);
  alert(`ØªÙ… Ø¥Ø¶Ø§ÙØ© ${chosen.name} ÙƒØ³Ø¹Ø± Ù…Ø¬Ø§Ù†ÙŠ Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø©.`);
});

// show loyalty status while typing
document.getElementById('loyal-phone').addEventListener('input', function(){
  showLoyalStatus(getPhoneVal());
});

// back to menu
document.getElementById('back-to-menu').addEventListener('click', function(){
  window.location.href = 'index.html';
});

// init render
renderCart();
showLoyalStatus(getPhoneVal());

// expose debug helpers
window._neo_debug = {
  showLoyal: () => console.log(loadLoyalty()),
  showCart: () => console.log(loadCart())
};
</script>
</body>
</html>
