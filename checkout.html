<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>إتمام الطلب - NEO CAFÉ</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root{--neo-green:#124d33;--neo-beige:#f6efe6;--muted:#6b6b6b}
body{margin:0;padding:18px;background:var(--neo-beige);font-family:"Cairo",sans-serif;color:#111}
.container{max-width:760px;margin:0 auto;background:#fff;padding:14px;border-radius:12px;box-shadow:0 12px 40px rgba(0,0,0,0.06)}
h2{margin:0 0 12px;color:var(--neo-green);font-weight:900}
.field{margin-bottom:12px}
label{display:block;margin-bottom:6px;font-weight:800}
input[type="text"],input[type="tel"],select,textarea{width:100%;padding:10px;border-radius:8px;border:1px solid #eee;font-size:15px}
.row{display:flex;gap:8px;align-items:center}
.row .col{flex:1}
.small-select{width:33%}
.btn{background:var(--neo-green);color:#fff;padding:12px 14px;border-radius:10px;border:0;font-weight:900;cursor:pointer}
.order-summary{margin-top:14px;border-top:1px dashed #eee;padding-top:12px}
.item-line{display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px solid #fafafa}
.total{display:flex;justify-content:space-between;font-weight:900;color:var(--neo-green);padding-top:8px}
.note{margin-top:10px;color:var(--muted)}
</style>
</head>
<body>
<div class="container">
  <h2>إتمام الطلب — Neo Café</h2>

  <div class="field">
    <label>اسم الشهرة</label>
    <input id="nickname" type="text" placeholder="اكتب اسم الشهرة">
  </div>

  <div class="field">
    <label>تاريخ الميلاد</label>
    <div class="row">
      <select id="birth-day" class="small-select">
        <option value="">اليوم</option>
      </select>
      <select id="birth-month" class="small-select">
        <option value="">الشهر</option>
      </select>
      <select id="birth-year" class="small-select">
        <option value="">السنة</option>
      </select>
    </div>
  </div>

  <div class="field">
    <label>رقم الطاولة</label>
    <select id="table-number">
      <option value="">اختر رقم الطاولة</option>
    </select>
  </div>

  <div class="field">
    <label>رقم الهاتف (مهم لنظام الولاء)</label>
    <input id="phone" type="tel" placeholder="010xxxxxxxx">
  </div>

  <div class="field">
    <label>ملاحظات إضافية (اختياري)</label>
    <textarea id="notes" rows="3" placeholder="ملاحظات..."></textarea>
  </div>

  <div class="order-summary">
    <div style="font-weight:900;margin-bottom:8px">السلة</div>
    <div id="itemsList"></div>
    <div class="total" style="margin-top:8px">
      <div>الإجمالي</div>
      <div id="grandTotal">0 ج</div>
    </div>
    <div class="note" id="loyaltyNote"></div>
  </div>

  <div style="margin-top:14px;display:flex;gap:8px">
    <button id="sendBtn" class="btn">إرسال الطلب عبر واتساب</button>
    <button id="backBtn" class="btn" style="background:#888">العودة للمنيو</button>
  </div>
</div>

<script>
/* read cart from localStorage */
const CART_KEY = 'neoCafe_cart_v1';
function loadCart(){ try{ const d = localStorage.getItem(CART_KEY); return d ? JSON.parse(d) : []; } catch(e){ return []; } }
function calcTotals(cart){ let total=0; cart.forEach(i=> total += (Number(i.price)||0)*(Number(i.qty)||0)); return total; }

/* populate day/month/year and table 1..10 */
const dayEl = document.getElementById('birth-day');
const monthEl = document.getElementById('birth-month');
const yearEl = document.getElementById('birth-year');
for(let d=1; d<=31; d++){ const o = document.createElement('option'); o.value = d; o.textContent = d; dayEl.appendChild(o); }
const months = ['1','2','3','4','5','6','7','8','9','10','11','12'];
months.forEach(m=>{ const o=document.createElement('option'); o.value=m; o.textContent=m; monthEl.appendChild(o); });
const currentYear = new Date().getFullYear();
for(let y=currentYear; y>=1960; y--){ const o=document.createElement('option'); o.value=y; o.textContent=y; yearEl.appendChild(o); }

/* tables 1..10 */
const tableEl = document.getElementById('table-number');
for(let t=1; t<=10; t++){ const o=document.createElement('option'); o.value=t; o.textContent=t; tableEl.appendChild(o); }

/* render cart items */
const itemsList = document.getElementById('itemsList');
const grandTotalEl = document.getElementById('grandTotal');
const loyaltyNote = document.getElementById('loyaltyNote');

function renderCartOnCheckout(){
  const cart = loadCart();
  itemsList.innerHTML = '';
  if(!cart || cart.length===0){ itemsList.innerHTML = '<div>السلة فارغة — اذهب للمنيو لإضافة طلبات</div>'; grandTotalEl.textContent = '0 ج'; loyaltyNote.textContent=''; return; }
  cart.forEach((it, idx)=>{
    const div = document.createElement('div');
    div.className = 'item-line';
    div.innerHTML = `<div>${idx+1}. ${it.name} × ${it.qty}</div><div>${it.price*it.qty} ج</div>`;
    itemsList.appendChild(div);
  });
  const total = calcTotals(cart);
  grandTotalEl.textContent = total + ' ج';

  // loyalty: if total >= 1000 -> free drink earned; else show remaining
  const threshold = 1000;
  if(total >= threshold){
    loyaltyNote.textContent = `مبروك! وصلت لـ ${threshold}ج أو أكثر — تستحق مشروب مجاني.`;
  } else {
    const remain = threshold - total;
    loyaltyNote.textContent = `متبقي ${remain} ج لتحصل على مشروب مجاني (نظام الولاء عند 1000 ج).`;
  }
}
renderCartOnCheckout();

/* send via WhatsApp: simple text summary (minimal, كما طلبت سابقًا فقط المبلغ المتبقي لولاء لكن هنا نرسل تفاصيل الطلب مع جملة خاصة) */
document.getElementById('sendBtn').addEventListener('click', ()=>{
  const nickname = document.getElementById('nickname').value.trim() || '-';
  const day = document.getElementById('birth-day').value || '-';
  const month = document.getElementById('birth-month').value || '-';
  const year = document.getElementById('birth-year').value || '-';
  const table = document.getElementById('table-number').value || '-';
  const phone = document.getElementById('phone').value.trim() || '-';
  const notes = document.getElementById('notes').value.trim() || '-';
  const cart = loadCart();
  if(!cart || cart.length===0){ alert('السلة فارغة'); return; }

  // prepare simple summary
  let msg = `طلب من Neo Café\nاسم الشهرة: ${nickname}\nتاريخ الميلاد: ${day}/${month}/${year}\nرقم الطاولة: ${table}\nالهاتف: ${phone}\n\nالسلة:\n`;
  cart.forEach((it,idx)=> msg += `${idx+1}. ${it.name} × ${it.qty} = ${it.price*it.qty} ج\n`);
  const total = calcTotals(cart);
  msg += `\nالإجمالي: ${total} ج\nملاحظات: ${notes}\n`;

  // minimal loyalty message only (as requested in last step): show remaining to reach 1000
  const threshold = 1000;
  let remain = threshold - total;
  if(remain < 0) remain = 0;
  msg += `\nالمبلغ المتبقي لنيل مشروب مجاني: ${remain} ج\n`;

  // encode and open whatsapp (use wa.me with phone number of cafe if you have, here we'll open general chat)
  const encoded = encodeURIComponent(msg);
  // open whatsapp web/mobile
  window.open(`https://wa.me/?text=${encoded}`, '_blank');

  // optional: after sending we may clear cart (depending on your preference). not auto-clearing now.
});

/* back to menu */
document.getElementById('backBtn').addEventListener('click', ()=> window.location.href = 'index.html');
</script>
</body>
</html>
