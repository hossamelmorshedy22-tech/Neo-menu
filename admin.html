<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEO ERP - Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ù…ØªÙƒØ§Ù…Ù„</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root {
            --primary: #124d33;
            --primary-dark: #0a2e1e;
            --secondary: #d4af37;
            --bg: #f3f4f6;
            --white: #ffffff;
            --text: #2d3436;
            --danger: #e74c3c;
            --success: #27ae60;
            --warning: #f39c12;
            --sidebar-width: 260px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Cairo', sans-serif; outline: none; }
        body { background: var(--bg); color: var(--text); display: flex; height: 100vh; overflow: hidden; }

        /* --- Sidebar --- */
        .sidebar {
            width: var(--sidebar-width); background: var(--primary-dark); color: var(--white);
            display: flex; flex-direction: column; transition: 0.3s; z-index: 100;
        }
        .brand {
            padding: 20px; text-align: center; background: var(--primary);
            border-bottom: 2px solid var(--secondary);
        }
        .brand h2 { margin: 0; font-weight: 800; color: var(--secondary); letter-spacing: 1px; }
        .brand p { font-size: 12px; opacity: 0.8; margin-top: 5px; }
        
        .nav-links { flex: 1; padding: 20px 10px; overflow-y: auto; }
        .nav-btn {
            display: flex; align-items: center; gap: 10px; width: 100%; padding: 12px 15px;
            background: transparent; border: none; color: #ecf0f1; text-align: right;
            font-size: 15px; cursor: pointer; border-radius: 8px; margin-bottom: 8px; transition: 0.2s;
        }
        .nav-btn:hover, .nav-btn.active { background: rgba(212, 175, 55, 0.15); color: var(--secondary); font-weight: 700; }
        .nav-btn i { width: 25px; text-align: center; }

        .user-panel { padding: 15px; background: rgba(0,0,0,0.2); font-size: 13px; text-align: center; }

        /* --- Main Content --- */
        .main-content { flex: 1; padding: 20px; overflow-y: auto; position: relative; }
        .page { display: none; animation: fadeIn 0.4s; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- Dashboard Cards --- */
        .cards-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; margin-bottom: 25px; }
        .card { background: var(--white); padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.03); position: relative; overflow: hidden; }
        .card::before { content: ''; position: absolute; top: 0; right: 0; width: 4px; height: 100%; background: var(--primary); }
        .card-icon { position: absolute; left: 15px; top: 15px; font-size: 30px; opacity: 0.1; color: var(--primary); }
        .card h3 { font-size: 14px; color: #7f8c8d; margin-bottom: 8px; }
        .card .value { font-size: 24px; font-weight: 800; color: var(--primary-dark); }
        .card .sub-text { font-size: 11px; color: #27ae60; margin-top: 5px; display: block; }

        /* --- Tables & Forms --- */
        .data-panel { background: var(--white); border-radius: 12px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.03); margin-bottom: 20px; }
        .panel-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 15px; }
        .btn-action { background: var(--primary); color: white; border: none; padding: 8px 20px; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 14px; }
        .btn-action:hover { background: var(--primary-dark); }
        
        table { width: 100%; border-collapse: collapse; font-size: 14px; }
        th { text-align: right; padding: 12px; background: #f8f9fa; color: var(--primary); font-weight: 700; border-bottom: 2px solid #eee; }
        td { padding: 12px; border-bottom: 1px solid #eee; vertical-align: middle; }
        tr:hover { background: #fdfdfd; }

        .status-badge { padding: 4px 10px; border-radius: 20px; font-size: 11px; font-weight: bold; }
        .bg-ok { background: #d4edda; color: #155724; }
        .bg-low { background: #fff3cd; color: #856404; }
        .bg-out { background: #f8d7da; color: #721c24; }

        /* --- Forms --- */
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: 600; font-size: 13px; }
        .form-control { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px; }
        .form-control:focus { border-color: var(--secondary); }
        .form-row { display: flex; gap: 15px; }
        .form-row .form-group { flex: 1; }

        /* --- POS Specific --- */
        .pos-layout { display: flex; gap: 20px; height: calc(100vh - 50px); }
        .menu-sec { flex: 2; display: flex; flex-direction: column; overflow: hidden; }
        .cart-sec { flex: 1; background: var(--white); border-radius: 12px; padding: 15px; display: flex; flex-direction: column; box-shadow: 0 5px 20px rgba(0,0,0,0.05); }
        
        .cats-bar { display: flex; gap: 10px; padding-bottom: 10px; overflow-x: auto; }
        .cat-chip { padding: 8px 16px; background: var(--white); border: 1px solid #eee; border-radius: 20px; cursor: pointer; font-weight: bold; font-size: 13px; white-space: nowrap; }
        .cat-chip.active { background: var(--primary); color: white; border-color: var(--primary); }

        .products-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap: 12px; overflow-y: auto; padding: 5px; }
        .prod-card { background: var(--white); border-radius: 10px; padding: 10px; text-align: center; cursor: pointer; border: 1px solid #eee; transition: 0.2s; }
        .prod-card:hover { transform: translateY(-3px); border-color: var(--secondary); }
        .prod-img { width: 100%; height: 80px; object-fit: contain; margin-bottom: 5px; }
        
        /* --- Modal --- */
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center; }
        .modal.open { display: flex; }
        .modal-content { background: white; width: 500px; padding: 25px; border-radius: 12px; animation: scaleUp 0.2s; }
        @keyframes scaleUp { from { transform: scale(0.9); } to { transform: scale(1); } }

        /* --- Print --- */
        @media print {
            body * { visibility: hidden; }
            #receipt-area, #receipt-area * { visibility: visible; }
            #receipt-area { position: absolute; left: 0; top: 0; width: 100%; }
        }
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="brand">
            <h2>NEO ERP</h2>
            <p>Cafe Management System</p>
        </div>
        <div class="nav-links">
            <button class="nav-btn active" onclick="nav('dashboard')"><i class="fas fa-chart-pie"></i> Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (Dashboard)</button>
            <button class="nav-btn" onclick="nav('pos')"><i class="fas fa-cash-register"></i> Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹ (POS)</button>
            <button class="nav-btn" onclick="nav('inventory')"><i class="fas fa-boxes"></i> Ø§Ù„Ù…Ø®Ø²Ù† ÙˆØ§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</button>
            <button class="nav-btn" onclick="nav('recipes')"><i class="fas fa-flask"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø±ÙŠØ³ÙŠØ¨ÙŠ</button>
            <button class="nav-btn" onclick="nav('expenses')"><i class="fas fa-money-bill-wave"></i> Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</button>
            <button class="nav-btn" onclick="nav('reports')"><i class="fas fa-file-invoice-dollar"></i> Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</button>
        </div>
        <div class="user-panel">
            <i class="fas fa-user-shield"></i> Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: <b>Admin</b>
        </div>
    </div>

    <div class="main-content">

        <div id="dashboard" class="page active">
            <div class="panel-header">
                <h2>ğŸ“Š Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø´Ø§Ø·</h2>
                <div style="font-size:14px;color:#666" id="currentDate"></div>
            </div>

            <div class="cards-grid">
                <div class="card">
                    <i class="fas fa-coins card-icon"></i>
                    <h3>Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…</h3>
                    <div class="value" id="dash_sales">0 Ø¬.Ù…</div>
                    <span class="sub-text">Ø¹Ø¯Ø¯ Ø§Ù„ÙÙˆØ§ØªÙŠØ±: <span id="dash_orders">0</span></span>
                </div>
                <div class="card">
                    <i class="fas fa-box-open card-icon"></i>
                    <h3>ØªÙƒÙ„ÙØ© Ø§Ù„Ø®Ø§Ù…Ø§Øª (COGS)</h3>
                    <div class="value" id="dash_cogs" style="color:#e67e22">0 Ø¬.Ù…</div>
                    <span class="sub-text">ØªÙƒÙ„ÙØ© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ø¹Ø©</span>
                </div>
                <div class="card">
                    <i class="fas fa-file-invoice card-icon"></i>
                    <h3>Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª (ØªØ´ØºÙŠÙ„)</h3>
                    <div class="value" id="dash_expenses" style="color:#c0392b">0 Ø¬.Ù…</div>
                    <span class="sub-text">Ø¥ÙŠØ¬Ø§Ø±ØŒ Ø¹Ù…Ø§Ù„Ø©ØŒ Ø§Ù„Ø®</span>
                </div>
                <div class="card">
                    <i class="fas fa-wallet card-icon"></i>
                    <h3>ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„ÙŠÙˆÙ…ÙŠ</h3>
                    <div class="value" id="dash_profit" style="color:#27ae60">0 Ø¬.Ù…</div>
                    <span class="sub-text">Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª - (Ø§Ù„ØªÙƒÙ„ÙØ© + Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª)</span>
                </div>
            </div>

            <div class="form-row">
                <div class="data-panel" style="flex:1">
                    <h3>âš ï¸ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</h3>
                    <table class="table">
                        <thead><tr><th>Ø§Ù„ØµÙ†Ù</th><th>Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø­Ø§Ù„ÙŠ</th><th>Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰</th></tr></thead>
                        <tbody id="lowStockTable"></tbody>
                    </table>
                </div>
                <div class="data-panel" style="flex:1">
                    <h3>ğŸ“ˆ Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</h3>
                    <canvas id="salesChart" height="150"></canvas>
                </div>
            </div>
        </div>

        <div id="pos" class="page">
            <div class="pos-layout">
                <div class="menu-sec">
                    <div style="margin-bottom:10px; padding:10px; background:white; border-radius:8px;">
                        <h4 style="margin-bottom:5px">Ø§Ø®ØªØ± Ø§Ù„Ø·Ø§ÙˆÙ„Ø©:</h4>
                        <div id="tablesGrid" style="display:flex; gap:10px; overflow-x:auto;"></div>
                    </div>

                    <div class="cats-bar" id="posCats"></div>
                    
                    <div class="products-grid" id="posProducts"></div>
                </div>

                <div class="cart-sec">
                    <div style="display:flex; justify-content:space-between; margin-bottom:10px; border-bottom:1px solid #eee; padding-bottom:10px;">
                        <b id="activeTableLabel">Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø·Ø§ÙˆÙ„Ø©</b>
                        <button onclick="clearCart()" style="color:red;border:none;background:none;cursor:pointer">Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</button>
                    </div>
                    <div id="cartItems" style="flex:1; overflow-y:auto;"></div>
                    <div style="margin-top:auto; padding-top:10px; border-top:2px solid #eee;">
                        <div style="display:flex; justify-content:space-between; font-size:18px; font-weight:bold; margin-bottom:10px;">
                            <span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</span>
                            <span id="cartTotal">0.00 Ø¬</span>
                        </div>
                        <button class="btn-action" style="width:100%; padding:15px; font-size:16px;" onclick="checkout()">
                            <i class="fas fa-print"></i> Ø¥ØªÙ…Ø§Ù… ÙˆØ¯ÙØ¹
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div id="inventory" class="page">
            <div class="panel-header">
                <h2>ğŸ“¦ Ø§Ù„Ù…Ø®Ø²Ù† ÙˆØ§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</h2>
                <button class="btn-action" onclick="openModal('modal_item')">+ Ø¥Ø¶Ø§ÙØ© ØµÙ†Ù / Ø´Ø±Ø§Ø¡</button>
            </div>

            <div class="data-panel">
                <input type="text" id="invSearch" placeholder="Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ø®Ø²Ù†..." class="form-control" onkeyup="renderInventory()" style="margin-bottom:15px;">
                <table>
                    <thead>
                        <tr>
                            <th>Ø§Ù„Ø§Ø³Ù…</th>
                            <th>Ø§Ù„Ù†ÙˆØ¹</th>
                            <th>Ø§Ù„Ø±ØµÙŠØ¯</th>
                            <th>Ù…ØªÙˆØ³Ø· Ø§Ù„ØªÙƒÙ„ÙØ©</th>
                            <th>Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©</th>
                            <th>Ø¥Ø¬Ø±Ø§Ø¡</th>
                        </tr>
                    </thead>
                    <tbody id="inventoryTable"></tbody>
                </table>
            </div>
        </div>

        <div id="expenses" class="page">
            <div class="panel-header">
                <h2>ğŸ’¸ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠØ©</h2>
                <button class="btn-action" onclick="openModal('modal_expense')">+ ØªØ³Ø¬ÙŠÙ„ Ù…ØµØ±ÙˆÙ</button>
            </div>
            
            <div class="cards-grid">
                <div class="card"><h3>Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„ÙŠÙˆÙ…</h3><div class="value" id="exp_today">0 Ø¬</div></div>
                <div class="card"><h3>Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„Ø´Ù‡Ø±</h3><div class="value" id="exp_month">0 Ø¬</div></div>
            </div>

            <div class="data-panel">
                <h3>Ø³Ø¬Ù„ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</h3>
                <table>
                    <thead><tr><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ø¨Ù†Ø¯</th><th>Ø§Ù„Ù‚ÙŠÙ…Ø©</th><th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th></tr></thead>
                    <tbody id="expensesTable"></tbody>
                </table>
            </div>
        </div>

        <div id="recipes" class="page">
            <div class="panel-header">
                <h2>âš™ï¸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø±ÙŠØ³ÙŠØ¨ÙŠ (Ø±Ø¨Ø· Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø¨Ø§Ù„Ù…Ø®Ø²Ù†)</h2>
            </div>
            <div class="data-panel">
                <p style="color:#666; margin-bottom:15px;">Ù‚Ù… Ø¨Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù†ØªØ¬ØŒ Ø«Ù… Ø­Ø¯Ø¯ Ø§Ù„Ø®Ø§Ù…Ø§Øª Ø§Ù„ØªÙŠ ØªÙØ®ØµÙ… Ù…Ù† Ø§Ù„Ù…Ø®Ø²Ù† Ø¹Ù†Ø¯ Ø¨ÙŠØ¹Ù‡.</p>
                <div style="display:flex; gap:10px; margin-bottom:20px;">
                    <select id="recipeProductSelect" class="form-control" onchange="loadRecipe()">
                        <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†ØªØ¬ --</option>
                    </select>
                </div>
                
                <div id="recipeEditor" style="display:none; background:#f9f9f9; padding:15px; border-radius:8px;">
                    <h4>Ù…ÙƒÙˆÙ†Ø§Øª: <span id="currentRecipeName" style="color:var(--primary)"></span></h4>
                    <div id="recipeIngs" style="margin:15px 0;"></div>
                    <button class="btn-action" onclick="addIngRow()" style="background:#7f8c8d; font-size:12px;">+ Ø¥Ø¶Ø§ÙØ© Ù…ÙƒÙˆÙ†</button>
                    <button class="btn-action" onclick="saveRecipe()">Ø­ÙØ¸ Ø§Ù„Ø±ÙŠØ³ÙŠØ¨ÙŠ</button>
                </div>
            </div>
        </div>

        <div id="reports" class="page">
            <div class="panel-header">
                <h2>ğŸ“ˆ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠØ©</h2>
                <div style="display:flex; gap:10px">
                    <input type="date" id="repStart" class="form-control">
                    <input type="date" id="repEnd" class="form-control">
                    <button class="btn-action" onclick="generateReport()">Ø¹Ø±Ø¶</button>
                </div>
            </div>
            <div id="reportResult" class="data-panel" style="display:none">
                <h3 style="text-align:center">ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ ÙˆØ§Ù„Ø®Ø³Ø§Ø¦Ø±</h3>
                <table style="width:100%; margin-top:20px;">
                    <tr><td>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</td><td id="rep_sales" style="font-weight:bold">0</td></tr>
                    <tr><td>ØªÙƒÙ„ÙØ© Ø§Ù„Ø¨Ø¶Ø§Ø¹Ø© (COGS)</td><td id="rep_cogs" style="color:#e67e22">0</td></tr>
                    <tr><td>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</td><td id="rep_exp" style="color:#c0392b">0</td></tr>
                    <tr style="background:#eee; font-size:18px;">
                        <td>ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­</td>
                        <td id="rep_profit" style="font-weight:bold">0</td>
                    </tr>
                </table>
            </div>
        </div>

    </div>

    <div id="modal_item" class="modal">
        <div class="modal-content">
            <h3>Ø¥Ø¶Ø§ÙØ© Ø®Ø§Ù…Ø© / Ù…Ù†ØªØ¬ Ù„Ù„Ù…Ø®Ø²Ù†</h3>
            <div class="form-group">
                <label>Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù</label>
                <input type="text" id="inv_name" class="form-control">
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Ø§Ù„Ù†ÙˆØ¹</label>
                    <select id="inv_type" class="form-control">
                        <option value="raw">Ø®Ø§Ù…Ø© (ØªØ¯Ø®Ù„ ÙÙŠ Ø§Ù„ØªØµÙ†ÙŠØ¹)</option>
                        <option value="ready">Ù…Ù†ØªØ¬ Ø¬Ø§Ù‡Ø² (ÙŠØ¨Ø§Ø¹ Ù…Ø¨Ø§Ø´Ø±Ø©)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Ø§Ù„ÙˆØ­Ø¯Ø©</label>
                    <select id="inv_unit" class="form-control">
                        <option value="gram">Ø¬Ø±Ø§Ù…</option>
                        <option value="ml">Ù…Ù„</option>
                        <option value="piece">Ù‚Ø·Ø¹Ø© / Ø¹Ù„Ø¨Ø©</option>
                        <option value="kg">ÙƒÙŠÙ„Ùˆ</option>
                    </select>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø¶Ø§ÙØ©</label>
                    <input type="number" id="inv_qty" class="form-control">
                </div>
                <div class="form-group">
                    <label>Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡ (Ù„Ù„ÙƒÙ…ÙŠØ© ÙƒÙ„Ù‡Ø§)</label>
                    <input type="number" id="inv_cost" class="form-control">
                </div>
            </div>
            <div style="display:flex; justify-content:flex-end; gap:10px; margin-top:15px;">
                <button class="btn-action" style="background:#95a5a6" onclick="closeModal()">Ø¥Ù„ØºØ§Ø¡</button>
                <button class="btn-action" onclick="saveInventory()">Ø­ÙØ¸</button>
            </div>
        </div>
    </div>

    <div id="modal_expense" class="modal">
        <div class="modal-content">
            <h3>ØªØ³Ø¬ÙŠÙ„ Ù…ØµØ±ÙˆÙ Ø¬Ø¯ÙŠØ¯</h3>
            <div class="form-group">
                <label>Ø¨Ù†Ø¯ Ø§Ù„Ù…ØµØ±ÙˆÙ</label>
                <input type="text" id="exp_title" class="form-control" placeholder="Ù…Ø«Ø§Ù„: ÙØ§ØªÙˆØ±Ø© ÙƒÙ‡Ø±Ø¨Ø§Ø¡">
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Ø§Ù„Ù‚ÙŠÙ…Ø©</label>
                    <input type="number" id="exp_amount" class="form-control">
                </div>
                <div class="form-group">
                    <label>Ø§Ù„Ù†ÙˆØ¹</label>
                    <select id="exp_cat" class="form-control">
                        <option value="fixed">Ø«Ø§Ø¨Øª (Ø¥ÙŠØ¬Ø§Ø±/Ø±ÙˆØ§ØªØ¨)</option>
                        <option value="variable">Ù…ØªØºÙŠØ± (ØµÙŠØ§Ù†Ø©/Ù†Ø«Ø±ÙŠØ§Øª)</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
                <input type="text" id="exp_note" class="form-control">
            </div>
            <div style="display:flex; justify-content:flex-end; gap:10px; margin-top:15px;">
                <button class="btn-action" style="background:#95a5a6" onclick="closeModal()">Ø¥Ù„ØºØ§Ø¡</button>
                <button class="btn-action" onclick="saveExpense()">Ø­ÙØ¸</button>
            </div>
        </div>
    </div>

    <div id="receipt-area" style="display:none; width:78mm; text-align:center; font-family:'Courier New';">
        <div style="border-bottom:1px dashed #000; padding-bottom:10px; margin-bottom:10px;">
            <img src="assets/images/logo.png" style="width:60px; filter:grayscale(100%)"><br>
            <h3 style="margin:5px 0">NEO CAFE</h3>
            <p style="font-size:12px; margin:0">Ø±Ù…Ø¶Ø§Ù† ÙƒØ±ÙŠÙ…</p>
            <p id="print_date" style="font-size:10px;"></p>
            <p id="print_id" style="font-weight:bold"></p>
        </div>
        <table style="width:100%; font-size:12px; border-collapse:collapse;">
            <thead><tr style="border-bottom:1px dashed #000"><th>Ø§Ù„ØµÙ†Ù</th><th>Ø¹</th><th>Ø³</th></tr></thead>
            <tbody id="print_items"></tbody>
        </table>
        <div style="border-top:1px dashed #000; margin-top:10px; padding-top:5px; font-weight:bold; font-size:14px;">
            Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <span id="print_total"></span> Ø¬
        </div>
        <p style="font-size:10px; margin-top:15px;">Ø´Ø±ÙØªÙ†Ø§ ÙŠØ§ Ø¨ÙˆØ¨!</p>
    </div>

<script>
/* ==================== 1. DATA STORE & INIT ==================== */
const DB = {
    // Menu Data (Static for now, can be editable)
    menu: {
        ramadan: { title: 'Ø±Ù…Ø¶Ø§Ù†', items: [{id:'r1',name:'Ø±Ø² Ø¨Ù„Ø¨Ù† Ù…ÙƒØ³Ø±Ø§Øª',price:40}, {id:'r2',name:'Ø±Ø² Ø¨Ù„Ø¨Ù† Ù†ÙˆØªÙŠÙ„Ø§',price:55}, {id:'r3',name:'ÙƒÙ†Ø§ÙØ© Ù„ÙˆØªØ³',price:85}] },
        hot: { title: 'Ø³Ø§Ø®Ù†', items: [{id:'h1',name:'Ø´Ø§ÙŠ',price:15}, {id:'h2',name:'Ù„Ø§ØªÙŠÙ‡',price:50}, {id:'h3',name:'Ø§Ø³Ø¨Ø±ÙŠØ³Ùˆ',price:35}] },
        cold: { title: 'Ø¨Ø§Ø±Ø¯', items: [{id:'c1',name:'Ø§ÙŠØ³ Ù„Ø§ØªÙŠÙ‡',price:50}, {id:'c2',name:'Ù…ÙŠÙ„Ùƒ Ø´ÙŠÙƒ',price:55}] },
        soft: { title: 'Ø³ÙˆÙØª', items: [{id:'s1',name:'ÙƒØ§Ù†Ø²',price:20}, {id:'s2',name:'Ù…ÙŠØ§Ù‡',price:10}] }
    },
    // LocalStorage Keys
    keys: { inv: 'neo_inv', exp: 'neo_exp', sales: 'neo_sales', recipes: 'neo_recipes' },
    
    getData: (key) => JSON.parse(localStorage.getItem(key)) || [],
    saveData: (key, data) => localStorage.setItem(key, JSON.stringify(data))
};

// Global State
let currentTable = null;
let tablesOrder = {}; 

function init() {
    document.getElementById('currentDate').textContent = new Date().toLocaleDateString('ar-EG', {weekday:'long', year:'numeric', month:'long', day:'numeric'});
    updateDashboard();
    renderTables();
    renderPOSMenu('ramadan');
    renderInventory();
    renderExpenses();
    setupRecipeSelect();
}

/* ==================== 2. NAVIGATION ==================== */
function nav(pageId) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.getElementById(pageId).classList.add('active');
    document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
    event.currentTarget.classList.add('active');
    
    // Auto Refresh Data
    if(pageId === 'dashboard') updateDashboard();
    if(pageId === 'inventory') renderInventory();
    if(pageId === 'expenses') renderExpenses();
}

function openModal(id) { document.getElementById(id).classList.add('open'); }
function closeModal() { document.querySelectorAll('.modal').forEach(m => m.classList.remove('open')); }

/* ==================== 3. INVENTORY SYSTEM ==================== */
function saveInventory() {
    const name = document.getElementById('inv_name').value;
    const type = document.getElementById('inv_type').value;
    const unit = document.getElementById('inv_unit').value;
    const qty = parseFloat(document.getElementById('inv_qty').value) || 0;
    const cost = parseFloat(document.getElementById('inv_cost').value) || 0;

    if(!name || qty <= 0) return alert('Ø¨Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª ØµØ­ÙŠØ­Ø©');

    const inv = DB.getData(DB.keys.inv);
    const existing = inv.find(i => i.name === name);

    if (existing) {
        // Weighted Average Cost Formula: ((OldQty * OldAvg) + (NewQty * NewPrice)) / TotalQty
        const oldVal = existing.stock * existing.avgCost;
        const newVal = cost; // Total cost of new batch
        existing.stock += qty;
        existing.avgCost = (oldVal + newVal) / existing.stock;
    } else {
        inv.push({
            id: 'inv_' + Date.now(),
            name, type, unit,
            stock: qty,
            avgCost: cost / qty // Cost per unit
        });
    }

    DB.saveData(DB.keys.inv, inv);
    closeModal();
    renderInventory();
    setupRecipeSelect(); // Refresh dropdowns
}

function renderInventory() {
    const inv = DB.getData(DB.keys.inv);
    const tbody = document.getElementById('inventoryTable');
    tbody.innerHTML = inv.map(i => `
        <tr>
            <td>${i.name}</td>
            <td><span class="status-badge ${i.type=='raw'?'bg-ok':'bg-low'}">${i.type=='raw'?'Ø®Ø§Ù…Ø©':'Ø¬Ø§Ù‡Ø²'}</span></td>
            <td style="font-weight:bold; color:${i.stock<10?'red':'inherit'}">${i.stock.toFixed(1)} ${i.unit}</td>
            <td>${i.avgCost.toFixed(2)} Ø¬</td>
            <td>${(i.stock * i.avgCost).toFixed(2)} Ø¬</td>
            <td><button onclick="deleteInv('${i.id}')" style="color:red;border:none;background:none">X</button></td>
        </tr>
    `).join('');
    
    // Update Low Stock Table in Dashboard
    const lowStock = inv.filter(i => i.stock <= 10); // Threshold 10
    document.getElementById('lowStockTable').innerHTML = lowStock.map(i => 
        `<tr><td>${i.name}</td><td style="color:red">${i.stock}</td><td>10</td></tr>`
    ).join('');
}

function deleteInv(id) {
    if(confirm('Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØµÙ†ÙØŸ')) {
        const inv = DB.getData(DB.keys.inv).filter(i => i.id !== id);
        DB.saveData(DB.keys.inv, inv);
        renderInventory();
    }
}

/* ==================== 4. RECIPE SYSTEM (THE CORE) ==================== */
function setupRecipeSelect() {
    // Populate Products Dropdown
    const sel = document.getElementById('recipeProductSelect');
    sel.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†ØªØ¬ --</option>';
    let allProds = [];
    Object.keys(DB.menu).forEach(k => allProds.push(...DB.menu[k].items));
    allProds.forEach(p => {
        sel.innerHTML += `<option value="${p.id}">${p.name}</option>`;
    });
}

function loadRecipe() {
    const pid = document.getElementById('recipeProductSelect').value;
    if(!pid) { document.getElementById('recipeEditor').style.display='none'; return; }
    
    document.getElementById('recipeEditor').style.display='block';
    const prodName = document.querySelector(`#recipeProductSelect option[value="${pid}"]`).text;
    document.getElementById('currentRecipeName').textContent = prodName;
    
    const recipes = DB.getData(DB.keys.recipes);
    const myRecipe = recipes[pid] || [];
    renderRecipeIngs(myRecipe);
}

function renderRecipeIngs(ings) {
    const container = document.getElementById('recipeIngs');
    const inv = DB.getData(DB.keys.inv);
    
    container.innerHTML = '';
    ings.forEach((ing, idx) => {
        const row = document.createElement('div');
        row.style.cssText = 'display:flex; gap:10px; margin-bottom:5px';
        
        let opts = inv.map(i => `<option value="${i.id}" ${i.id===ing.invId?'selected':''}>${i.name} (${i.unit})</option>`).join('');
        
        row.innerHTML = `
            <select class="form-control ing-select">${opts}</select>
            <input type="number" class="form-control ing-qty" value="${ing.qty}" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©" style="width:100px">
            <button onclick="this.parentElement.remove()" style="color:red;border:none;background:none">X</button>
        `;
        container.appendChild(row);
    });
}

function addIngRow() {
    renderRecipeIngs([...getRecipeFromDOM(), {invId:'', qty:0}]);
}

function getRecipeFromDOM() {
    const rows = document.querySelectorAll('#recipeIngs > div');
    return Array.from(rows).map(row => ({
        invId: row.querySelector('.ing-select').value,
        qty: parseFloat(row.querySelector('.ing-qty').value)
    }));
}

function saveRecipe() {
    const pid = document.getElementById('recipeProductSelect').value;
    const newRecipe = getRecipeFromDOM();
    const recipes = DB.getData(DB.keys.recipes);
    
    // Auto-link logic for "Ready Items"
    // If user adds a recipe, it's saved. If not, we assume manual deduction later? No, stick to recipe.
    recipes[pid] = newRecipe;
    DB.saveData(DB.keys.recipes, recipes);
    alert('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø±ÙŠØ³ÙŠØ¨ÙŠ Ø¨Ù†Ø¬Ø§Ø­');
}

/* ==================== 5. POS SYSTEM ==================== */
function renderTables() {
    const grid = document.getElementById('tablesGrid');
    grid.innerHTML = '';
    for(let i=1; i<=10; i++) {
        const btn = document.createElement('button');
        btn.className = `btn-action ${currentTable===i?'active':''}`;
        btn.style.background = tablesOrder[i] && tablesOrder[i].length ? '#e74c3c' : (currentTable===i?'#d4af37':'#fff');
        btn.style.color = tablesOrder[i] && tablesOrder[i].length ? '#fff' : '#000';
        btn.style.border = '1px solid #ccc';
        btn.style.minWidth = '80px';
        btn.textContent = `T-${i}`;
        btn.onclick = () => { currentTable=i; renderCart(); renderTables(); document.getElementById('activeTableLabel').textContent = `Ø·Ø§ÙˆÙ„Ø© Ø±Ù‚Ù… ${i}`; };
        grid.appendChild(btn);
    }
}

function renderPOSMenu(catKey) {
    // Cats
    const catContainer = document.getElementById('posCats');
    catContainer.innerHTML = Object.keys(DB.menu).map(k => 
        `<div class="cat-chip ${k===catKey?'active':''}" onclick="renderPOSMenu('${k}')">${DB.menu[k].title}</div>`
    ).join('');

    // Prods
    const prodContainer = document.getElementById('posProducts');
    prodContainer.innerHTML = DB.menu[catKey].items.map(p => `
        <div class="prod-card" onclick="addToCart('${p.id}', '${p.name}', ${p.price})">
            <div style="font-weight:bold;font-size:14px">${p.name}</div>
            <div style="color:var(--primary);font-weight:800">${p.price} Ø¬</div>
        </div>
    `).join('');
}

function addToCart(id, name, price) {
    if(!currentTable) return alert('Ø§Ø®ØªØ§Ø± Ø§Ù„Ø·Ø§ÙˆÙ„Ø© Ø§Ù„Ø£ÙˆÙ„ ÙŠØ§ Ø¨ÙˆØ¨!');
    if(!tablesOrder[currentTable]) tablesOrder[currentTable] = [];
    
    const existing = tablesOrder[currentTable].find(i => i.id === id);
    if(existing) existing.qty++;
    else tablesOrder[currentTable].push({id, name, price, qty:1});
    
    renderCart(); renderTables();
}

function renderCart() {
    const cart = tablesOrder[currentTable] || [];
    document.getElementById('cartItems').innerHTML = cart.map((i, idx) => `
        <div style="display:flex; justify-content:space-between; padding:8px 0; border-bottom:1px dashed #eee;">
            <div>${i.name} <small>x${i.qty}</small></div>
            <div style="display:flex; align-items:center; gap:5px;">
                <b>${i.price * i.qty}</b>
                <i class="fas fa-trash" style="color:red; cursor:pointer" onclick="updateCart(${idx}, 0)"></i>
            </div>
        </div>
    `).join('');
    
    const total = cart.reduce((a,b)=> a + (b.price*b.qty), 0);
    document.getElementById('cartTotal').textContent = total.toFixed(2) + ' Ø¬';
}

function updateCart(idx, qty) {
    if(qty === 0) tablesOrder[currentTable].splice(idx, 1);
    renderCart(); renderTables();
}

function clearCart() {
    if(currentTable) { tablesOrder[currentTable] = []; renderCart(); renderTables(); }
}

function checkout() {
    if(!currentTable || !tablesOrder[currentTable]?.length) return;
    
    const cart = tablesOrder[currentTable];
    const total = cart.reduce((a,b)=> a + (b.price*b.qty), 0);
    let totalCost = 0;
    
    // 1. Calculate Cost & Deduct Inventory (Recipe Logic)
    const recipes = DB.getData(DB.keys.recipes);
    const inv = DB.getData(DB.keys.inv);
    let stockAlert = [];

    cart.forEach(item => {
        const itemRecipe = recipes[item.id];
        if(itemRecipe) {
            // It has a recipe (Raw Materials)
            itemRecipe.forEach(comp => {
                const invItem = inv.find(i => i.id === comp.invId);
                if(invItem) {
                    const deduct = comp.qty * item.qty;
                    invItem.stock -= deduct;
                    totalCost += (invItem.avgCost * deduct);
                    if(invItem.stock < 0) stockAlert.push(invItem.name);
                }
            });
        } else {
            // No Recipe? Maybe it's a Ready Product (Check Inventory by Name match or manual ID link)
            // For simplicity in this version: We warn if no recipe found for tracking cost.
            // Or assume 0 cost if not defined.
        }
    });

    DB.saveData(DB.keys.inv, inv); // Update Stock

    // 2. Save Sale
    const sale = {
        id: Date.now(),
        date: new Date().toISOString(),
        items: cart,
        total: total,
        cost: totalCost,
        profit: total - totalCost
    };
    const sales = DB.getData(DB.keys.sales);
    sales.push(sale);
    DB.saveData(DB.keys.sales, sales);

    // 3. Print
    document.getElementById('print_date').textContent = new Date().toLocaleString();
    document.getElementById('print_id').textContent = '#' + sale.id.toString().slice(-6);
    document.getElementById('print_items').innerHTML = cart.map(i => `<tr><td>${i.name}</td><td>${i.qty}</td><td>${i.price}</td></tr>`).join('');
    document.getElementById('print_total').textContent = total;
    window.print();

    // 4. Reset
    if(stockAlert.length) alert('ØªØ­Ø°ÙŠØ±: Ø§Ù„Ø£Ø±ØµØ¯Ø© Ø§Ù„ØªØ§Ù„ÙŠØ© Ø¨Ø§Ù„Ø³Ø§Ù„Ø¨: ' + stockAlert.join(', '));
    tablesOrder[currentTable] = [];
    renderCart(); renderTables(); updateDashboard();
}

/* ==================== 6. EXPENSES SYSTEM ==================== */
function saveExpense() {
    const title = document.getElementById('exp_title').value;
    const amount = parseFloat(document.getElementById('exp_amount').value) || 0;
    const cat = document.getElementById('exp_cat').value;
    const note = document.getElementById('exp_note').value;

    if(!title || amount <= 0) return alert('Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ø§Ù‚ØµØ©');

    const exp = DB.getData(DB.keys.exp);
    exp.push({ id: Date.now(), date: new Date().toISOString(), title, amount, cat, note });
    DB.saveData(DB.keys.exp, exp);
    
    closeModal();
    renderExpenses();
}

function renderExpenses() {
    const exp = DB.getData(DB.keys.exp);
    const tbody = document.getElementById('expensesTable');
    tbody.innerHTML = exp.slice(-10).map(e => `
        <tr>
            <td>${new Date(e.date).toLocaleDateString()}</td>
            <td>${e.title} <span class="status-badge bg-low">${e.cat}</span></td>
            <td style="color:red;font-weight:bold">-${e.amount}</td>
            <td>${e.note}</td>
        </tr>
    `).join('');

    // Calc Stats
    const today = new Date().toISOString().split('T')[0];
    const todayExp = exp.filter(e => e.date.startsWith(today)).reduce((a,b)=>a+b.amount,0);
    document.getElementById('exp_today').textContent = todayExp + ' Ø¬';
}

/* ==================== 7. DASHBOARD LOGIC ==================== */
function updateDashboard() {
    const sales = DB.getData(DB.keys.sales);
    const exps = DB.getData(DB.keys.exp);
    const today = new Date().toISOString().split('T')[0];

    const todaySales = sales.filter(s => s.date.startsWith(today));
    const todayExp = exps.filter(e => e.date.startsWith(today)).reduce((a,b)=>a+b.amount,0);

    const totalRev = todaySales.reduce((a,b)=>a+b.total, 0);
    const totalCost = todaySales.reduce((a,b)=>a+(b.cost||0), 0);
    const netProfit = totalRev - totalCost - todayExp;

    document.getElementById('dash_sales').textContent = totalRev + ' Ø¬';
    document.getElementById('dash_orders').textContent = todaySales.length;
    document.getElementById('dash_cogs').textContent = totalCost.toFixed(1) + ' Ø¬';
    document.getElementById('dash_expenses').textContent = todayExp + ' Ø¬';
    document.getElementById('dash_profit').textContent = netProfit.toFixed(1) + ' Ø¬';

    // Chart
    const ctx = document.getElementById('salesChart').getContext('2d');
    // Simple mock chart for visual
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: ['9am', '12pm', '3pm', '6pm', '9pm', '12am'],
            datasets: [{
                label: 'Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…',
                data: [0, totalRev*0.2, totalRev*0.5, totalRev*0.8, totalRev],
                borderColor: '#124d33',
                tension: 0.4
            }]
        }
    });
}

/* ==================== 8. REPORTS ==================== */
function generateReport() {
    const start = document.getElementById('repStart').value;
    const end = document.getElementById('repEnd').value;
    if(!start || !end) return alert('Ø­Ø¯Ø¯ Ø§Ù„ÙØªØ±Ø©');

    const sales = DB.getData(DB.keys.sales).filter(s => s.date >= start && s.date <= end + 'T23:59:59');
    const exps = DB.getData(DB.keys.exp).filter(e => e.date >= start && e.date <= end + 'T23:59:59');

    const tSales = sales.reduce((a,b)=>a+b.total, 0);
    const tCogs = sales.reduce((a,b)=>a+(b.cost||0), 0);
    const tExp = exps.reduce((a,b)=>a+b.amount, 0);

    document.getElementById('reportResult').style.display='block';
    document.getElementById('rep_sales').textContent = tSales + ' Ø¬';
    document.getElementById('rep_cogs').textContent = tCogs + ' Ø¬';
    document.getElementById('rep_exp').textContent = tExp + ' Ø¬';
    document.getElementById('rep_profit').textContent = (tSales - tCogs - tExp).toFixed(2) + ' Ø¬';
}

// Start
init();
</script>
</body>
</html>
