<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEO ERP - Admin & POS</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* ================== Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ================== */
        :root {
            --primary: #124d33;       /* Ø£Ø®Ø¶Ø± Ù†ÙŠÙˆ ÙƒØ§ÙÙŠÙ‡ */
            --primary-dark: #0a2e1e;
            --secondary: #d4af37;     /* Ø°Ù‡Ø¨ÙŠ */
            --gold-light: #fdfbf7;    /* Ø°Ù‡Ø¨ÙŠ ÙØ§ØªØ­ Ø¬Ø¯Ø§Ù‹ Ù„Ù„Ø®Ù„ÙÙŠØ§Øª */
            --bg: #f4f6f9;            /* Ù„ÙˆÙ† Ø®Ù„ÙÙŠØ© Ø§Ù„Ù†Ø¸Ø§Ù… */
            --white: #ffffff;
            --text: #2d3436;
            --danger: #e74c3c;        /* Ø£Ø­Ù…Ø± Ù„Ù„Ù…Ø´ØºÙˆÙ„ ÙˆØ§Ù„Ù…Ø­Ø°ÙˆÙØ§Øª */
            --success: #27ae60;       /* Ø£Ø®Ø¶Ø± Ù„Ù„Ù†Ø¬Ø§Ø­ */
            --border: #e2e8f0;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Cairo', sans-serif; outline: none; }
        body { background: var(--bg); color: var(--text); display: flex; height: 100vh; overflow: hidden; }

        /* ================== Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© (Sidebar) ================== */
        .sidebar { width: 260px; background: var(--primary-dark); color: var(--white); display: flex; flex-direction: column; z-index: 100; box-shadow: 2px 0 10px rgba(0,0,0,0.1); }
        .brand { padding: 20px; text-align: center; background: var(--primary); border-bottom: 3px solid var(--secondary); }
        .brand h2 { margin: 0; font-weight: 900; color: var(--secondary); letter-spacing: 1px; }
        .brand p { font-size: 12px; opacity: 0.8; margin-top: 5px; }
        
        .nav-links { flex: 1; padding: 15px; overflow-y: auto; }
        .nav-btn { display: flex; align-items: center; gap: 12px; width: 100%; padding: 14px 15px; background: transparent; border: none; color: #ecf0f1; text-align: right; font-size: 15px; cursor: pointer; border-radius: 8px; margin-bottom: 8px; transition: 0.2s; font-weight: 600; }
        .nav-btn i { font-size: 18px; width: 20px; text-align: center; }
        .nav-btn:hover, .nav-btn.active { background: rgba(212, 175, 55, 0.15); color: var(--secondary); border-right: 4px solid var(--secondary); }
        
        .user-panel { padding: 15px; background: rgba(0,0,0,0.3); font-size: 13px; text-align: center; color: var(--secondary); }

        /* ================== Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ================== */
        .main-content { flex: 1; padding: 15px; overflow-y: auto; position: relative; }
        .page { display: none; animation: fadeIn 0.3s ease; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* ================== 1. Ø´Ø§Ø´Ø© Ø§Ù„ÙƒØ§Ø´ÙŠØ± (POS) ================== */
        .pos-layout { display: flex; gap: 15px; height: calc(100vh - 30px); }
        .menu-sec { flex: 2; display: flex; flex-direction: column; overflow: hidden; gap: 10px; }
        .cart-sec { flex: 1; background: var(--white); border-radius: 12px; padding: 15px; display: flex; flex-direction: column; box-shadow: 0 4px 15px rgba(0,0,0,0.05); border: 1px solid var(--border); }

        /* --- Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø·Ø§ÙˆÙ„Ø§Øª (Ø§Ù„Ù…Ù‚Ù„ÙˆØ¨Ø© ÙˆØ§Ù„Ù…Ù†Ø³Ù‚Ø©) --- */
        .map-container {
            background: #e8e8e8; border: 4px solid #555; border-radius: 12px;
            padding: 15px; overflow-x: auto; overflow-y: auto;
            direction: ltr; display: flex; justify-content: center;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.1);
        }
        .cafe-grid {
            display: grid;
            grid-template-columns: 100px 60px 100px; /* ÙŠØ³Ø§Ø± - Ù…Ù…Ø± - ÙŠÙ…ÙŠÙ† */
            grid-template-rows: repeat(9, 65px); 
            gap: 12px;
            /* Ø§Ù„ØªØ±ØªÙŠØ¨: Ø§Ù„Ø´Ø§Ø±Ø¹ ÙÙˆÙ‚ØŒ Ø§Ù„ÙƒØ§Ø´ÙŠØ± ØªØ­ØªØŒ Ø¨Ø¯ÙˆÙ† 9 Ùˆ 10 */
            grid-template-areas:
                "out_l    .      out_r"
                ".        .      ."
                "bar_b    door   ."
                "t5       .      bar_s"
                "t4       .      t6"
                "t3       .      t7"
                "t2       .      t8"
                "t1       .      ."
                "cashier  .      .";
        }

        .table-card {
            background: var(--gold-light); border: 2px solid var(--secondary); color: #8a6d3b;
            border-radius: 10px; cursor: pointer; display: flex; flex-direction: column;
            align-items: center; justify-content: center; font-weight: 800; font-size: 14px;
            box-shadow: 0 3px 0 rgba(212, 175, 55, 0.4); transition: 0.15s; position: relative;
        }
        .table-card:active { transform: translateY(3px); box-shadow: none; }
        
        .table-card.selected { background: var(--primary) !important; color: white !important; border-color: var(--primary-dark) !important; box-shadow: 0 0 0 3px rgba(18,77,51,0.3); }
        .table-card.occupied { background: var(--danger) !important; color: white !important; border-color: #a93226 !important; box-shadow: 0 3px 0 #a93226; }

        .obj-cashier { grid-area: cashier; background: #2c3e50; color: #fff; display: flex; align-items: center; justify-content: center; border-radius: 8px; font-size: 13px; font-weight: bold; }
        .obj-door { grid-area: door; border-top: 5px solid #333; display: flex; align-items: start; justify-content: center; font-size: 12px; color: #555; font-weight: bold; padding-top: 5px; }

        #tbl_1 { grid-area: t1; } #tbl_2 { grid-area: t2; } #tbl_3 { grid-area: t3; } #tbl_4 { grid-area: t4; } #tbl_5 { grid-area: t5; }
        #tbl_6 { grid-area: t6; } #tbl_7 { grid-area: t7; } #tbl_8 { grid-area: t8; }
        #tbl_11 { grid-area: bar_s; border-radius: 50%; } /* Ø¨Ø§Ø± ØµØºÙŠØ± */
        #tbl_12 { grid-area: bar_b; width: 140%; z-index: 2; } /* Ø¨Ø§Ø± ÙƒØ¨ÙŠØ± */
        #tbl_13 { grid-area: out_r; background: #bdc3c7; border-color: #95a5a6; color: #333; } /* Ø´Ø§Ø±Ø¹ ÙŠÙ…ÙŠÙ† */
        #tbl_14 { grid-area: out_l; background: #bdc3c7; border-color: #95a5a6; color: #333; } /* Ø´Ø§Ø±Ø¹ Ø´Ù…Ø§Ù„ */

        .table-total { font-size: 11px; background: rgba(0,0,0,0.3); color: white; padding: 2px 6px; border-radius: 6px; margin-top: 3px; font-weight: normal; }

        /* --- Ø§Ù„Ø£Ù‚Ø³Ø§Ù… ÙˆØ§Ù„Ù…Ù†ØªØ¬Ø§Øª --- */
        .cats-bar { display: flex; flex-wrap: wrap; gap: 8px; padding: 5px 0; }
        .cat-chip { padding: 10px 15px; background: var(--white); border: 1px solid var(--border); border-radius: 12px; cursor: pointer; font-weight: 800; font-size: 13px; color: var(--primary); display: flex; align-items: center; gap: 6px; transition: 0.2s; flex-grow: 1; justify-content: center; box-shadow: 0 2px 5px rgba(0,0,0,0.02); }
        .cat-chip:hover { border-color: var(--secondary); transform: translateY(-2px); }
        .cat-chip.active { background: var(--primary); color: white; border-color: var(--primary); box-shadow: 0 4px 10px rgba(18,77,51,0.2); }
        
        .sub-cats-bar { display: none; gap: 8px; margin-bottom: 5px; overflow-x: auto; padding-bottom: 5px; }
        .sub-cats-bar.show { display: flex; }
        .sub-cat-chip { padding: 6px 15px; background: #e2e8f0; border-radius: 20px; font-size: 12px; font-weight: 700; cursor: pointer; color: #475569; white-space: nowrap; transition: 0.2s; }
        .sub-cat-chip.active { background: var(--secondary); color: white; }

        .products-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap: 12px; overflow-y: auto; padding: 5px; align-content: start; flex: 1; }
        .prod-card { background: var(--white); border-radius: 12px; padding: 12px 10px; text-align: center; cursor: pointer; border: 1px solid var(--border); transition: 0.2s; display: flex; flex-direction: column; justify-content: space-between; min-height: 90px; box-shadow: 0 2px 5px rgba(0,0,0,0.02); }
        .prod-card:hover { border-color: var(--secondary); transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.08); }
        .prod-name { font-weight: 800; font-size: 13px; line-height: 1.4; color: var(--text); margin-bottom: 5px; }
        .prod-price { color: var(--primary); font-weight: 900; font-size: 14px; background: #f0fdf4; padding: 3px 10px; border-radius: 8px; align-self: center; }

        /* --- Ø³Ù„Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª (Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©) --- */
        .cart-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid var(--border); padding-bottom: 15px; margin-bottom: 10px; }
        .active-table-badge { background: var(--gold-light); color: var(--primary); padding: 8px 15px; border-radius: 8px; font-weight: 900; font-size: 15px; border: 1px solid var(--secondary); }
        .clear-btn { color: var(--danger); background: #fdecea; border: none; padding: 8px 12px; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .clear-btn:hover { background: var(--danger); color: white; }
        
        .cart-items { flex: 1; overflow-y: auto; padding-right: 5px; }
        .cart-item { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px dashed var(--border); }
        .item-info { flex: 2; font-weight: 700; font-size: 14px; }
        .qty-controls { display: flex; align-items: center; gap: 8px; background: var(--bg); padding: 4px; border-radius: 8px; }
        .qty-btn { width: 28px; height: 28px; border-radius: 6px; border: none; cursor: pointer; font-weight: bold; font-size: 16px; display: flex; align-items: center; justify-content: center; transition: 0.2s; }
        .qty-btn.inc { background: var(--success); color: white; }
        .qty-btn.dec { background: #cbd5e1; color: #333; }
        .qty-btn:active { transform: scale(0.9); }
        .item-total { flex: 1; text-align: left; font-weight: 900; color: var(--primary); font-size: 15px; }

        .cart-footer { margin-top: auto; padding-top: 15px; border-top: 2px solid var(--border); }
        .total-row { display: flex; justify-content: space-between; font-size: 22px; font-weight: 900; color: var(--primary-dark); margin-bottom: 15px; }
        .btn-checkout { width: 100%; padding: 15px; background: var(--primary); color: white; border: none; border-radius: 10px; font-weight: 900; font-size: 18px; cursor: pointer; display: flex; justify-content: center; gap: 10px; align-items: center; transition: 0.2s; box-shadow: 0 4px 15px rgba(18,77,51,0.3); }
        .btn-checkout:hover { background: var(--primary-dark); transform: translateY(-2px); }

        /* ================== ØªØµÙ…ÙŠÙ… Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„Ø£Ø®Ø±Ù‰ ================== */
        .data-panel { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.03); margin-bottom: 20px; border: 1px solid var(--border); }
        .panel-title { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 2px solid var(--bg); padding-bottom: 15px; }
        .panel-title h2 { font-size: 20px; color: var(--primary-dark); margin: 0; }
        
        .btn-action { padding: 10px 20px; background: var(--primary); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 14px; transition: 0.2s; }
        .btn-action:hover { background: var(--primary-dark); }

        table { width: 100%; border-collapse: collapse; font-size: 14px; }
        th { text-align: right; padding: 12px; background: var(--bg); color: var(--primary); border-bottom: 2px solid var(--border); font-weight: 800; }
        td { padding: 12px; border-bottom: 1px solid var(--border); font-weight: 600; color: #475569; }
        .form-control { width: 100%; padding: 10px; border: 1px solid #cbd5e1; border-radius: 8px; margin-bottom: 15px; font-size: 14px; font-family: 'Cairo'; }
        .form-control:focus { border-color: var(--secondary); }

        /* ================== Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ (Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©) ================== */
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 200; align-items: center; justify-content: center; backdrop-filter: blur(3px); }
        .modal.open { display: flex; animation: fadeIn 0.2s; }
        .modal-content { background: white; width: 450px; padding: 25px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .modal h3 { margin-top: 0; margin-bottom: 20px; color: var(--primary); border-bottom: 2px solid var(--bg); padding-bottom: 10px; }

        /* ================== ØªØµÙ…ÙŠÙ… Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ù„Ù„Ø·Ø¨Ø§Ø¹Ø© (THERMAL 80mm) ================== */
        #receipt-area { display: none; }
        
        @media print {
            @page { margin: 0; size: 80mm auto; }
            body * { visibility: hidden; }
            body { background: #fff; margin: 0; padding: 0; }
            
            #receipt-area, #receipt-area * { visibility: visible; }
            #receipt-area {
                position: absolute; left: 0; top: 0; width: 78mm;
                padding: 5mm; color: #000; font-family: 'Cairo', sans-serif;
                display: block !important;
            }
            
            .r-header { text-align: center; margin-bottom: 10px; border-bottom: 1px dashed #000; padding-bottom: 10px; }
            .r-header img { width: 65px; height: 65px; object-fit: contain; filter: grayscale(100%); margin-bottom: 5px; }
            .r-header h2 { font-size: 24px; margin: 0; font-weight: 900; letter-spacing: 1px; }
            .r-slogan { border: 1px solid #000; border-radius: 15px; padding: 3px 10px; font-size: 11px; font-weight: bold; margin: 5px auto; display: inline-block; }
            
            .r-meta { font-size: 12px; margin-bottom: 10px; border-bottom: 1px dashed #000; padding-bottom: 10px; display: grid; grid-template-columns: 1fr 1fr; gap: 4px; font-weight: bold; }
            .r-meta div { display: flex; justify-content: space-between; }
            .r-meta .full { grid-column: 1 / -1; }
            
            .r-table { width: 100%; font-size: 12px; border-collapse: collapse; margin-bottom: 10px; }
            .r-table th { border-bottom: 1px solid #000; padding: 4px 0; font-weight: 900; text-align: center; }
            .r-table th:first-child { text-align: right; }
            .r-table td { padding: 5px 0; border-bottom: 1px dotted #aaa; text-align: center; font-weight: bold; }
            .r-table td:first-child { text-align: right; }
            
            .r-total-sec { border-top: 1px dashed #000; border-bottom: 2px solid #000; padding: 8px 0; margin-top: 5px; display: flex; justify-content: space-between; font-size: 18px; font-weight: 900; }
            
            .r-footer { text-align: center; font-size: 11px; margin-top: 15px; font-weight: bold; line-height: 1.6; }
        }
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="brand">
            <h2>NEO ERP</h2>
            <p>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù‚Ù‡Ù‰</p>
        </div>
        <div class="nav-links">
            <button class="nav-btn active" onclick="nav('pos')"><i class="fas fa-desktop"></i> Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹ (POS)</button>
            <button class="nav-btn" onclick="nav('dashboard')"><i class="fas fa-chart-line"></i> Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</button>
            <button class="nav-btn" onclick="nav('inventory')"><i class="fas fa-boxes"></i> Ø§Ù„Ù…Ø®Ø²Ù†</button>
            <button class="nav-btn" onclick="nav('recipes')"><i class="fas fa-blender"></i> Ø§Ù„ØªÙƒÙ„ÙØ© (Recipe)</button>
            <button class="nav-btn" onclick="nav('expenses')"><i class="fas fa-money-bill-wave"></i> Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</button>
            <button class="nav-btn" onclick="nav('reports')"><i class="fas fa-file-invoice-dollar"></i> Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</button>
        </div>
        <div class="user-panel"><i class="fas fa-user-circle"></i> Ø§Ù„ÙƒØ§Ø´ÙŠØ±: Admin</div>
    </div>

    <div class="main-content">

        <div id="pos" class="page active">
            <div class="pos-layout">
                <div class="menu-sec">
                    <div class="map-container">
                        <div class="cafe-grid" id="cafeMap">
                            </div>
                    </div>

                    <div id="posCats" class="cats-bar"></div>
                    <div id="posSubCats" class="sub-cats-bar"></div>
                    
                    <div id="posProducts" class="products-grid"></div>
                </div>

                <div class="cart-sec">
                    <div class="cart-header">
                        <span id="activeTableLabel" class="active-table-badge">Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø·Ø§ÙˆÙ„Ø©</span>
                        <button class="clear-btn" onclick="clearCart()"><i class="fas fa-trash-alt"></i> Ø¥ÙØ±Ø§Øº</button>
                    </div>
                    
                    <div id="cartItems" class="cart-items">
                        </div>

                    <div class="cart-footer">
                        <div class="total-row">
                            <span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø·Ù„Ù€ÙˆØ¨:</span>
                            <span id="cartTotal">0.00 Ø¬</span>
                        </div>
                        <button class="btn-checkout" onclick="checkout()">
                            <i class="fas fa-print"></i> Ø¥ØµØ¯Ø§Ø± ÙˆØ·Ø¨Ø§Ø¹Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div id="dashboard" class="page">
            <div class="data-panel">
                <div class="panel-title">
                    <h2><i class="fas fa-chart-pie"></i> Ù…Ù„Ø®Øµ Ø§Ù„ÙŠÙˆÙ…</h2>
                </div>
                <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap:20px;">
                    <div style="background:var(--bg); padding:20px; border-radius:12px; border-right:4px solid var(--primary)">
                        <h3 style="color:#7f8c8d; font-size:14px; margin-bottom:5px">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</h3> 
                        <div style="font-size:28px; font-weight:900; color:var(--primary-dark)" id="dash_sales">0 Ø¬</div>
                    </div>
                    <div style="background:var(--bg); padding:20px; border-radius:12px; border-right:4px solid var(--danger)">
                        <h3 style="color:#7f8c8d; font-size:14px; margin-bottom:5px">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</h3> 
                        <div style="font-size:28px; font-weight:900; color:var(--danger)" id="dash_exp">0 Ø¬</div>
                    </div>
                    <div style="background:#f0fdf4; padding:20px; border-radius:12px; border-right:4px solid var(--success); border:1px solid #dcfce7">
                        <h3 style="color:#166534; font-size:14px; margin-bottom:5px">ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„ØªÙ‚Ø¯ÙŠØ±ÙŠ</h3> 
                        <div style="font-size:28px; font-weight:900; color:var(--success)" id="dash_profit">0 Ø¬</div>
                    </div>
                </div>
            </div>
        </div>

        <div id="inventory" class="page">
            <div class="data-panel">
                <div class="panel-title">
                    <h2><i class="fas fa-boxes"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</h2>
                    <button class="btn-action" onclick="openModal('modal_inv')"><i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© ØµÙ†Ù</button>
                </div>
                <input type="text" placeholder="Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù..." class="form-control" onkeyup="renderInventory()" id="invSearch">
                <table>
                    <thead><tr><th>Ø§Ù„ØµÙ†Ù</th><th>Ø§Ù„ØªØµÙ†ÙŠÙ</th><th>Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø­</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th></tr></thead>
                    <tbody id="inventoryTable"></tbody>
                </table>
            </div>
        </div>

        <div id="recipes" class="page">
            <div class="data-panel">
                <div class="panel-title">
                    <h2><i class="fas fa-blender"></i> Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªÙƒÙ„ÙØ© ÙˆØ§Ù„Ø®ØµÙ… (Recipe)</h2>
                </div>
                <select id="recipeProdSelect" class="form-control" onchange="loadRecipe()">
                    <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†ØªØ¬ Ù…Ù† Ø§Ù„Ù…Ù†ÙŠÙˆ --</option>
                </select>
                <div id="recipeEditor" style="display:none; background:var(--bg); padding:20px; border-radius:10px; border:1px solid var(--border)">
                    <h3 id="recipeProdName" style="color:var(--primary); margin-bottom:15px"></h3>
                    <div id="recipeIngsContainer"></div>
                    <div style="margin-top:15px; display:flex; gap:10px">
                        <button class="btn-action" style="background:#64748b" onclick="addRecipeRow()"><i class="fas fa-plus"></i> Ù…ÙƒÙˆÙ† Ø¬Ø¯ÙŠØ¯</button>
                        <button class="btn-action" onclick="saveRecipe()"><i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="expenses" class="page">
            <div class="data-panel">
                <div class="panel-title">
                    <h2><i class="fas fa-money-bill-wave"></i> Ø³Ø¬Ù„ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</h2>
                    <button class="btn-action" onclick="openModal('modal_exp')"><i class="fas fa-plus"></i> ØªØ³Ø¬ÙŠÙ„ Ù…ØµØ±ÙˆÙ</button>
                </div>
                <table>
                    <thead><tr><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø¨Ù†Ø¯ Ø§Ù„Ù…ØµØ±ÙˆÙ</th><th>Ø§Ù„Ù‚ÙŠÙ…Ø© (Ø¬Ù†ÙŠÙ‡)</th></tr></thead>
                    <tbody id="expTableBody"></tbody>
                </table>
            </div>
        </div>

        <div id="reports" class="page">
            <div class="data-panel">
                <div class="panel-title">
                    <h2><i class="fas fa-file-invoice-dollar"></i> Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠ Ø§Ù„Ø´Ø§Ù…Ù„</h2>
                </div>
                <div style="display:flex; gap:15px; align-items:center; margin-bottom:20px">
                    <input type="date" id="repStart" class="form-control" style="margin:0">
                    <span style="font-weight:bold">Ø¥Ù„Ù‰</span>
                    <input type="date" id="repEnd" class="form-control" style="margin:0">
                    <button class="btn-action" onclick="genReport()"><i class="fas fa-search"></i> Ø§Ø³ØªØ®Ø±Ø§Ø¬</button>
                </div>
                <div id="repResult" style="display:none; padding:20px; background:var(--bg); border-radius:12px; border:1px solid var(--border)">
                    <table style="font-size:16px">
                        <tr><td style="width:70%">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª (Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª):</td><td id="val_sales" style="font-weight:900; color:var(--primary)"></td></tr>
                        <tr><td>ØªÙƒÙ„ÙØ© Ø§Ù„Ø¨Ø¶Ø§Ø¹Ø© Ø§Ù„Ù…Ø¨Ø§Ø¹Ø© (COGS):</td><td id="val_cost" style="font-weight:900; color:#e67e22"></td></tr>
                        <tr><td>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠØ©:</td><td id="val_exp" style="font-weight:900; color:var(--danger)"></td></tr>
                        <tr style="background:#e2e8f0; font-size:20px">
                            <td style="font-weight:900">ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:</td>
                            <td id="val_profit" style="font-weight:900; color:var(--success)"></td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>

    </div>

    <div id="modal_inv" class="modal">
        <div class="modal-content">
            <h3><i class="fas fa-box"></i> ØµÙ†Ù Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ù…Ø®Ø²Ù†</h3>
            <input type="text" id="new_inv_name" placeholder="Ø§Ø³Ù… Ø§Ù„Ø®Ù€Ø§Ù…Ø© (Ù…Ø«Ø§Ù„: Ø¨Ù† Ø¨Ø±Ø§Ø²ÙŠÙ„ÙŠ)" class="form-control">
            <select id="new_inv_type" class="form-control">
                <option value="raw">Ø®Ø§Ù…Ø© ØªØµÙ†ÙŠØ¹ (ØªØ¯Ø®Ù„ ÙÙŠ Ø§Ù„Ù…Ø´Ø±ÙˆØ¨Ø§Øª)</option>
                <option value="ready">Ù…Ù†ØªØ¬ Ø¬Ø§Ù‡Ø² (ÙŠØ¨Ø§Ø¹ Ù…Ø¨Ø§Ø´Ø±Ø©)</option>
            </select>
            <div style="display:flex; gap:10px">
                <input type="number" id="new_inv_qty" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…ØªØ§Ø­Ø©" class="form-control">
                <select id="new_inv_unit" class="form-control">
                    <option value="gram">Ø¬Ø±Ø§Ù…</option>
                    <option value="ml">Ù…Ù„Ù‘ÙŠ</option>
                    <option value="piece">Ù‚Ø·Ø¹Ø©/Ø¹Ù„Ø¨Ø©</option>
                    <option value="kg">ÙƒÙŠÙ„Ùˆ</option>
                </select>
            </div>
            <input type="number" id="new_inv_cost" placeholder="Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ© Ù„Ù‡Ø°Ù‡ Ø§Ù„ÙƒÙ…ÙŠØ©" class="form-control">
            <div style="display:flex; justify-content:flex-end; gap:10px; margin-top:10px">
                <button class="btn-action" style="background:#94a3b8" onclick="closeModal()">Ø¥Ù„ØºØ§Ø¡</button>
                <button class="btn-action" onclick="saveInventory()">Ø­ÙØ¸ Ø§Ù„ØµÙ†Ù</button>
            </div>
        </div>
    </div>

    <div id="modal_exp" class="modal">
        <div class="modal-content">
            <h3><i class="fas fa-wallet"></i> Ù…ØµØ±ÙˆÙ Ø¬Ø¯ÙŠØ¯</h3>
            <input type="text" id="new_exp_title" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ØµØ±ÙˆÙ (ÙƒÙ‡Ø±Ø¨Ø§Ø¡ØŒ Ø±ÙˆØ§ØªØ¨...)" class="form-control">
            <input type="number" id="new_exp_val" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº" class="form-control">
            <div style="display:flex; justify-content:flex-end; gap:10px; margin-top:10px">
                <button class="btn-action" style="background:#94a3b8" onclick="closeModal()">Ø¥Ù„ØºØ§Ø¡</button>
                <button class="btn-action" onclick="saveExpense()">ØªØ³Ø¬ÙŠÙ„</button>
            </div>
        </div>
    </div>

    <div id="receipt-area">
        <div class="r-header">
            <img src="assets/images/logo.png" alt="NEO">
            <h2>NEO CafÃ©</h2>
            <div class="r-slogan">âœ¨ Ø±Ù…Ø¶Ø§Ù†Ùƒ Ø¬Ù…ÙŠÙ„ ÙÙŠ Ù†ÙŠÙˆ âœ¨</div>
        </div>
        
        <div class="r-meta">
            <div><span>ÙØ§ØªÙˆØ±Ø© #:</span> <span id="p_id"></span></div>
            <div><span>Ø§Ù„ØªØ§Ø±ÙŠØ®:</span> <span id="p_date"></span></div>
            <div><span>Ø§Ù„Ø·Ø§ÙˆÙ„Ø©:</span> <span id="p_table"></span></div>
            <div><span>Ø§Ù„ÙˆÙ‚Øª:</span> <span id="p_time"></span></div>
            <div class="full"><span>Ø§Ù„ÙƒØ§Ø´ÙŠØ±:</span> <span>Admin</span></div>
        </div>
        
        <table class="r-table">
            <thead>
                <tr>
                    <th>Ø§Ù„ØµÙ†Ù</th>
                    <th>Ø³Ø¹Ø±</th>
                    <th>Ø¹</th>
                    <th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
                </tr>
            </thead>
            <tbody id="p_items"></tbody>
        </table>
        
        <div class="r-total-sec">
            <span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</span>
            <span><span id="p_total">0</span> Ø¬</span>
        </div>
        
        <div class="r-footer">
            Ø´Ø±ÙØªÙ†Ø§ ÙŠØ§ Ø¨ÙˆØ¨ â¤ï¸<br>
            WiFi: 12345678<br>
            Make It NEO Time
        </div>
    </div>

<script>
// Ø¯Ø§Ù„Ø© Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ù†ØµÙˆØµ
function escapeHtml(s) { return String(s||'').replace(/&/g,"&amp;").replace(/</g,"&lt;"); }

/* ================== Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ÙŠÙˆ ÙƒØ§Ù…Ù„Ø© Ù…Ø¹ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª ================== */
const MENU = {
    ramadan: { 
        title: 'ğŸŒ™ Ø±Ù…Ø¶Ø§Ù† ÙÙŠ Ù†ÙŠÙˆ', 
        items: [
            {id:'r1', name:'Ø±Ø² Ø¨Ù„Ø¨Ù† Ù…ÙƒØ³Ø±Ø§Øª', price:40}, {id:'r2', name:'Ø±Ø² Ø¨Ù„Ø¨Ù† ÙƒØ±Ø§Ù…ÙŠÙ„', price:45},
            {id:'r3', name:'Ø±Ø² Ø¨Ù„Ø¨Ù† Ø´ÙˆÙƒÙ„ÙŠØª', price:45}, {id:'r4', name:'Ø±Ø² Ø¨Ù„Ø¨Ù† Ù†ÙˆØªÙŠÙ„Ø§', price:55},
            {id:'r5', name:'Ø±Ø² Ø¨Ù„Ø¨Ù† Ø¨Ø³ØªØ§Ø´ÙŠÙˆ', price:60}, {id:'r6', name:'Ø±Ø² Ø¨Ù„Ø¨Ù† Ù„ÙˆØªØ³', price:55},
            {id:'r7', name:'Ø±Ø² Ø¨Ù„Ø¨Ù† Ù…ÙŠÙƒØ³ ØµÙˆØµ', price:75}, {id:'r8', name:'Ø±Ø² Ø¨Ù„Ø¨Ù† Ù‚Ù†Ø¨Ù„Ø©', price:85},
            {id:'r9', name:'ÙƒØ¨ ÙƒÙ†Ø§ÙØ© Ù„ÙˆØªØ³', price:85}, {id:'r10', name:'ÙƒØ¨ ÙƒÙ†Ø§ÙØ© Ù†ÙˆØªÙŠÙ„Ø§', price:85},
            {id:'r11', name:'ÙØ§Ø¯Ø¬ ÙƒØ±Ø§Ù†Ø´ÙŠ', price:95}, {id:'r12', name:'ÙØ§Ø¯Ø¬ Ø¨Ø³ØªØ§Ø´ÙŠÙˆ', price:110}
        ]
    },
    hot: {
        title: 'â˜• Ù…Ø´Ø±ÙˆØ¨Ø§Øª Ø³Ø§Ø®Ù†Ø©',
        items: [
            {id:'h1', name:'Ø´Ø§ÙŠ', price:15}, {id:'h2', name:'Ø´Ø§ÙŠ Ø£Ø­Ù…Ø¯ ØªÙŠ', price:20}, {id:'h3', name:'Ø´Ø§ÙŠ Ø£Ø®Ø¶Ø±', price:20},
            {id:'h4', name:'Ø´Ø§ÙŠ Ø­Ù„ÙŠØ¨', price:20}, {id:'h5', name:'Ø´Ø§ÙŠ Ù†ÙƒÙ‡Ø§Øª', price:20}, {id:'h6', name:'Ù†Ø¹Ù†Ø§Ø¹', price:15},
            {id:'h7', name:'ÙŠÙ†Ø³ÙˆÙ†', price:15}, {id:'h8', name:'Ø¬Ù†Ø²Ø¨ÙŠÙ„', price:15}, {id:'h9', name:'Ø§Ø³Ø¨Ø±ÙŠØ³Ùˆ Ø³Ù†Ø¬Ù„', price:35},
            {id:'h10', name:'Ø§Ø³Ø¨Ø±ÙŠØ³Ùˆ Ø¯Ø¨Ù„', price:40}, {id:'h11', name:'Ù‚Ù‡ÙˆØ© ØªØ±ÙƒÙŠ', price:25}, {id:'h12', name:'ØªØ±ÙƒÙŠ Ø¯Ø¨Ù„', price:30},
            {id:'h13', name:'Ù‚Ù‡ÙˆØ© ÙØ±Ù†Ø³Ø§ÙˆÙŠ', price:35}, {id:'h14', name:'Ù‚Ù‡ÙˆØ© Ø¨Ù†Ø¯Ù‚', price:35}, {id:'h15', name:'Ù‚Ù‡ÙˆØ© Ù†ÙˆØªÙŠÙ„Ø§', price:40},
            {id:'h16', name:'Ù‚Ù‡ÙˆØ© Ø¨Ø³ØªØ§Ø´ÙŠÙˆ', price:40}, {id:'h17', name:'Ù„Ø§ØªÙŠÙ‡', price:50}, {id:'h18', name:'Ù„Ø§ØªÙŠÙ‡ ÙÙ„ÙØ±', price:60},
            {id:'h19', name:'Ø³Ø¨Ø§Ù†Ø´ Ù„Ø§ØªÙŠÙ‡', price:65}, {id:'h20', name:'ÙƒØ§Ø¨ØªØ´ÙŠÙ†Ùˆ', price:55}, {id:'h21', name:'Ù†Ø³ÙƒØ§ÙÙŠÙ‡ Ø­Ù„ÙŠØ¨', price:45},
            {id:'h22', name:'Ù†Ø³ÙƒØ§ÙÙŠÙ‡ Ø¨Ù„Ø§Ùƒ', price:35}, {id:'h23', name:'Ø§Ù…Ø±ÙŠÙƒØ§Ù†Ùˆ', price:50}, {id:'h24', name:'Ù‡ÙˆØª Ø´ÙˆÙƒÙ„ÙŠØª', price:50},
            {id:'h25', name:'Ù‡ÙˆØª Ø³ÙŠØ¯Ø±', price:45}, {id:'h26', name:'Ø³Ø­Ù„Ø¨', price:40}, {id:'h27', name:'Ø³Ø­Ù„Ø¨ Ù…ÙƒØ³Ø±Ø§Øª', price:45},
            {id:'h28', name:'Ø³Ø­Ù„Ø¨ Ù„ÙˆØªØ³', price:50}, {id:'h29', name:'Ø³Ø­Ù„Ø¨ Ù†ÙŠÙˆ', price:65}, {id:'h30', name:'Ù…ÙŠÙƒØ§ØªÙˆ', price:40},
            {id:'h31', name:'Ù…ÙˆÙƒØ§', price:45}
        ]
    },
    cold: {
        title: 'ğŸ§Š Ù…Ø´Ø±ÙˆØ¨Ø§Øª Ø¨Ø§Ø±Ø¯Ø©',
        isComplex: true,
        subcats: [
            { title:'Ù…ÙŠÙ„Ùƒ Ø´ÙŠÙƒ', items: [
                {id:'ms1', name:'Ù…ÙŠÙ„Ùƒ Ø´ÙŠÙƒ ÙØ§Ù†ÙŠÙ„Ø§', price:50}, {id:'ms2', name:'Ù…ÙŠÙ„Ùƒ Ø´ÙŠÙƒ Ø§ÙˆØ±ÙŠÙˆ', price:55},
                {id:'ms3', name:'Ù…ÙŠÙ„Ùƒ Ø´ÙŠÙƒ Ù‡ÙˆÙ‡ÙˆØ²', price:55}, {id:'ms4', name:'Ù…ÙŠÙ„Ùƒ Ø´ÙŠÙƒ ÙƒØ±Ø§Ù…ÙŠÙ„', price:55},
                {id:'ms5', name:'Ù…ÙŠÙ„Ùƒ Ø´ÙŠÙƒ ÙØ±Ø§ÙˆÙ„Ø©', price:60}, {id:'ms6', name:'Ù…ÙŠÙ„Ùƒ Ø´ÙŠÙƒ Ù…Ø§Ù†Ø¬Ùˆ', price:65},
                {id:'ms7', name:'Ù…ÙŠÙ„Ùƒ Ø´ÙŠÙƒ Ø³Ù†ÙŠÙƒØ±Ø²', price:75}, {id:'ms8', name:'Ù…ÙŠÙ„Ùƒ Ø´ÙŠÙƒ Ù…ÙˆØ±Ùˆ', price:75},
                {id:'ms9', name:'Ù…ÙŠÙ„Ùƒ Ø´ÙŠÙƒ Ø´ÙˆÙƒÙ„ÙŠØª', price:55}, {id:'ms10', name:'Ù…ÙŠÙ„Ùƒ Ø´ÙŠÙƒ ÙƒÙ†Ø¯Ø±', price:65},
                {id:'ms11', name:'Ù…ÙŠÙ„Ùƒ Ø´ÙŠÙƒ Ù†Ø³ÙƒØ§ÙÙŠÙ‡', price:50}, {id:'ms12', name:'Ù…ÙŠÙ„Ùƒ Ø´ÙŠÙƒ Ù…ÙˆØ² Ù†ÙˆØªÙŠÙ„Ø§', price:65}
            ]},
            { title:'ÙØ±Ø¨Ø§ØªØ´ÙŠÙ†Ùˆ', items: [
                {id:'fr1', name:'ÙØ±Ø¨Ø§ØªØ´ÙŠÙ†Ùˆ Ø´ÙˆÙƒÙ„ÙŠØª', price:50}, {id:'fr2', name:'ÙØ±Ø¨Ø§ØªØ´ÙŠÙ†Ùˆ ÙƒØ±Ø§Ù…ÙŠÙ„', price:55},
                {id:'fr3', name:'ÙØ±Ø¨Ø§ØªØ´ÙŠÙ†Ùˆ Ø¨Ù†Ø¯Ù‚', price:55}, {id:'fr4', name:'ÙØ±Ø¨Ø§ØªØ´ÙŠÙ†Ùˆ ÙƒÙˆÙƒÙŠØ²', price:55},
                {id:'fr5', name:'ÙØ±Ø¨Ø§ØªØ´ÙŠÙ†Ùˆ Ù†ÙˆØªÙŠÙ„Ø§', price:65}, {id:'fr6', name:'ÙØ±Ø¨Ø§ØªØ´ÙŠÙ†Ùˆ Ø¨Ø³ØªØ§Ø´ÙŠÙˆ', price:75},
                {id:'fr7', name:'ÙØ±Ø¨Ø§ØªØ´ÙŠÙ†Ùˆ Ø£ÙˆØ±ÙŠÙˆ', price:65}, {id:'fr8', name:'ÙØ±Ø¨Ø§ØªØ´ÙŠÙ†Ùˆ Ù„ÙˆØªØ³', price:75}
            ]},
            { title:'Ø¢ÙŠØ³ ÙƒÙˆÙÙŠ', items: [
                {id:'ice1', name:'Ø§ÙŠØ³ Ù„Ø§ØªÙŠÙ‡', price:50}, {id:'ice2', name:'Ø§ÙŠØ³ ÙƒÙˆÙÙŠ', price:45},
                {id:'ice3', name:'Ø§ÙŠØ³ Ø§Ù…Ø±ÙŠÙƒØ§Ù†Ùˆ', price:55}, {id:'ice4', name:'Ø§ÙŠØ³ Ø³Ø¨Ø§Ù†Ø´', price:65},
                {id:'ice5', name:'Ø§ÙŠØ³ Ù…ÙˆÙƒØ§', price:55}, {id:'ice6', name:'Ø§ÙŠØ³ Ù„ÙˆØªØ³', price:50},
                {id:'ice7', name:'Ø§ÙŠØ³ ÙƒØ±Ø§Ù…ÙŠÙ„', price:50}
            ]},
            { title:'ÙØ±ÙŠØ´', items: [
                {id:'frs1', name:'Ù…Ø§Ù†Ø¬Ùˆ', price:50}, {id:'frs2', name:'ÙØ±Ø§ÙˆÙ„Ø©', price:45},
                {id:'frs3', name:'ÙØ±Ø§ÙˆÙ„Ø© Ø­Ù„ÙŠØ¨', price:50}, {id:'frs4', name:'Ù…ÙˆØ² Ø­Ù„ÙŠØ¨', price:50},
                {id:'frs5', name:'Ø¨Ù„Ø­ Ø­Ù„ÙŠØ¨', price:55}, {id:'frs6', name:'Ù„ÙŠÙ…ÙˆÙ†', price:30},
                {id:'frs7', name:'Ù„ÙŠÙ…ÙˆÙ† Ù†Ø¹Ù†Ø§Ø¹', price:35}, {id:'frs8', name:'Ø¨Ø·ÙŠØ®', price:40},
                {id:'frs9', name:'Ø¨Ø±ØªÙ‚Ø§Ù„', price:40}, {id:'frs10', name:'ÙƒÙŠÙˆÙŠ', price:60},
                {id:'frs11', name:'ÙƒÙŠÙˆÙŠ Ø­Ù„ÙŠØ¨', price:70}, {id:'frs12', name:'Ø§ÙÙˆØ¬Ø§ØªÙˆ Ø¹Ø³Ù„', price:100},
                {id:'frs13', name:'Ø§ÙÙˆØ¬Ø§ØªÙˆ Ù…ÙƒØ³Ø±Ø§Øª', price:120}, {id:'frs14', name:'Ø¬ÙˆØ§ÙØ©', price:45},
                {id:'frs15', name:'ÙƒÙˆÙƒØªÙŠÙ„', price:55}, {id:'frs16', name:'ÙƒÙˆÙƒØªÙŠÙ„ Ù‚Ø·Ø¹', price:65},
                {id:'frs17', name:'Ù†ÙŠÙˆ Ø§ÙÙˆØ¬Ø§ØªÙˆ', price:105}
            ]},
            { title:'Ø³Ù…ÙˆØ²ÙŠ', items: [
                {id:'sm1', name:'Ø³Ù…ÙˆØ²ÙŠ ÙØ±Ø§ÙˆÙ„Ø©', price:45}, {id:'sm2', name:'Ø³Ù…ÙˆØ²ÙŠ Ù…Ø§Ù†Ø¬Ùˆ', price:45},
                {id:'sm3', name:'Ø³Ù…ÙˆØ²ÙŠ Ø£Ù†Ø§Ù†Ø§Ø³', price:45}, {id:'sm4', name:'Ø³Ù…ÙˆØ²ÙŠ Ø®ÙˆØ®', price:45},
                {id:'sm5', name:'Ø³Ù…ÙˆØ²ÙŠ ÙƒÙŠÙˆÙŠ', price:45}, {id:'sm6', name:'Ø³Ù…ÙˆØ²ÙŠ Ø¨Ø·ÙŠØ®', price:45},
                {id:'sm7', name:'Ø³Ù…ÙˆØ²ÙŠ Ø¨Ù„ÙˆØ¨ÙŠØ±ÙŠ', price:45}
            ]},
            { title:'ØµÙˆØ¯Ø§', items: [
                {id:'sd1', name:'Ø¨Ù„ÙˆØ¨ÙŠØ±ÙŠ ØµÙˆØ¯Ø§', price:50}, {id:'sd2', name:'Ø¨Ù„Ùˆ ØµÙˆØ¯Ø§', price:50},
                {id:'sd3', name:'Ø¨Ø±Ø§Ù†Ø¯ÙŠØª', price:50}, {id:'sd4', name:'ÙØ±Ø§ÙˆÙ„Ø© ØµÙˆØ¯Ø§', price:50},
                {id:'sd5', name:'Ø£Ù†Ø§Ù†Ø§Ø³ ØµÙˆØ¯Ø§', price:50}, {id:'sd6', name:'Ø®ÙˆØ® ØµÙˆØ¯Ø§', price:50},
                {id:'sd7', name:'Ù…ÙˆÙ‡ÙŠØªÙˆ', price:55}
            ]}
        ]
    },
    soft: {
        title: 'ğŸ¥¤ Ø³ÙˆÙØª Ø¯Ø±ÙŠÙ†Ùƒ',
        items: [
            {id:'sc1', name:'V-Cola ÙƒÙ„Ø§Ø³ÙŠÙƒ', price:20}, {id:'sc2', name:'V-Cola Ù†ÙƒÙ‡Ø§Øª', price:25},
            {id:'sc3', name:'Ø±ÙŠØ¯ Ø¨ÙˆÙ„', price:65}, {id:'sc4', name:'Ø±ÙŠØ¯ Ø¨ÙˆÙ„ Ù†ÙƒÙ‡Ø§Øª', price:75},
            {id:'sc5', name:'ØªÙˆÙŠØ³Øª', price:25}, {id:'sc6', name:'Ø´ÙˆÙŠØ¨Ø³', price:30},
            {id:'sc7', name:'ÙÙŠØ±ÙˆØ²', price:30}, {id:'sc8', name:'Ø¹ØµÙŠØ± Ø¬Ù‡ÙŠÙ†Ø©', price:15},
            {id:'sc9', name:'Ø¬Ù‡ÙŠÙ†Ø© Ù…ÙŠÙƒØ³', price:20}
        ]
    },
    dessert: {
        title: 'ğŸ° Ø£Ø·Ø¨Ø§Ù‚ Ø¯ÙŠØ²ÙŠØ±Øª',
        items: [
            {id:'ds1', name:'ÙˆØ§ÙÙ„ Ø´ÙˆÙƒÙ„ÙŠØª', price:65}, {id:'ds2', name:'ÙˆØ§ÙÙ„ ÙƒØ±Ø§Ù…ÙŠÙ„', price:65},
            {id:'ds3', name:'ÙˆØ§ÙÙ„ Ù†ÙˆØªÙŠÙ„Ø§', price:75}, {id:'ds4', name:'ÙˆØ§ÙÙ„ Ø£ÙˆØ±ÙŠÙˆ', price:75},
            {id:'ds5', name:'ÙˆØ§ÙÙ„ Ù„ÙˆØªØ³', price:75}, {id:'ds6', name:'ÙˆØ§ÙÙ„ Ø¨Ø³ØªØ§Ø´ÙŠÙˆ', price:85},
            {id:'ds7', name:'ÙˆØ§ÙÙ„ ÙÙˆØ§ÙƒÙ‡', price:90}, {id:'ds8', name:'Ù…ÙˆÙ„ØªÙ† ÙƒÙŠÙƒ', price:75},
            {id:'ds9', name:'ØªØ´ÙŠØ² ÙƒÙŠÙƒ', price:85}, {id:'ds10', name:'Ø´ÙˆÙƒÙ„ÙŠØª ÙƒÙŠÙƒ', price:70},
            {id:'ds11', name:'Ø³ÙŠÙ†Ø§Ø¨ÙˆÙ†', price:65}, {id:'ds12', name:'Ø¯ÙˆÙ†Ø§ØªØ³', price:50},
            {id:'ds13', name:'Ø¨Ø±Ø§ÙˆÙ†ÙŠØ²', price:60}, {id:'ds14', name:'Ù…ÙŠÙ†ÙŠ ÙƒÙˆÙƒÙŠØ²', price:30},
            {id:'ds15', name:'Ø¨Ø±ÙˆÙÙŠØªØ±ÙˆÙ„', price:35}, {id:'ds16', name:'Ø¨Ø§Ù…Ø¨ÙˆÙ„ÙŠÙ†ÙŠ', price:55},
            {id:'ds17', name:'ÙÙˆÙ„ÙƒØ§Ù†Ùˆ', price:75}, {id:'ds18', name:'ÙƒØ±ÙˆØ§Ø³ÙˆÙ†', price:45},
            {id:'ds19', name:'ØªÙŠØ±Ø§Ù…ÙŠØ³Ùˆ', price:65}, {id:'ds20', name:'ØªØ´ÙŠØ² Ù…Ø§Ø¯Ù†Ø³', price:95}
        ]
    },
    special: {
        title: 'ğŸŒŸ Ù…Ù…ÙŠØ² Ù†ÙŠÙˆ',
        items: [
            {id:'sp1', name:'Ø¨Ø·Ø§Ø·Ø§ Ø¹Ø³Ù„ Ù…ÙƒØ³Ø±Ø§Øª', price:50}, {id:'sp2', name:'Ø§Ù†Ø¯ÙˆÙ…ÙŠ', price:20},
            {id:'sp3', name:'Ø§Ù†Ø¯ÙˆÙ…ÙŠ Ù†ÙŠÙˆ', price:40}, {id:'sp4', name:'ÙƒÙˆÙƒØªÙŠÙ„ Ù†ÙŠÙˆ', price:100}
        ]
    },
    ice: {
        title: 'ğŸ¦ Ø§ÙŠØ³ ÙƒØ±ÙŠÙ…',
        items: [
            {id:'ic1', name:'ÙƒÙˆØ¨ ÙˆØ³Ø·', price:25}, {id:'ic2', name:'ÙƒÙˆØ¨ ÙƒØ¨ÙŠØ±', price:35}
        ]
    },
    extras: {
        title: 'â• Ø¥Ø¶Ø§ÙØ§Øª',
        items: [
            {id:'ex1', name:'ØªØºÙ„ÙŠÙ', price:10}, {id:'ex2', name:'Ù…ÙŠØ§Ù‡', price:10}, {id:'ex3', name:'Ø¥Ø¶Ø§ÙØ©', price:10}
        ]
    },
    fun: {
        title: 'ğŸ² Ø§Ù„Ø¹Ø§Ø¨ Ù…Ø¬Ø§Ù†ÙŠØ©',
        items: [
            {id:'fn1', name:'ÙƒÙˆØªØ´ÙŠÙ†Ø©', price:0}, {id:'fn2', name:'Ø´Ø·Ø±Ù†Ø¬', price:0},
            {id:'fn3', name:'Ø£Ù…ÙŠÙ…', price:0}, {id:'fn4', name:'ØªÙˆØ¨ÙŠÙƒ', price:0}
        ]
    }
};

/* ================== ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (LocalStorage) ================== */
const DB = {
    keys: { inv:'neo_inv_v2', exp:'neo_exp_v2', sales:'neo_sales_v2', recipes:'neo_recipes_v2', tables:'neo_tables_v4' },
    getData: (key) => JSON.parse(localStorage.getItem(key)) || [],
    saveData: (key, data) => localStorage.setItem(key, JSON.stringify(data)),
    getTable: () => JSON.parse(localStorage.getItem('neo_tables_v4')) || {}
};

// ØªØ®Ø·ÙŠØ· Ø§Ù„Ù…Ø­Ù„ (Ø¨Ø¯ÙˆÙ† 9 Ùˆ 10)
const LAYOUT = [
    {id:14, label:'Ø´Ø§Ø±Ø¹ Ø´Ù…Ø§Ù„', area:'out_l'}, {id:13, label:'Ø´Ø§Ø±Ø¹ ÙŠÙ…ÙŠÙ†', area:'out_r'},
    {id:12, label:'Ø§Ù„Ø¨Ø§Ø± Ø§Ù„ÙƒØ¨ÙŠØ±', area:'bar_b'}, {id:'door', label:'Ø¨Ø§Ø¨ Ø§Ù„Ù…Ø­Ù„', area:'door', type:'static'},
    {id:11, label:'Ø¨Ø§Ø± ØµØºÙŠØ±', area:'bar_s'},
    {id:5, label:'T-5', area:'t5'},
    {id:4, label:'T-4', area:'t4'}, {id:6, label:'T-6', area:'t6'},
    {id:3, label:'T-3', area:'t3'}, {id:7, label:'T-7', area:'t7'},
    {id:2, label:'T-2', area:'t2'}, {id:8, label:'T-8', area:'t8'},
    {id:1, label:'T-1', area:'t1'},
    {id:'cashier', label:'Ø§Ù„ÙƒØ§Ø´ÙŠØ±', area:'cashier', type:'static'}
];

let tablesOrder = DB.getTable();
let currentTable = null;

// Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
function init() {
    renderMap();
    renderCategories();
    changeCat('ramadan');
    updateDashboard();
    renderInventory();
    renderExpenses();
    setupRecipeSelect();
}

// Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„ØµÙØ­Ø§Øª
function nav(pageId) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.getElementById(pageId).classList.add('active');
    document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
    event.currentTarget.classList.add('active');
    if(pageId === 'dashboard') updateDashboard();
    if(pageId === 'inventory') renderInventory();
    if(pageId === 'expenses') renderExpenses();
}

/* ================== ÙƒÙˆØ¯ Ø§Ù„ÙƒØ§Ø´ÙŠØ± ÙˆØ§Ù„Ø®Ø±ÙŠØ·Ø© ================== */
function renderMap() {
    const map = document.getElementById('cafeMap');
    map.innerHTML = '';

    LAYOUT.forEach(obj => {
        const div = document.createElement('div');
        if(obj.type === 'static') {
            div.className = `obj-${obj.id}`;
            div.innerHTML = obj.label;
        } else {
            const hasOrder = tablesOrder[obj.id] && tablesOrder[obj.id].length > 0;
            const total = hasOrder ? tablesOrder[obj.id].reduce((a,b)=>a+(b.price*b.qty),0) : 0;
            
            div.className = `table-card ${hasOrder?'occupied':''} ${currentTable===obj.id?'selected':''}`;
            div.id = `tbl_${obj.id}`;
            div.innerHTML = `${obj.label} ${hasOrder ? `<div class="table-total">${total} Ø¬</div>` : ''}`;
            
            div.onclick = () => {
                currentTable = obj.id;
                document.getElementById('activeTableLabel').textContent = obj.label;
                renderMap();
                renderCart();
            };
        }
        map.appendChild(div);
    });
}

function renderCategories() {
    const bar = document.getElementById('posCats');
    bar.innerHTML = Object.keys(MENU).map(k => 
        `<div class="cat-chip" id="btn_${k}" onclick="changeCat('${k}')">${MENU[k].title}</div>`
    ).join('');
}

function changeCat(key) {
    document.querySelectorAll('.cat-chip').forEach(c => c.classList.remove('active'));
    const btn = document.getElementById(`btn_${key}`);
    if(btn) btn.classList.add('active');

    const subBar = document.getElementById('posSubCats');
    const grid = document.getElementById('posProducts');
    subBar.innerHTML = '';
    subBar.classList.remove('show');
    grid.innerHTML = '';

    const catData = MENU[key];
    if(catData.isComplex) {
        subBar.classList.add('show');
        catData.subcats.forEach((sub, idx) => {
            const subBtn = document.createElement('div');
            subBtn.className = `sub-cat-chip ${idx===0?'active':''}`;
            subBtn.textContent = sub.title;
            subBtn.onclick = (e) => {
                document.querySelectorAll('.sub-cat-chip').forEach(s => s.classList.remove('active'));
                e.target.classList.add('active');
                renderProducts(sub.items);
            };
            subBar.appendChild(subBtn);
        });
        renderProducts(catData.subcats[0].items);
    } else {
        renderProducts(catData.items);
    }
}

function renderProducts(items) {
    const grid = document.getElementById('posProducts');
    grid.innerHTML = items.map(p => `
        <div class="prod-card" onclick="addToCart('${p.id}', '${escapeHtml(p.name)}', ${p.price})">
            <div class="prod-name">${p.name}</div>
            <div class="prod-price">${p.price} Ø¬</div>
        </div>
    `).join('');
}

function addToCart(id, name, price) {
    if(!currentTable) return alert('Ø¨Ø±Ø¬Ø§Ø¡ ØªØ­Ø¯ÙŠØ¯ Ø·Ø§ÙˆÙ„Ø© Ù…Ù† Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø£ÙˆÙ„Ø§Ù‹!');
    if(!tablesOrder[currentTable]) tablesOrder[currentTable] = [];
    
    const existing = tablesOrder[currentTable].find(x => x.id === id);
    if(existing) existing.qty++;
    else tablesOrder[currentTable].push({id, name, price, qty:1});
    
    saveTables(); renderCart(); renderMap();
}

function renderCart() {
    const container = document.getElementById('cartItems');
    if(!currentTable || !tablesOrder[currentTable] || !tablesOrder[currentTable].length) {
        container.innerHTML = `<div style="text-align:center;color:#bdc3c7;margin-top:40px">
            <i class="fas fa-receipt" style="font-size:40px;margin-bottom:10px"></i><br>Ù„Ù… ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø·Ù„Ø¨Ø§Øª
        </div>`;
        document.getElementById('cartTotal').textContent = "0.00 Ø¬";
        return;
    }
    
    let total = 0;
    container.innerHTML = tablesOrder[currentTable].map((item, idx) => {
        total += item.price * item.qty;
        return `
        <div class="cart-item">
            <div class="item-info">${item.name}</div>
            <div class="qty-controls">
                <button class="qty-btn dec" onclick="modQty(${idx}, -1)"><i class="fas fa-minus"></i></button>
                <span style="font-weight:900; width:20px; text-align:center">${item.qty}</span>
                <button class="qty-btn inc" onclick="modQty(${idx}, 1)"><i class="fas fa-plus"></i></button>
            </div>
            <div class="item-total">${item.price * item.qty} Ø¬</div>
        </div>`;
    }).join('');
    
    document.getElementById('cartTotal').textContent = total.toFixed(2) + " Ø¬";
}

function modQty(idx, delta) {
    tablesOrder[currentTable][idx].qty += delta;
    if(tablesOrder[currentTable][idx].qty <= 0) tablesOrder[currentTable].splice(idx, 1);
    saveTables(); renderCart(); renderMap();
}

function clearCart() {
    if(!currentTable) return;
    if(confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù…Ù† Ù‡Ø°Ù‡ Ø§Ù„Ø·Ø§ÙˆÙ„Ø©ØŸ')) { 
        tablesOrder[currentTable] = []; saveTables(); renderCart(); renderMap(); 
    }
}

function saveTables() { localStorage.setItem(DB.keys.tables, JSON.stringify(tablesOrder)); }

/* ================== Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯ÙØ¹ ÙˆØ§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ù…ØªÙ‚Ø¯Ù… ================== */
function checkout() {
    if(!currentTable || !tablesOrder[currentTable]?.length) {
        alert('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù„Ø¯ÙØ¹Ù‡Ø§!');
        return;
    }
    
    const cart = tablesOrder[currentTable];
    const total = cart.reduce((a,b)=>a+(b.price*b.qty),0);
    const now = new Date();
    const id = Date.now();
    
    // Ø®ØµÙ… Ø§Ù„Ø®Ø§Ù…Ø§Øª Ù…Ù† Ø§Ù„Ù…Ø®Ø²Ù† Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø±ÙŠØ³ÙŠØ¨ÙŠ
    const recipes = DB.getData(DB.keys.recipes) || {};
    const inv = DB.getData(DB.keys.inv) || [];
    let cost = 0;
    
    cart.forEach(item => {
        const rec = recipes[item.id];
        if(rec) {
            rec.forEach(ing => {
                const stockItem = inv.find(x => x.id === ing.invId);
                if(stockItem) {
                    const deduct = ing.qty * item.qty;
                    stockItem.stock -= deduct;
                    cost += (stockItem.avgCost * deduct);
                }
            });
        }
    });
    DB.saveData(DB.keys.inv, inv);

    // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ¹Ø©
    const sale = { id, date: now.toISOString(), items: cart, total, cost, profit: total - cost };
    const sales = DB.getData(DB.keys.sales);
    sales.push(sale);
    DB.saveData(DB.keys.sales, sales);
    
    // ØªØ¬Ù‡ÙŠØ² Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙØ§ØªÙˆØ±Ø©
    const tObj = LAYOUT.find(t => t.id === currentTable);
    const tableName = tObj ? tObj.label : currentTable;
    
    document.getElementById('p_date').textContent = now.toLocaleDateString('ar-EG');
    document.getElementById('p_time').textContent = now.toLocaleTimeString('ar-EG', {hour: '2-digit', minute:'2-digit'});
    document.getElementById('p_id').textContent = id.toString().slice(-6);
    document.getElementById('p_table').textContent = tableName;
    
    document.getElementById('p_items').innerHTML = cart.map(i=>`
        <tr>
            <td>${i.name}</td>
            <td>${i.price}</td>
            <td>${i.qty}</td>
            <td>${i.price * i.qty}</td>
        </tr>
    `).join('');
    
    document.getElementById('p_total').textContent = total.toFixed(2);
    
    // Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ø­ØªÙ‰ ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø«Ù… Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©
    setTimeout(() => {
        window.print();
        
        // ØªÙØ±ÙŠØº Ø§Ù„Ø·Ø§ÙˆÙ„Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©
        tablesOrder[currentTable] = [];
        saveTables(); 
        renderCart(); 
        renderMap(); 
        updateDashboard();
    }, 300);
}

/* ================== Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… ÙˆØ§Ù„Ù…Ø®Ø§Ø²Ù† ================== */
function updateDashboard() {
    const sales = DB.getData(DB.keys.sales);
    const exps = DB.getData(DB.keys.exp);
    const today = new Date().toISOString().split('T')[0];
    
    const todaySales = sales.filter(s => s.date.startsWith(today));
    const todayExp = exps.filter(e => e.date.startsWith(today)).reduce((a,b)=>a+b.amount,0);
    
    const rev = todaySales.reduce((a,b)=>a+b.total,0);
    const cogs = todaySales.reduce((a,b)=>a+(b.cost||0),0);
    
    document.getElementById('dash_sales').textContent = rev + ' Ø¬';
    document.getElementById('dash_exp').textContent = todayExp + ' Ø¬';
    document.getElementById('dash_profit').textContent = (rev - cogs - todayExp).toFixed(1) + ' Ø¬';
}

function openModal(id) { document.getElementById(id).classList.add('open'); }
function closeModal() { document.querySelectorAll('.modal').forEach(m => m.classList.remove('open')); }

function saveInventory() {
    const name = document.getElementById('new_inv_name').value;
    const qty = parseFloat(document.getElementById('new_inv_qty').value);
    const cost = parseFloat(document.getElementById('new_inv_cost').value);
    const unit = document.getElementById('new_inv_unit').value;
    const type = document.getElementById('new_inv_type').value;
    
    if(!name || !qty) return;
    const inv = DB.getData(DB.keys.inv);
    const exist = inv.find(i => i.name === name);
    if(exist) { exist.stock += qty; } 
    else { inv.push({ id: 'inv_'+Date.now(), name, type, unit, stock: qty, avgCost: cost/qty }); }
    DB.saveData(DB.keys.inv, inv);
    closeModal(); renderInventory(); setupRecipeSelect();
}

function renderInventory() {
    const inv = DB.getData(DB.keys.inv);
    const term = document.getElementById('invSearch').value.toLowerCase();
    document.getElementById('inventoryTable').innerHTML = inv.filter(i => i.name.toLowerCase().includes(term)).map(i => `
        <tr><td>${i.name}</td><td>${i.type=='raw'?'Ø®Ø§Ù…Ø©':'Ø¬Ø§Ù‡Ø²'}</td>
        <td style="color:${i.stock<5?'red':''};font-weight:900">${i.stock.toFixed(1)} ${i.unit}</td>
        <td><button style="color:red;border:none;background:none;cursor:pointer" onclick="delInv('${i.id}')"><i class="fas fa-trash-alt"></i></button></td></tr>
    `).join('');
}

function delInv(id) {
    if(confirm('Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„ØµÙ†ÙØŸ')) { const inv = DB.getData(DB.keys.inv).filter(i=>i.id!==id); DB.saveData(DB.keys.inv, inv); renderInventory(); }
}

function saveExpense() {
    const title = document.getElementById('new_exp_title').value;
    const amount = parseFloat(document.getElementById('new_exp_val').value);
    if(!title || !amount) return;
    const exp = DB.getData(DB.keys.exp);
    exp.push({id: Date.now(), date: new Date().toISOString(), title, amount});
    DB.saveData(DB.keys.exp, exp);
    closeModal(); renderExpenses();
}

function renderExpenses() {
    const exp = DB.getData(DB.keys.exp);
    document.getElementById('expTableBody').innerHTML = exp.slice(-10).reverse().map(e => `
        <tr><td>${new Date(e.date).toLocaleDateString()}</td><td>${e.title}</td>
        <td style="color:var(--danger);font-weight:900">-${e.amount}</td></tr>
    `).join('');
}

function setupRecipeSelect() {
    const sel = document.getElementById('recipeProdSelect');
    sel.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†ØªØ¬ Ù…Ù† Ø§Ù„Ù…Ù†ÙŠÙˆ --</option>';
    let all = [];
    Object.keys(MENU).forEach(k => {
        if(MENU[k].isComplex) MENU[k].subcats.forEach(s => all.push(...s.items));
        else all.push(...MENU[k].items);
    });
    all.forEach(p => sel.innerHTML += `<option value="${p.id}">${p.name}</option>`);
}

function loadRecipe() {
    const pid = document.getElementById('recipeProdSelect').value;
    if(!pid) { document.getElementById('recipeEditor').style.display='none'; return; }
    document.getElementById('recipeEditor').style.display='block';
    document.getElementById('recipeProdName').textContent = document.querySelector(`#recipeProdSelect option[value="${pid}"]`).text;
    const recipes = DB.getData(DB.keys.recipes);
    renderRecipeRows(recipes[pid] || []);
}

function renderRecipeRows(rows) {
    const container = document.getElementById('recipeIngsContainer');
    const inv = DB.getData(DB.keys.inv);
    container.innerHTML = '';
    rows.forEach(r => {
        const div = document.createElement('div');
        div.style.cssText = "display:flex;gap:10px;margin-bottom:10px";
        const opts = inv.map(i => `<option value="${i.id}" ${i.id===r.invId?'selected':''}>${i.name}</option>`).join('');
        div.innerHTML = `<select class="form-control r-ing" style="margin:0">${opts}</select><input type="number" class="form-control r-qty" value="${r.qty}" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©" style="width:100px;margin:0"><button onclick="this.parentElement.remove()" style="color:var(--danger);border:none;background:none;cursor:pointer"><i class="fas fa-times-circle"></i></button>`;
        container.appendChild(div);
    });
}

function addRecipeRow() {
    const cur = Array.from(document.querySelectorAll('#recipeIngsContainer > div')).map(d => ({
        invId: d.querySelector('.r-ing').value,
        qty: parseFloat(d.querySelector('.r-qty').value)
    }));
    cur.push({invId:'', qty:0});
    renderRecipeRows(cur);
}

function saveRecipe() {
    const pid = document.getElementById('recipeProdSelect').value;
    const rec = Array.from(document.querySelectorAll('#recipeIngsContainer > div')).map(d => ({
        invId: d.querySelector('.r-ing').value,
        qty: parseFloat(d.querySelector('.r-qty').value)
    }));
    const recipes = DB.getData(DB.keys.recipes);
    recipes[pid] = rec;
    DB.saveData(DB.keys.recipes, recipes);
    alert('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!');
}

function genReport() {
    const s = document.getElementById('repStart').value;
    const e = document.getElementById('repEnd').value;
    if(!s || !e) return alert('Ø­Ø¯Ø¯ Ø§Ù„ØªØ§Ø±ÙŠØ® Ù…Ù† ÙˆØ¥Ù„Ù‰');
    const sales = DB.getData(DB.keys.sales).filter(x => x.date >= s && x.date <= e+'T23:59');
    const exps = DB.getData(DB.keys.exp).filter(x => x.date >= s && x.date <= e+'T23:59');
    const tSales = sales.reduce((a,b)=>a+b.total,0);
    const tCost = sales.reduce((a,b)=>a+(b.cost||0),0);
    const tExp = exps.reduce((a,b)=>a+b.amount,0);
    document.getElementById('repResult').style.display = 'block';
    document.getElementById('val_sales').textContent = tSales + ' Ø¬';
    document.getElementById('val_cost').textContent = tCost.toFixed(2) + ' Ø¬';
    document.getElementById('val_exp').textContent = tExp + ' Ø¬';
    document.getElementById('val_profit').textContent = (tSales - tCost - tExp).toFixed(2) + ' Ø¬';
}

// Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„
init();
</script>
</body>
</html>
