<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>نيو كافية منيو - NEO CAFE</title>

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">

<style>
:root{
  --neo-green:#124d33;
  --neo-green-2:#21593f;
  --neo-beige:#f6efe6;
  --neo-cream:#fbf4e9;
  --muted:#6b6b6b;
  --accent:#e8ddcc;
  --card-radius:14px;
  --shadow: 0 18px 40px rgba(18,77,51,0.06);
}

/* reset */
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%}
body{
  background:var(--neo-beige);
  font-family:"Cairo",sans-serif;
  color:#0b0b0b;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
  line-height:1.4;
  -webkit-tap-highlight-color: transparent;
}

/* header */
.header{
  background: linear-gradient(180deg,var(--neo-cream),var(--neo-beige));
  padding:18px 14px 8px;
  text-align:center;
  position:relative;
}
.header h1{
  color:var(--neo-green);
  font-weight:800;
  font-size:20px;
  margin-bottom:6px;
}
.header p{
  color:var(--neo-green-2);
  font-weight:700;
}

/* logo top-right - doubled size */
.logo{
  position:absolute;
  right:12px;
  top:12px;
  width:140px;
  height:auto;
  object-fit:contain;
}

/* categories organized into 3 rows */
.cats-grid{
  display:flex;
  flex-direction:column;
  gap:8px;
  padding:12px;
}
.cats-row{
  display:flex;
  gap:10px;
  overflow-x:auto;
  -webkit-overflow-scrolling:touch;
}
.cat{
  flex:0 0 auto;
  background:#fff;
  border-radius:999px;
  padding:10px 14px;
  border:1px solid rgba(18,77,51,0.06);
  font-weight:800;
  color:var(--neo-green);
  cursor:pointer;
  white-space:nowrap;
  box-shadow: 0 6px 20px rgba(0,0,0,0.03);
}
.cat.active{
  background:linear-gradient(180deg,var(--neo-green),var(--neo-green-2));
  color:white;
  box-shadow:0 20px 50px rgba(18,77,51,0.14);
}

/* container */
.container{max-width:980px;margin:8px auto;padding:6px 12px 100px}

/* section title */
.section-title{
  color:var(--neo-green-2);
  font-weight:900;
  font-size:18px;
  margin:8px 0 12px;
  text-align:right;
}

/* product grid: always two columns */
.grid{
  display:grid;
  grid-template-columns: repeat(2, 1fr);
  gap:12px;
}

/* each card */
.product-card{
  background:#fff;
  border-radius:12px;
  padding:8px;
  box-shadow:var(--shadow);
  overflow:hidden;
  display:flex;
  flex-direction:column;
  transition: transform .14s ease, box-shadow .14s ease;
}
.product-card:hover{ transform: translateY(-6px); box-shadow: 0 30px 80px rgba(18,77,51,0.12); }
.product-img{
  width:100%;
  height:140px;
  object-fit:cover;
  border-radius:10px;
  background:#f2f2f2;
}
.product-body{padding:10px 6px;display:flex;flex-direction:column;gap:8px}
.row-title{display:flex;justify-content:space-between;align-items:center;gap:8px}
.product-name{font-weight:900;color:var(--neo-green);font-size:15px;line-height:1.1}
.product-desc{color:var(--muted);font-size:13px;min-height:36px}
.product-footer{display:flex;justify-content:space-between;align-items:center;gap:8px}
.price{color:var(--neo-green);font-weight:900}
.add-btn{
  background:var(--neo-green);
  color:#fff;
  padding:8px 12px;
  border-radius:10px;
  border:0;
  font-weight:900;
  cursor:pointer;
  box-shadow:0 8px 20px rgba(18,77,51,0.12);
}

/* floating cart - fixed on bottom-right */
.cart-float{position:fixed;right:14px;bottom:14px;z-index:9999;display:flex;align-items:center;gap:10px}
.cart-btn{
  background:var(--neo-green);
  color:#fff;
  padding:12px 14px;
  border-radius:14px;
  display:flex;
  align-items:center;
  gap:10px;
  box-shadow:0 30px 80px rgba(18,77,51,0.24);
  cursor:pointer;
  transform-origin:center;
}
.cart-count{background:#ffeb3b;color:#111;padding:6px 10px;border-radius:999px;font-weight:900;min-width:26px;text-align:center;}

/* toast */
.toast{position:fixed;left:50%;transform:translateX(-50%);bottom:150px;background:rgba(0,0,0,0.78);color:#fff;padding:10px 14px;border-radius:10px;font-weight:900;z-index:99999;opacity:0;transition:opacity .2s}

/* modal */
.modal-back{position:fixed;inset:0;background:rgba(0,0,0,0.45);display:none;align-items:flex-end;justify-content:center;padding:12px;z-index:9998}
.modal-back.show{display:flex}
.modal{width:100%;max-width:760px;background:#fff;border-radius:12px;padding:12px;box-shadow:0 30px 80px rgba(0,0,0,0.25);direction:rtl}
.modal h3{margin:0 0 8px;color:var(--neo-green);font-weight:900}
.modal .list{max-height:60vh;overflow:auto;padding-right:6px}
.modal .list .item{display:flex;align-items:center;justify-content:space-between;padding:10px 6px;border-bottom:1px solid #f3f3f3}

/* footer */
footer{padding:18px 12px;text-align:center;color:var(--muted)}
.footer-socials{display:flex;gap:10px;justify-content:center;margin-bottom:10px}
.footer-socials a{padding:10px 14px;border-radius:12px;color:#fff;font-weight:900;text-decoration:none}
.fb{background:#1877F2}
.ig{background:linear-gradient(45deg,#f58529,#dd2a7b,#8134af)}
.tt{background:#010101}

/* small/mobile adjustments (keep grid 2 columns as requested) */
@media (max-width:420px){
  .product-img{height:150px}
  .logo{width:120px}
  .cat{padding:8px 10px}
  .grid{gap:10px}
}

/* ensure long product names wrap */
.product-name{word-break:break-word}

/* accessibility focus */
.add-btn:focus,.cat:focus,.cart-btn:focus{outline:3px solid rgba(18,77,51,0.12)}
</style>
</head>
<body>

<header class="header">
  <img src="assets/images/logo.png" alt="NEO Cafe" class="logo" id="topLogo" onerror="this.style.display='none'">
  <h1>نيو كافية منيو - NEO CAFÉ</h1>
  <p>Make It NEO Time</p>
</header>

<!-- categories in 3 rows -->
<div class="cats-grid" aria-label="أقسام المنيو">
  <div class="cats-row">
    <div class="cat active" data-cat="all">الكل</div>
    <div class="cat" data-cat="cold">مشروبات باردة</div>
    <div class="cat" data-cat="hot">مشروبات ساخنة</div>
  </div>
  <div class="cats-row">
    <div class="cat" data-cat="soft">سوفت درينك</div>
    <div class="cat" data-cat="dessert">أطباق ديزيرت</div>
    <div class="cat" data-cat="special">مميز نيو</div>
  </div>
  <div class="cats-row">
    <div class="cat" data-cat="fun">دلع نفسك في نيو - مجانًا</div>
  </div>
</div>

<main class="container" id="mainContent">
  <div id="sections"></div>
</main>

<!-- floating cart -->
<div class="cart-float" aria-hidden="false">
  <div id="cartBtn" class="cart-btn" role="button" aria-label="افتح السلة">
    <div class="cart-count" id="cartCount">0</div>
    <div style="font-weight:900">السلة</div>
  </div>
</div>

<!-- modal backdrop -->
<div id="modalBackdrop" class="modal-back" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" id="modalContent">
    <h3 id="modalTitle">قائمة</h3>
    <div class="list" id="modalList"></div>
    <div style="display:flex;justify-content:space-between;margin-top:8px">
      <button id="closeModal" class="add-btn" style="background:#888">إغلاق</button>
      <button id="checkoutNow" class="add-btn" style="background:var(--neo-green)">اطلب دلوقتي</button>
    </div>
  </div>
</div>

<div id="miniToast" class="toast" role="status" aria-live="polite"></div>

<footer>
  <div style="font-weight:800;margin-bottom:8px">تابعنا على السوشيال</div>
  <div class="footer-socials">
    <a class="fb" href="https://facebook.com/neo.cafe.eg" target="_blank">Facebook</a>
    <a class="ig" href="https://instagram.com/neocafe.eg" target="_blank">Instagram</a>
    <a class="tt" href="https://tiktok.com/@neo.cafe.eg" target="_blank">TikTok</a>
  </div>
  <div style="font-weight:700;color:var(--neo-green)">❤️ شكراً لاختياركم نيو كافية — حب وتمييز لعملاء نيو دائماً</div>
</footer>

<script>
/* =================== CONFIG =================== */
const CART_KEY = 'neoCafe_cart_v1';
localStorage.removeItem(CART_KEY); // reset on refresh as requested

/* =================== MENU DATA (updated prices & items) =================== */
const MENU = {
  hot: {
    title: 'المشروبات الساخنة',
    items: [
      {id:'hot_01', name:'شاي', desc:'', price:10, img:'assets/images/placeholder-1.png'},
      {id:'hot_02', name:'شاي ليبتون', desc:'', price:15, img:'assets/images/placeholder-2.png'},
      {id:'hot_03', name:'شاي أخضر', desc:'', price:15, img:'assets/images/placeholder-3.png'},
      {id:'hot_04', name:'شاي حليب', desc:'', price:20, img:'assets/images/placeholder-4.png'},
      {id:'hot_05', name:'شاي نكهات', desc:'', price:20, img:'assets/images/placeholder-5.png'},
      {id:'hot_06', name:'نعناع', desc:'', price:15, img:'assets/images/placeholder-6.png'},
      {id:'hot_07', name:'ينسون', desc:'', price:15, img:'assets/images/placeholder-7.png'},
      {id:'hot_08', name:'جنزبيل', desc:'', price:15, img:'assets/images/placeholder-8.png'},
      {id:'hot_09', name:'اسبريسو سنجل', desc:'', price:35, img:'assets/images/placeholder-9.png'},
      {id:'hot_10', name:'اسبريسو دبل', desc:'', price:40, img:'assets/images/placeholder-10.png'},
      {id:'hot_11', name:'قهوة تركي سنجل', desc:'', price:20, img:'assets/images/placeholder-11.png'},
      {id:'hot_12', name:'قهوة تركي دبل', desc:'', price:25, img:'assets/images/placeholder-12.png'},
      {id:'hot_13', name:'قهوة فرنساوي', desc:'', price:35, img:'assets/images/placeholder-13.png'},
      {id:'hot_14', name:'قهوة بندق', desc:'', price:35, img:'assets/images/placeholder-14.png'},
      {id:'hot_15', name:'قهوة نوتيلا', desc:'', price:40, img:'assets/images/placeholder-15.png'},
      {id:'hot_16', name:'قهوة بستاشيو', desc:'', price:40, img:'assets/images/placeholder-16.png'},
      {id:'hot_17', name:'لاتيه', desc:'', price:50, img:'assets/images/placeholder-17.png'},
      {id:'hot_18', name:'لاتيه فلفر', desc:'', price:55, img:'assets/images/placeholder-18.png'},
      {id:'hot_19', name:'اسبانش لاتيه', desc:'', price:60, img:'assets/images/placeholder-19.png'},
      {id:'hot_20', name:'كابتشينو', desc:'', price:55, img:'assets/images/placeholder-20.png'},
      {id:'hot_21', name:'نسكافيه حليب', desc:'', price:40, img:'assets/images/placeholder-21.png'},
      {id:'hot_22', name:'نسكافيه بلاك', desc:'', price:30, img:'assets/images/placeholder-22.png'},
      {id:'hot_23', name:'امريكانو كوفي', desc:'', price:45, img:'assets/images/placeholder-23.png'},
      {id:'hot_24', name:'هوت شوكليت', desc:'', price:45, img:'assets/images/placeholder-24.png'},
      {id:'hot_25', name:'هوت سيدر', desc:'', price:40, img:'assets/images/placeholder-25.png'},
      {id:'hot_26', name:'سحلب', desc:'', price:35, img:'assets/images/placeholder-26.png'},
      {id:'hot_27', name:'سحلب مكسرات', desc:'', price:45, img:'assets/images/placeholder-27.png'},
      {id:'hot_28', name:'سحلب لوتس', desc:'', price:50, img:'assets/images/placeholder-28.png'},
      {id:'hot_29', name:'سحلب مونيلا', desc:'', price:50, img:'assets/images/placeholder-29.png'},
      {id:'hot_30', name:'سحلب فواكهه', desc:'', price:50, img:'assets/images/placeholder-30.png'},
      {id:'hot_31', name:'سحلب نيو', desc:'', price:60, img:'assets/images/placeholder-31.png'}
    ]
  },

  cold: {
    title: 'المشروبات الباردة',
    subcats: [
      { key:'milkshake', title:'ميلك شيك', items:[
        {id:'ms_01',name:'ميلك شيك فانيلا',desc:'',price:45,img:'assets/images/placeholder-ms1.png'},
        {id:'ms_02',name:'ميلك شيك اوريو',desc:'',price:55,img:'assets/images/placeholder-ms2.png'},
        {id:'ms_03',name:'ميلك شيك هوهوز',desc:'',price:50,img:'assets/images/placeholder-ms3.png'},
        {id:'ms_04',name:'ميلك شيك كراميل',desc:'',price:55,img:'assets/images/placeholder-ms4.png'},
        {id:'ms_05',name:'ميلك شيك فراولة',desc:'',price:55,img:'assets/images/placeholder-ms5.png'},
        {id:'ms_06',name:'ميلك شيك مانجو',desc:'',price:55,img:'assets/images/placeholder-ms6.png'},
        {id:'ms_07',name:'ميلك شيك اسنيكرز',desc:'',price:60,img:'assets/images/placeholder-ms7.png'},
        {id:'ms_08',name:'ميلك شيك مورو',desc:'',price:60,img:'assets/images/placeholder-ms8.png'},
        {id:'ms_09',name:'ميلك شيك شوكليت',desc:'',price:55,img:'assets/images/placeholder-ms9.png'},
        {id:'ms_10',name:'ميلك شيك كندر',desc:'',price:55,img:'assets/images/placeholder-ms10.png'},
        {id:'ms_11',name:'ميلك شيك نسكافيه',desc:'',price:45,img:'assets/images/placeholder-ms11.png'},
        {id:'ms_12',name:'ميلك شيك موز نوتيلا',desc:'',price:50,img:'assets/images/placeholder-ms12.png'}
      ]},
      { key:'frapp', title:'فرباتشينو', items:[
        {id:'fr_01',name:'نكهات',desc:'',price:55,img:'assets/images/placeholder-fr1.png'},
        {id:'fr_02',name:'أورو',desc:'',price:55,img:'assets/images/placeholder-fr2.png'},
        {id:'fr_03',name:'لوتس',desc:'',price:60,img:'assets/images/placeholder-fr3.png'}
      ]},
      { key:'iced', title:'آيس', items:[
        {id:'ice_01',name:'ايس لاتيه',desc:'',price:50,img:'assets/images/placeholder-ice1.png'},
        {id:'ice_02',name:'ايس كوفي',desc:'',price:40,img:'assets/images/placeholder-ice2.png'},
        {id:'ice_03',name:'ايس امريكان',desc:'',price:50,img:'assets/images/placeholder-ice3.png'},
        {id:'ice_04',name:'ايس سبانش لاتيه',desc:'',price:65,img:'assets/images/placeholder-ice4.png'},
        {id:'ice_05',name:'ايس موكا',desc:'',price:60,img:'assets/images/placeholder-ice5.png'},
        {id:'ice_06',name:'ايس لوتس',desc:'',price:40,img:'assets/images/placeholder-ice6.png'},
        {id:'ice_07',name:'ايس كراميل',desc:'',price:40,img:'assets/images/placeholder-ice7.png'}
      ]},
      { key:'fresh', title:'فريش', items:[
        {id:'frs_01',name:'مانجو',desc:'',price:50,img:'assets/images/placeholder-frs1.png'},
        {id:'frs_02',name:'فراولة',desc:'',price:40,img:'assets/images/placeholder-frs2.png'},
        {id:'frs_03',name:'فراولة حليب',desc:'',price:45,img:'assets/images/placeholder-frs3.png'},
        {id:'frs_04',name:'موز حليب',desc:'',price:45,img:'assets/images/placeholder-frs4.png'},
        {id:'frs_05',name:'بلح حليب',desc:'',price:50,img:'assets/images/placeholder-frs5.png'},
        {id:'frs_06',name:'ليمون فريش',desc:'',price:30,img:'assets/images/placeholder-frs6.png'},
        {id:'frs_07',name:'ليمون نعناع فريش',desc:'',price:35,img:'assets/images/placeholder-frs7.png'},
        {id:'frs_08',name:'بطيخ (موسمي)',desc:'',price:40,img:'assets/images/placeholder-frs8.png'},
        {id:'frs_09',name:'برتقال (موسمي)',desc:'',price:40,img:'assets/images/placeholder-frs9.png'},
        {id:'frs_10',name:'كيوي (موسمي)',desc:'',price:60,img:'assets/images/placeholder-frs10.png'},
        {id:'frs_11',name:'كيوي حليب (موسمي)',desc:'',price:70,img:'assets/images/placeholder-frs11.png'},
        {id:'frs_12',name:'افوجاتو عسل',desc:'',price:100,img:'assets/images/placeholder-frs12.png'},
        {id:'frs_13',name:'افوجاتو مكسرات',desc:'',price:120,img:'assets/images/placeholder-frs13.png'},
        {id:'frs_14',name:'جوافة',desc:'',price:40,img:'assets/images/placeholder-frs14.png'},
        {id:'frs_15',name:'كوكتيل',desc:'',price:50,img:'assets/images/placeholder-frs15.png'},
        {id:'frs_16',name:'كوكتيل قطع',desc:'',price:65,img:'assets/images/placeholder-frs16.png'},
        {id:'frs_17',name:'نيو افوجاتو (عسل، مكسرات، مانجو، موز)',desc:'',price:130,img:'assets/images/placeholder-frs17.png'}
      ]},
      { key:'smoothie', title:'سموزي', items:[
        {id:'smz_01',name:'سموزي فراولة',desc:'',price:45,img:'assets/images/placeholder-sm1.png'},
        {id:'smz_02',name:'سموزي مانجو',desc:'',price:45,img:'assets/images/placeholder-sm2.png'},
        {id:'smz_03',name:'سموزي أناناس',desc:'',price:45,img:'assets/images/placeholder-sm3.png'},
        {id:'smz_04',name:'سموزي خوخ',desc:'',price:45,img:'assets/images/placeholder-sm4.png'},
        {id:'smz_05',name:'سموزي كيوي',desc:'',price:45,img:'assets/images/placeholder-sm5.png'},
        {id:'smz_06',name:'سموزي بطيخ',desc:'',price:45,img:'assets/images/placeholder-sm6.png'},
        {id:'smz_07',name:'سموزي بلوبيري',desc:'',price:45,img:'assets/images/placeholder-sm7.png'}
      ]},
      { key:'soda', title:'صودا', items:[
        {id:'sod_01',name:'بلوبيري صودا',desc:'',price:50,img:'assets/images/placeholder-sd1.png'},
        {id:'sod_02',name:'بلو صودا',desc:'',price:50,img:'assets/images/placeholder-sd2.png'},
        {id:'sod_03',name:'برانديت',desc:'',price:50,img:'assets/images/placeholder-sd3.png'},
        {id:'sod_04',name:'فراولة',desc:'',price:50,img:'assets/images/placeholder-sd4.png'},
        {id:'sod_05',name:'أناناس',desc:'',price:50,img:'assets/images/placeholder-sd5.png'},
        {id:'sod_06',name:'خوخ',desc:'',price:50,img:'assets/images/placeholder-sd6.png'},
        {id:'sod_07',name:'موهيتو بأنواعه',desc:'',price:55,img:'assets/images/placeholder-sd7.png'}
      ]},
      { key:'softc', title:'مشروبات غازية', items:[
        {id:'softc_01',name:'V-Cola',desc:'',price:20,img:'assets/images/placeholder-soft1.png'},
        {id:'softc_02',name:'ريد بول',desc:'',price:75,img:'assets/images/placeholder-soft2.png'},
        {id:'softc_03',name:'تويست',desc:'',price:35,img:'assets/images/placeholder-soft3.png'},
        {id:'softc_04',name:'شويبس',desc:'',price:30,img:'assets/images/placeholder-soft4.png'},
        {id:'softc_05',name:'فيروز',desc:'',price:30,img:'assets/images/placeholder-soft5.png'},
        {id:'softc_06',name:'جهينة عصير طبيعي - مانجو/تفاح/برتقال',desc:'',price:15,img:'assets/images/placeholder-soft6.png'},
        {id:'softc_07',name:'جهينة ميكس فراولة حليب',desc:'',price:20,img:'assets/images/placeholder-soft7.png'}
      ]}
    ]
  },

  dessert: {
    title: 'حلويات / أطباق ديزيرت',
    items: [
      {id:'dess_01',name:'وافل كلاسيك',desc:'',price:55,img:'assets/images/placeholder-d1.png'},
      {id:'dess_02',name:'وافل نوتيلا',desc:'',price:65,img:'assets/images/placeholder-d2.png'},
      {id:'dess_03',name:'وافل أوريو',desc:'',price:65,img:'assets/images/placeholder-d3.png'},
      {id:'dess_04',name:'وافل لوتس',desc:'',price:65,img:'assets/images/placeholder-d4.png'},
      {id:'dess_05',name:'وافل بستاشيو',desc:'',price:75,img:'assets/images/placeholder-d5.png'},
      {id:'dess_06',name:'وافل فواكه',desc:'',price:80,img:'assets/images/placeholder-d6.png'},
      {id:'dess_07',name:'مولتن كيك',desc:'',price:60,img:'assets/images/placeholder-d7.png'},
      {id:'dess_08',name:'تشيز كيك',desc:'',price:60,img:'assets/images/placeholder-d8.png'},
      {id:'dess_09',name:'شوكليت كيك',desc:'',price:70,img:'assets/images/placeholder-d9.png'}
    ]
  },

  special: {
    title: 'مميز نيو',
    items: [
      {id:'sp_01',name:'بطاطا عسل + فواكه + مكسرات',desc:'',price:50,img:'assets/images/placeholder-sp1.png'},
      {id:'sp_02',name:'اندومي فراخ قطع طبيعية بتتبيلة نيو المميزة',desc:'',price:40,img:'assets/images/placeholder-sp2.png'},
      {id:'sp_03',name:'كوكتيل نيو المميز',desc:'فاكهة فاخرة + سموزي + عسل + مكسرات + هوهوز + مورو',price:100,img:'assets/images/placeholder-sp3.png'}
    ]
  },

  icecream: {
    title: 'ايس كريم',
    items: [
      {id:'ic_01',name:'بسكوته',desc:'',price:20,img:'assets/images/placeholder-ic1.png'},
      {id:'ic_02',name:'كوب صغير',desc:'',price:20,img:'assets/images/placeholder-ic2.png'},
      {id:'ic_03',name:'كوب وسط',desc:'',price:25,img:'assets/images/placeholder-ic3.png'},
      {id:'ic_04',name:'كوب كبير',desc:'',price:35,img:'assets/images/placeholder-ic4.png'}
    ]
  },

  fun: {
    title: 'دلع نفسك في نيو — (مجانًا)',
    items: [
      {id:'fun_01',name:'لعبة دومينو',desc:'',price:0,img:'assets/images/placeholder-f1.png'},
      {id:'fun_02',name:'كوتشينة',desc:'',price:0,img:'assets/images/placeholder-f2.png'},
      {id:'fun_03',name:'شطرنج',desc:'',price:0,img:'assets/images/placeholder-f3.png'},
      {id:'fun_04',name:'قول أميم',desc:'',price:0,img:'assets/images/placeholder-f4.png'},
      {id:'fun_05',name:'افتح توبيك',desc:'',price:0,img:'assets/images/placeholder-f5.png'}
    ]
  }
};

/* =================== STORAGE HELPERS =================== */
function getCart(){
  try{ const d = localStorage.getItem(CART_KEY); return d ? JSON.parse(d) : []; } catch(e){ return []; }
}
function setCart(cart){
  try{ localStorage.setItem(CART_KEY, JSON.stringify(cart)); renderCartCount(true); } catch(e){ console.error(e); }
}
function calcCartTotals(cart){
  let qty=0, total=0;
  (cart||[]).forEach(i=>{ qty += Number(i.qty||0); total += Number(i.qty||0) * Number(i.price||0); });
  return {qty, total};
}

/* =================== ADD TO CART (single source) =================== */
function addToCart(id, name, price){
  const cart = getCart();
  const found = cart.find(x=> x.id === id);
  if(found){
    found.qty = Number(found.qty) + 1;
  } else {
    cart.push({ id, name, price: Number(price||0), qty: 1 });
  }
  setCart(cart);
}

/* =================== RENDER UI =================== */
const sectionsEl = document.getElementById('sections');

function createTitle(text){ const d = document.createElement('div'); d.className='section-title'; d.textContent = text; return d; }

function createGrid(items){
  const grid = document.createElement('div'); grid.className='grid';
  items.forEach(it=>{
    const card = document.createElement('div'); card.className='product-card';
    card.innerHTML = `
      <img class="product-img" src="${it.img}" alt="${escapeHtml(it.name)}" onerror="this.src='https://via.placeholder.com/800x600?text=NEO'">
      <div class="product-body">
        <div class="row-title">
          <div class="product-name">${escapeHtml(it.name)}</div>
          <div class="price">${it.price===0 ? 'مجانًا' : it.price + ' ج'}</div>
        </div>
        <div class="product-desc">${escapeHtml(it.desc || '')}</div>
        <div class="product-footer">
          <div></div>
          <button class="add-btn" data-id="${it.id}" data-name="${escapeHtml(it.name)}" data-price="${it.price}">أضف</button>
        </div>
      </div>
    `;
    grid.appendChild(card);
  });
  return grid;
}

function renderSections(){
  sectionsEl.innerHTML = '';

  // HOT
  const hot = document.createElement('div'); hot.className='section';
  hot.appendChild(createTitle(MENU.hot.title));
  hot.appendChild(createGrid(MENU.hot.items));
  sectionsEl.appendChild(hot);

  // COLD (render subcat buttons for milkshake/frapp/iced/fresh/smoothie/soda/softc)
  const cold = document.createElement('div'); cold.className='section';
  cold.appendChild(createTitle(MENU.cold.title));
  const preview = document.createElement('div'); preview.style.display='flex'; preview.style.flexWrap='wrap'; preview.style.gap='10px';
  MENU.cold.subcats.forEach(sc=>{
    const btn = document.createElement('div'); btn.className='cat'; btn.textContent = sc.title; btn.dataset.sub = sc.key; preview.appendChild(btn);
  });
  cold.appendChild(preview);
  sectionsEl.appendChild(cold);

  // SOFT/COLD-REMAINDER (we will render subcats inside modal on click)
  // SOFT DRINKS (from cold.subcats.softc rendered in modal only)
  const soft = document.createElement('div'); soft.className='section';
  soft.appendChild(createTitle(MENU.cold.subcats.find(s=>s.key==='softc') ? 'مشروبات معلبة' : 'مشروبات'));
  // show softc directly as grid: locate softc items
  const softc = MENU.cold.subcats.find(s=> s.key === 'softc');
  if(softc){
    soft.appendChild(createGrid(softc.items));
  } else {
    // fallback: show the top soft array if exists
    if(MENU.soft && MENU.soft.items) soft.appendChild(createGrid(MENU.soft.items));
  }
  sectionsEl.appendChild(soft);

  // DESSERT
  const dessert = document.createElement('div'); dessert.className='section';
  dessert.appendChild(createTitle(MENU.dessert.title));
  dessert.appendChild(createGrid(MENU.dessert.items));
  sectionsEl.appendChild(dessert);

  // SPECIAL
  const sp = document.createElement('div'); sp.className='section';
  sp.appendChild(createTitle(MENU.special.title));
  sp.appendChild(createGrid(MENU.special.items));
  sectionsEl.appendChild(sp);

  // ICE CREAM
  const ice = document.createElement('div'); ice.className='section';
  ice.appendChild(createTitle(MENU.icecream.title));
  ice.appendChild(createGrid(MENU.icecream.items));
  sectionsEl.appendChild(ice);

  // FUN
  const fun = document.createElement('div'); fun.className='section';
  fun.appendChild(createTitle(MENU.fun.title));
  fun.appendChild(createGrid(MENU.fun.items));
  sectionsEl.appendChild(fun);
}

/* =================== MODAL (subcats & cart preview) =================== */
const modalBackdrop = document.getElementById('modalBackdrop');
const modalTitle = document.getElementById('modalTitle');
const modalList  = document.getElementById('modalList');
const closeModal = document.getElementById('closeModal');
const checkoutNow = document.getElementById('checkoutNow');

function openSubcat(key){
  const sc = MENU.cold.subcats.find(s=> s.key === key);
  if(!sc) return;
  modalTitle.textContent = sc.title;
  modalList.innerHTML = '';
  sc.items.forEach(it=>{
    const row = document.createElement('div'); row.className='item';
    row.innerHTML = `
      <div style="flex:1">
        <div style="font-weight:900">${escapeHtml(it.name)}</div>
        <div style="color:var(--muted);font-size:13px">${escapeHtml(it.desc || '')}</div>
      </div>
      <div style="display:flex;flex-direction:column;align-items:flex-end;gap:8px">
        <div style="font-weight:900;color:var(--neo-green)">${it.price===0 ? 'مجانًا' : it.price + ' ج'}</div>
        <button class="add-btn" data-id="${it.id}" data-name="${escapeHtml(it.name)}" data-price="${it.price}">أضف</button>
      </div>`;
    modalList.appendChild(row);
  });
  modalBackdrop.classList.add('show');
  modalBackdrop.setAttribute('aria-hidden','false');
}

closeModal.addEventListener('click', ()=> { modalBackdrop.classList.remove('show'); modalBackdrop.setAttribute('aria-hidden','true'); });
modalBackdrop.addEventListener('click',(e)=>{ if(e.target === modalBackdrop){ modalBackdrop.classList.remove('show'); modalBackdrop.setAttribute('aria-hidden','true'); } });
checkoutNow.addEventListener('click', ()=> { window.location.href = 'checkout.html'; });

/* =================== CLICK DELEGATION with guard =================== */
const __neo_last_clicks = {}; // id -> timestamp
const __NEO_GUARD_MS = 600;

document.addEventListener('click', function(e){
  // add button
  const addBtn = e.target.closest('.add-btn');
  if(addBtn && addBtn.dataset && addBtn.dataset.id){
    e.preventDefault(); e.stopPropagation();
    const id = String(addBtn.dataset.id);
    const name = addBtn.dataset.name || (addBtn.closest('.product-card')?.querySelector('.product-name')?.textContent || 'منتج');
    const price = Number(addBtn.dataset.price || 0);
    const now = Date.now();
    if(__neo_last_clicks[id] && (now - __neo_last_clicks[id] < __NEO_GUARD_MS)) return;
    __neo_last_clicks[id] = now;
    setTimeout(()=> { __neo_last_clicks[id] = 0; }, __NEO_GUARD_MS + 50);
    addToCart(id, name, price);
    showToast(`${name} اتضاف للسلة`);
    animateCartPulse();
    return;
  }

  // open cold subcat modal
  const subBtn = e.target.closest('.cat[data-sub]');
  if(subBtn && subBtn.dataset.sub){
    e.preventDefault(); e.stopPropagation();
    openSubcat(subBtn.dataset.sub);
    return;
  }

  // category filter
  const catBtn = e.target.closest('.cat[data-cat]');
  if(catBtn && catBtn.dataset.cat){
    e.preventDefault(); e.stopPropagation();
    document.querySelectorAll('.cat').forEach(c=>c.classList.remove('active'));
    catBtn.classList.add('active');
    filterCategory(catBtn.dataset.cat);
    return;
  }

  // cart btn
  const cartBtn = e.target.closest('#cartBtn');
  if(cartBtn){
    e.preventDefault(); e.stopPropagation();
    openCartPreview();
    return;
  }
});

/* =================== CART UI =================== */
function renderCartCount(animate=false){
  const el = document.getElementById('cartCount');
  const cart = getCart();
  const totals = calcCartTotals(cart);
  el.textContent = totals.qty;
  if(animate){
    el.animate([{ transform: 'scale(1)' }, { transform:'scale(1.18)' }, { transform:'scale(1)' }], { duration: 700 });
  }
}
let cartPulseTimeout = null;
function animateCartPulse(){
  const btn = document.querySelector('.cart-btn');
  if(!btn) return;
  btn.style.transition = 'transform .18s';
  btn.style.transform = 'scale(1.18)';
  clearTimeout(cartPulseTimeout);
  cartPulseTimeout = setTimeout(()=> { btn.style.transform = 'scale(1)'; }, 2000);
}

/* =================== TOAST =================== */
let toastTimer = null;
function showToast(txt){
  const el = document.getElementById('miniToast');
  el.textContent = txt;
  el.style.opacity = '1';
  clearTimeout(toastTimer);
  toastTimer = setTimeout(()=> { el.style.opacity = '0'; }, 1200);
}

/* =================== FILTER =================== */
function filterCategory(cat){
  const sections = document.querySelectorAll('.section');
  sections.forEach(s=> s.style.display = 'none');
  if(cat === 'all'){ sections.forEach(s=> s.style.display = 'block'); window.scrollTo({ top:120, behavior:'smooth' }); return; }
  const map = { hot:0, cold:1, soft:2, dessert:3, special:4, ice:5, fun:6 };
  const idx = map[cat];
  const secList = document.querySelectorAll('.section');
  if(typeof idx === 'number' && secList[idx]) secList[idx].style.display = 'block';
  window.scrollTo({ top:120, behavior:'smooth' });
}

/* =================== MODAL: open cart preview =================== */
function openCartPreview(){
  const cart = getCart();
  modalTitle.textContent = 'السلة';
  modalList.innerHTML = '';
  if(!cart.length){
    modalList.innerHTML = '<div style="padding:12px;color:var(--muted)">السلة فارغة — اذهب للمنيو لإضافة طلبات</div>';
  } else {
    cart.forEach((it, idx)=>{
      const row = document.createElement('div'); row.className='item';
      row.innerHTML = `
        <div style="flex:1">
          <div style="font-weight:900">${escapeHtml(it.name)}</div>
          <div style="color:var(--muted);font-size:13px">${it.price} ج لكل وحدة</div>
        </div>
        <div style="display:flex;flex-direction:column;align-items:flex-end;gap:8px">
          <div style="display:flex;gap:6px;align-items:center">
            <button class="qty-btn" data-action="inc" data-id="${it.id}" style="background:#eee;border-radius:6px;padding:6px 8px;border:0">+</button>
            <div style="min-width:28px;text-align:center;font-weight:900">${it.qty}</div>
            <button class="qty-btn" data-action="dec" data-id="${it.id}" style="background:#eee;border-radius:6px;padding:6px 8px;border:0">-</button>
          </div>
          <button class="remove-btn" data-id="${it.id}" style="background:transparent;border:0;color:#d9534f;font-weight:900">حذف</button>
        </div>
      `;
      modalList.appendChild(row);
    });
    const totals = calcCartTotals(cart);
    const totRow = document.createElement('div');
    totRow.style.padding = '10px 6px';
    totRow.innerHTML = `<div style="font-weight:900;color:var(--neo-green)">الإجمالي: ${totals.total} ج</div>`;
    modalList.appendChild(totRow);
  }
  modalBackdrop.classList.add('show');
  modalBackdrop.setAttribute('aria-hidden','false');
}

/* modal list qty/remove handlers */
modalList.addEventListener('click', function(e){
  const btn = e.target.closest('.qty-btn');
  if(btn){
    e.preventDefault(); e.stopPropagation();
    const id = btn.dataset.id;
    const action = btn.dataset.action;
    changeQty(id, action === 'inc' ? 1 : -1);
    openCartPreview();
    return;
  }
  const rem = e.target.closest('.remove-btn');
  if(rem){
    e.preventDefault(); e.stopPropagation();
    const id = rem.dataset.id;
    removeFromCart(id);
    openCartPreview();
    return;
  }
});

/* change qty / remove */
function changeQty(id, delta){
  const cart = getCart();
  const found = cart.find(x=>x.id===id);
  if(!found) return;
  found.qty = Math.max(0, Number(found.qty) + Number(delta));
  const newCart = cart.filter(x=> Number(x.qty) > 0);
  setCart(newCart);
}
function removeFromCart(id){
  const cart = getCart().filter(x=> x.id !== id);
  setCart(cart);
}

/* =================== UTILS =================== */
function escapeHtml(s){ return String(s||'').replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }

/* =================== INIT =================== */
function init(){
  renderSections();
  renderCartCount(false);

  document.getElementById('closeModal').addEventListener('click',()=>{ modalBackdrop.classList.remove('show'); modalBackdrop.setAttribute('aria-hidden','true'); });
  modalBackdrop.addEventListener('click',(e)=>{ if(e.target === modalBackdrop){ modalBackdrop.classList.remove('show'); modalBackdrop.setAttribute('aria-hidden','true'); } });

  document.getElementById('cartBtn').addEventListener('click', (e)=>{ e.preventDefault(); openCartPreview(); });

  window.scrollTo(0,0);
}

init();
renderCartCount(false);

/* duplicate renderSections (kept for hoisting safety) */
function renderSections(){
  sectionsEl.innerHTML = '';

  // HOT
  const hot = document.createElement('div'); hot.className='section';
  hot.appendChild(createTitle(MENU.hot.title));
  hot.appendChild(createGrid(MENU.hot.items));
  sectionsEl.appendChild(hot);

  // COLD (subcats)
  const cold = document.createElement('div'); cold.className='section';
  cold.appendChild(createTitle(MENU.cold.title));
  const preview = document.createElement('div'); preview.style.display='flex'; preview.style.flexWrap='wrap'; preview.style.gap='10px';
  MENU.cold.subcats.forEach(sc=>{
    const btn = document.createElement('div'); btn.className='cat'; btn.textContent = sc.title; btn.dataset.sub = sc.key; preview.appendChild(btn);
  });
  cold.appendChild(preview);
  sectionsEl.appendChild(cold);

  // SOFT / canned (we put softc items below)
  const soft = document.createElement('div'); soft.className='section';
  soft.appendChild(createTitle('مشروبات غازية ومحليات'));
  const softc = MENU.cold.subcats.find(s=> s.key === 'softc');
  if(softc) soft.appendChild(createGrid(softc.items));
  sectionsEl.appendChild(soft);

  // DESSERT
  const dessert = document.createElement('div'); dessert.className='section';
  dessert.appendChild(createTitle(MENU.dessert.title));
  dessert.appendChild(createGrid(MENU.dessert.items));
  sectionsEl.appendChild(dessert);

  // SPECIAL
  const sp = document.createElement('div'); sp.className='section';
  sp.appendChild(createTitle(MENU.special.title));
  sp.appendChild(createGrid(MENU.special.items));
  sectionsEl.appendChild(sp);

  // ICE CREAM
  const ice = document.createElement('div'); ice.className='section';
  ice.appendChild(createTitle(MENU.icecream.title));
  ice.appendChild(createGrid(MENU.icecream.items));
  sectionsEl.appendChild(ice);

  // FUN
  const fun = document.createElement('div'); fun.className='section';
  fun.appendChild(createTitle(MENU.fun.title));
  fun.appendChild(createGrid(MENU.fun.items));
  sectionsEl.appendChild(fun);
}

/* createGrid helper */
function createGrid(items){
  const grid = document.createElement('div'); grid.className='grid';
  items.forEach(it=>{
    const card = document.createElement('div'); card.className='product-card';
    card.innerHTML = `
      <img class="product-img" src="${it.img}" alt="${escapeHtml(it.name)}" onerror="this.src='https://via.placeholder.com/800x600?text=NEO'">
      <div class="product-body">
        <div class="row-title">
          <div class="product-name">${escapeHtml(it.name)}</div>
          <div class="price">${it.price===0 ? 'مجانًا' : it.price + ' ج'}</div>
        </div>
        <div class="product-desc">${escapeHtml(it.desc || '')}</div>
        <div class="product-footer">
          <div></div>
          <button class="add-btn" data-id="${it.id}" data-name="${escapeHtml(it.name)}" data-price="${it.price}">أضف</button>
        </div>
      </div>
    `;
    grid.appendChild(card);
  });
  return grid;
}

/* ensure cart count accurate */
window.addEventListener('storage', ()=> renderCartCount(false));
renderCartCount(false);
</script>
</body>
</html>
