<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>نيو كافية منيو - NEO CAFE</title>

<!-- Cairo font for Arabic modern look -->
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">

<style>
:root{
  --neo-green:#124d33;
  --neo-green-2:#21593f;
  --neo-beige:#f6efe6;
  --neo-cream:#fbf4e9;
  --muted:#6b6b6b;
  --accent:#e8ddcc;
  --card-radius:14px;
  --shadow: 0 18px 40px rgba(18,77,51,0.06);
}

/* reset */
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%}
body{
  background:var(--neo-beige);
  font-family:"Cairo",sans-serif;
  color:#0b0b0b;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
  line-height:1.4;
  -webkit-tap-highlight-color: transparent;
}

/* header */
.header{
  background: linear-gradient(180deg,var(--neo-cream),var(--neo-beige));
  padding:18px 14px 8px;
  text-align:center;
  position:relative;
}
.header h1{
  color:var(--neo-green);
  font-weight:800;
  font-size:20px;
  margin-bottom:6px;
}
.header p{
  color:var(--neo-green-2);
  font-weight:700;
}

/* logo top-right */
.logo{
  position:absolute;
  right:12px;
  top:12px;
  width:68px;
  height:auto;
  object-fit:contain;
}

/* categories row */
.cats{
  display:flex;
  gap:10px;
  padding:12px;
  overflow-x:auto;
  -webkit-overflow-scrolling:touch;
}
.cat{
  flex:0 0 auto;
  background:#fff;
  border-radius:999px;
  padding:10px 14px;
  border:1px solid rgba(18,77,51,0.06);
  font-weight:800;
  color:var(--neo-green);
  cursor:pointer;
  white-space:nowrap;
  box-shadow: 0 6px 20px rgba(0,0,0,0.03);
}
.cat.active{
  background:linear-gradient(180deg,var(--neo-green),var(--neo-green-2));
  color:white;
  box-shadow:0 20px 50px rgba(18,77,51,0.14);
}

/* container */
.container{max-width:980px;margin:8px auto;padding:6px 12px 80px}

/* section title */
.section-title{
  color:var(--neo-green-2);
  font-weight:900;
  font-size:18px;
  margin:8px 0 12px;
  text-align:right;
}

/* product grid */
.grid{
  display:grid;
  grid-template-columns: repeat(2, 1fr);
  gap:12px;
}

/* each card */
.product-card{
  background:#fff;
  border-radius:12px;
  padding:8px;
  box-shadow:var(--shadow);
  overflow:hidden;
  display:flex;
  flex-direction:column;
  transition: transform .14s ease, box-shadow .14s ease;
}
.product-card:hover{ transform: translateY(-6px); box-shadow: 0 30px 80px rgba(18,77,51,0.12); }
.product-img{
  width:100%;
  height:120px;
  object-fit:cover;
  border-radius:10px;
  background:#f2f2f2;
}
.product-body{padding:10px 6px;display:flex;flex-direction:column;gap:8px}
.row-title{display:flex;justify-content:space-between;align-items:center;gap:8px}
.product-name{font-weight:900;color:var(--neo-green);font-size:15px;line-height:1.1}
.product-desc{color:var(--muted);font-size:13px;min-height:36px}
.product-footer{display:flex;justify-content:space-between;align-items:center;gap:8px}
.price{color:var(--neo-green);font-weight:900}
.add-btn{
  background:var(--neo-green);
  color:#fff;
  padding:8px 12px;
  border-radius:10px;
  border:0;
  font-weight:900;
  cursor:pointer;
  box-shadow:0 8px 20px rgba(18,77,51,0.12);
}

/* floating cart - fixed on bottom-right */
.cart-float{position:fixed;right:14px;bottom:14px;z-index:9999;display:flex;align-items:center;gap:10px}
.cart-btn{
  background:var(--neo-green);
  color:#fff;
  padding:12px 14px;
  border-radius:14px;
  display:flex;
  align-items:center;
  gap:10px;
  box-shadow:0 30px 80px rgba(18,77,51,0.24);
  cursor:pointer;
  transform-origin:center;
}
.cart-icon{width:20px;height:20px;background:transparent;border-radius:6px}
.cart-count{background:#ffeb3b;color:#111;padding:6px 10px;border-radius:999px;font-weight:900;min-width:26px;text-align:center;}

/* toast */
.toast{position:fixed;left:50%;transform:translateX(-50%);bottom:150px;background:rgba(0,0,0,0.78);color:#fff;padding:10px 14px;border-radius:10px;font-weight:900;z-index:99999;opacity:0;transition:opacity .2s}

/* modal for cold subcats and cart mini card */
.modal-back{position:fixed;inset:0;background:rgba(0,0,0,0.45);display:none;align-items:flex-end;justify-content:center;padding:12px;z-index:9998}
.modal-back.show{display:flex}
.modal{width:100%;max-width:760px;background:#fff;border-radius:12px;padding:12px;box-shadow:0 30px 80px rgba(0,0,0,0.25);direction:rtl}
.modal h3{margin:0 0 8px;color:var(--neo-green);font-weight:900}
.modal .list{max-height:60vh;overflow:auto;padding-right:6px}
.modal .list .item{display:flex;align-items:center;justify-content:space-between;padding:10px 6px;border-bottom:1px solid #f3f3f3}

/* footer */
footer{padding:18px 12px;text-align:center;color:var(--muted)}
.footer-socials{display:flex;gap:10px;justify-content:center;margin-bottom:10px}
.footer-socials a{padding:10px 14px;border-radius:12px;color:#fff;font-weight:900;text-decoration:none}
.fb{background:#1877F2}
.ig{background:linear-gradient(45deg,#f58529,#dd2a7b,#8134af)}
.tt{background:#010101}

/* small/mobile adjustments */
@media (max-width:600px){
  .grid{grid-template-columns:repeat(1,1fr);gap:14px} /* SINGLE column on phones as requested */
  .logo{width:58px;right:10px;top:8px}
  .header h1{font-size:18px}
  .product-img{height:160px}
  .cart-btn{padding:10px 12px;border-radius:12px}
}

/* ensure long product names wrap */
.product-name{word-break:break-word}

/* accessibility focus */
.add-btn:focus,.cat:focus,.cart-btn:focus{outline:3px solid rgba(18,77,51,0.12)}
</style>
</head>
<body>

<!-- header -->
<header class="header">
  <img src="assets/images/logo.png" alt="NEO Cafe" class="logo" id="topLogo" onerror="this.style.display='none'">
  <h1>نيو كافية منيو - NEO CAFÉ</h1>
  <p>Make It NEO Time</p>
</header>

<!-- categories -->
<div class="cats" id="catsRow" aria-label="أقسام المنيو">
  <div class="cat active" data-cat="all">الكل</div>
  <div class="cat" data-cat="cold">مشروبات باردة</div>
  <div class="cat" data-cat="hot">مشروبات ساخنة</div>
  <div class="cat" data-cat="soft">سوفت درينك</div>
  <div class="cat" data-cat="dessert">أطباق ديزيرت</div>
  <div class="cat" data-cat="special">مميز نيو</div>
  <div class="cat" data-cat="fun">دلع نفسك في نيو - مجانًا</div>
</div>

<!-- main -->
<main class="container" id="mainContent">
  <div id="sections"></div>
</main>

<!-- floating cart -->
<div class="cart-float" aria-hidden="false">
  <div id="cartBtn" class="cart-btn" role="button" aria-label="افتح السلة">
    <div class="cart-count" id="cartCount">0</div>
    <div style="font-weight:900">السلة</div>
  </div>
</div>

<!-- modal backdrop (used for cold subcats and floating cart view) -->
<div id="modalBackdrop" class="modal-back" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" id="modalContent">
    <h3 id="modalTitle">قائمة</h3>
    <div class="list" id="modalList"></div>
    <div style="display:flex;justify-content:space-between;margin-top:8px">
      <button id="closeModal" class="add-btn" style="background:#888">إغلاق</button>
      <button id="checkoutNow" class="add-btn" style="background:var(--neo-green)">اطلب دلوقتي</button>
    </div>
  </div>
</div>

<!-- toast -->
<div id="miniToast" class="toast" role="status" aria-live="polite"></div>

<!-- footer -->
<footer>
  <div style="font-weight:800;margin-bottom:8px">تابعنا على السوشيال</div>
  <div class="footer-socials">
    <a class="fb" href="https://facebook.com/neo.cafe.eg" target="_blank">Facebook</a>
    <a class="ig" href="https://instagram.com/neocafe.eg" target="_blank">Instagram</a>
    <a class="tt" href="https://tiktok.com/@neo.cafe.eg" target="_blank">TikTok</a>
  </div>
  <div style="font-weight:700;color:var(--neo-green)">❤️ شكراً لاختياركم نيو كافية — حب وتمييز لعملاء نيو دائماً</div>
</footer>

<script>
/* =========================================================
   Index single-file JS
   - Cart guarded against double-add
   - Cart resets on refresh (as requested)
   - All menu data included
   - Single delegated click listener
   - Floating cart modal preview + "اطلب دلوقتي" button (links checkout.html)
   ========================================================= */

/* ------------- CONFIG ------------- */
const CART_KEY = 'neoCafe_cart_v1';

/* Reset cart on load (clear localStorage key) so refresh = empty cart */
localStorage.removeItem(CART_KEY);

/* ------------- MENU DATA (from your list) ------------- */
/* Data includes id, name, desc, price, img (placeholder) */
const MENU = {
  hot: {
    title: 'المشروبات الساخنة',
    items: [
      {id:'hot_1', name:'شاي', desc:'شاي أسود مصري تقليدي', price:18, img:'assets/images/placeholder-1.png'},
      {id:'hot_2', name:'شاي أخضر', desc:'شاي أخضر طازج', price:22, img:'assets/images/placeholder-2.png'},
      {id:'hot_3', name:'شاي نكهات', desc:'اختار نكهتك', price:20, img:'assets/images/placeholder-3.png'},
      {id:'hot_4', name:'شاي بحليب', desc:'شاي بحليب دافئ', price:20, img:'assets/images/placeholder-4.png'},
      {id:'hot_5', name:'نعناع', desc:'نعناع طازج', price:18, img:'assets/images/placeholder-5.png'},
      {id:'hot_6', name:'ينسون', desc:'ينسون مهدئ', price:18, img:'assets/images/placeholder-6.png'},
      {id:'hot_7', name:'جنزبيل', desc:'جنزبيل صحي', price:20, img:'assets/images/placeholder-7.png'},
      {id:'hot_8', name:'اسبريسو', desc:'اسبريسو مركز', price:25, img:'assets/images/placeholder-8.png'},
      {id:'hot_9', name:'اسبريسو دبل', desc:'قوة مضاعفة', price:35, img:'assets/images/placeholder-9.png'},
      {id:'hot_10', name:'قهوة تركي سنجل', desc:'تركي سنجل', price:30, img:'assets/images/placeholder-10.png'},
      {id:'hot_11', name:'قهوة تركي دبل', desc:'تركي دبل', price:45, img:'assets/images/placeholder-11.png'},
      {id:'hot_12', name:'قهوة فرنساوي', desc:'قهوة خاصة', price:40, img:'assets/images/placeholder-12.png'},
      {id:'hot_13', name:'قهوة بندق', desc:'نكهة بندق', price:45, img:'assets/images/placeholder-13.png'},
      {id:'hot_14', name:'قهوة نوتيلا', desc:'قهوة بطعم نوتيلا', price:55, img:'assets/images/placeholder-14.png'},
      {id:'hot_15', name:'قهوة بستاشيو', desc:'قهوة بستاشيو', price:60, img:'assets/images/placeholder-15.png'},
      {id:'hot_16', name:'لاتيه', desc:'لاتيه كريمي', price:45, img:'assets/images/placeholder-16.png'},
      {id:'hot_17', name:'اسبانش لاتيه', desc:'لمسة اسبانية', price:55, img:'assets/images/placeholder-17.png'},
      {id:'hot_18', name:'كابتشينو', desc:'رغوة مثالية', price:50, img:'assets/images/placeholder-18.png'},
      {id:'hot_19', name:'نسكافيه', desc:'خيار سريع', price:30, img:'assets/images/placeholder-19.png'},
      {id:'hot_20', name:'أميركان كوفي', desc:'قهوة امريكية', price:35, img:'assets/images/placeholder-20.png'},
      {id:'hot_21', name:'هوت شوكليت', desc:'شوكليت غني', price:45, img:'assets/images/placeholder-21.png'},
      {id:'hot_22', name:'هوت سيدر', desc:'تفاح وتوابل', price:40, img:'assets/images/placeholder-22.png'},
      {id:'hot_23', name:'سحلب', desc:'سحلب تقليدي', price:50, img:'assets/images/placeholder-23.png'},
      {id:'hot_24', name:'سحلب مكسرات', desc:'مع مكسرات', price:65, img:'assets/images/placeholder-24.png'},
      {id:'hot_25', name:'سحلب لوتس', desc:'نكهة لوتس', price:70, img:'assets/images/placeholder-25.png'},
      {id:'hot_26', name:'سحلب بستاشيو', desc:'بستاشيو فاخر', price:75, img:'assets/images/placeholder-26.png'},
      {id:'hot_27', name:'سحلب نوتيلا', desc:'نوتيلا', price:75, img:'assets/images/placeholder-27.png'},
      {id:'hot_28', name:'سحلب فواكه', desc:'قطع فواكه', price:80, img:'assets/images/placeholder-28.png'}
    ]
  },

  cold: {
    title: 'المشروبات الباردة',
    subcats: [
      { key:'milkshake', title:'ملك تشيك (Milkshake)', items:[
        {id:'milk_1',name:'ملك تشيك - أوريو',desc:'ميلك شيك قطع أوريو',price:75,img:'assets/images/placeholder-31.png'},
        {id:'milk_2',name:'ملك تشيك - هوهوز',desc:'نكهة هوهوز',price:75,img:'assets/images/placeholder-32.png'},
        {id:'milk_3',name:'ملك تشيك - فانليا',desc:'فانليا كريمي',price:75,img:'assets/images/placeholder-33.png'},
        {id:'milk_4',name:'ملك تشيك - كراميل',desc:'كراميل غني',price:75,img:'assets/images/placeholder-34.png'},
        {id:'milk_5',name:'ملك تشيك - فراولة',desc:'فراولة طازجة',price:75,img:'assets/images/placeholder-35.png'},
        {id:'milk_6',name:'ملك تشيك - مانجو',desc:'مانجو طبيعي',price:75,img:'assets/images/placeholder-36.png'},
        {id:'milk_7',name:'ملك تشيك - اسنيكرز',desc:'نكهة اسنيكرز',price:80,img:'assets/images/placeholder-37.png'},
        {id:'milk_8',name:'ملك تشيك - مورو',desc:'مورو شوكولاته',price:75,img:'assets/images/placeholder-38.png'},
        {id:'milk_9',name:'ملك تشيك - شوكلت',desc:'شوكولاتة غنية',price:75,img:'assets/images/placeholder-39.png'},
        {id:'milk_10',name:'ملك تشيك - نيو (مورو/هوهوز/أوريو)',desc:'تشكيلة نيو',price:85,img:'assets/images/placeholder-40.png'}
      ]},
      { key:'iced', title:'آيس (Iced)', items:[
        {id:'ice_1',name:'آيس لاتيه',desc:'لاتيه بارد',price:50,img:'assets/images/placeholder-41.png'},
        {id:'ice_2',name:'آيس كوفي',desc:'قهوة مثلجة',price:50,img:'assets/images/placeholder-42.png'},
        {id:'ice_3',name:'آيس أميركان',desc:'أميركان بارد',price:45,img:'assets/images/placeholder-43.png'},
        {id:'ice_4',name:'آيس سبانش لاتيه',desc:'اسبانيش بارد',price:60,img:'assets/images/placeholder-44.png'}
      ]},
      { key:'frapp', title:'فرابتشينو / فربتشينو', items:[
        {id:'frap_1',name:'فرابتشينو - شوكليت',desc:'قطع شوكولاتة',price:60,img:'assets/images/placeholder-45.png'},
        {id:'frap_2',name:'فرابتشينو - كراميل',desc:'كراميل مخفوق',price:60,img:'assets/images/placeholder-46.png'},
        {id:'frap_3',name:'فرابتشينو - أوريو',desc:'أوريو مقرمش',price:60,img:'assets/images/placeholder-47.png'},
        {id:'frap_4',name:'فرابتشينو - اسنيكرز',desc:'نكهة اسنيكرز',price:65,img:'assets/images/placeholder-48.png'}
      ]},
      { key:'fresh', title:'فريش (عصائر طازجة)', items:[
        {id:'fresh_1',name:'فريش مانجو',desc:'مانجو طبيعي',price:55,img:'assets/images/placeholder-51.png'},
        {id:'fresh_2',name:'فريش فراولة',desc:'فراولة طازجة',price:55,img:'assets/images/placeholder-52.png'},
        {id:'fresh_3',name:'فراولة لبن',desc:'فراولة مع لبن',price:55,img:'assets/images/placeholder-53.png'},
        {id:'fresh_4',name:'موز لبن',desc:'كلاسيكي',price:55,img:'assets/images/placeholder-54.png'},
        {id:'fresh_5',name:'بلح',desc:'عصير بلح',price:45,img:'assets/images/placeholder-55.png'},
        {id:'fresh_6',name:'بطيخ',desc:'منعش',price:50,img:'assets/images/placeholder-56.png'},
        {id:'fresh_7',name:'برتقال',desc:'عصير برتقال',price:45,img:'assets/images/placeholder-57.png'},
        {id:'fresh_8',name:'كيوي (موسمي)',desc:'كيوي موسمي',price:60,img:'assets/images/placeholder-58.png'},
        {id:'fresh_9',name:'افوجاتو',desc:'افوجاتو لذيذ',price:65,img:'assets/images/placeholder-59.png'},
        {id:'fresh_10',name:'جوافة',desc:'جوافة صحية',price:50,img:'assets/images/placeholder-60.png'},
        {id:'fresh_11',name:'نيو (تشكيلة)',desc:'تشكيلة نيو',price:70,img:'assets/images/placeholder-61.png'},
        {id:'fresh_12',name:'فريش كوكتيل',desc:'مزيج فواكه',price:75,img:'assets/images/placeholder-62.png'},
        {id:'fresh_13',name:'كوكتيل قطع',desc:'قطع فاكهة',price:80,img:'assets/images/placeholder-63.png'}
      ]},
      { key:'smoothie', title:'سموثي / اسموزي', items:[
        {id:'sm_1',name:'اسموزي فراولة',desc:'سموثي فراولة',price:65,img:'assets/images/placeholder-71.png'},
        {id:'sm_2',name:'اسموزي مانجو',desc:'سموثي مانجو',price:65,img:'assets/images/placeholder-72.png'},
        {id:'sm_3',name:'اسموزي أناناس',desc:'سموثي أناناس',price:65,img:'assets/images/placeholder-73.png'},
        {id:'sm_4',name:'اسموزي خوخ',desc:'سموثي خوخ',price:65,img:'assets/images/placeholder-74.png'},
        {id:'sm_5',name:'اسموزي كيوي',desc:'سموثي كيوي',price:65,img:'assets/images/placeholder-75.png'},
        {id:'sm_6',name:'اسموزي بطيخ',desc:'سموثي بطيخ',price:65,img:'assets/images/placeholder-76.png'},
        {id:'sm_7',name:'اسموزي بلوبري',desc:'سموثي بلوبري',price:75,img:'assets/images/placeholder-77.png'}
      ]},
      { key:'soda', title:'الصودا (Soda / Sparkling)', items:[
        {id:'sd_1',name:'بلوبري صودا',desc:'بلوبري غازي',price:40,img:'assets/images/placeholder-81.png'},
        {id:'sd_2',name:'بلو صودا',desc:'بلو صودا منعشة',price:40,img:'assets/images/placeholder-82.png'},
        {id:'sd_3',name:'برانديت صودا',desc:'برانديت',price:40,img:'assets/images/placeholder-83.png'},
        {id:'sd_4',name:'فراولة صودا',desc:'فراولة غازية',price:40,img:'assets/images/placeholder-84.png'},
        {id:'sd_5',name:'أناناس صودا',desc:'أناناس مع غاز',price:40,img:'assets/images/placeholder-85.png'},
        {id:'sd_6',name:'خوخ صودا',desc:'خوخ لذيذ',price:40,img:'assets/images/placeholder-86.png'},
        {id:'sd_7',name:'موخيتو',desc:'نعناع وليمون',price:45,img:'assets/images/placeholder-87.png'},
        {id:'sd_8',name:'موخيتو أناناس',desc:'لمسة أناناس',price:45,img:'assets/images/placeholder-88.png'},
        {id:'sd_9',name:'موخيتو فراولة',desc:'موخيتو فراولة',price:45,img:'assets/images/placeholder-89.png'},
        {id:'sd_10',name:'موخيتو بلوبري',desc:'موخيتو بلوبري',price:45,img:'assets/images/placeholder-90.png'}
      ]}
    ]
  },

  soft: {
    title: 'سوفت درينك / معلبات ومشروبات تلاجة',
    items: [
      {id:'soft_1',name:'V-Cola Soda',desc:'مشروب غازي',price:30,img:'assets/images/placeholder-101.png'},
      {id:'soft_2',name:'V-Cola Cola',desc:'V-Cola الكلاسيكي',price:30,img:'assets/images/placeholder-102.png'},
      {id:'soft_3',name:'V-Cola Diet',desc:'نسخة دايت',price:30,img:'assets/images/placeholder-103.png'},
      {id:'soft_4',name:'ريد بول (Red Bull)',desc:'مشروب طاقة',price:65,img:'assets/images/placeholder-104.png'},
      {id:'soft_5',name:'تويست (Twist)',desc:'مشروب غازي',price:30,img:'assets/images/placeholder-105.png'},
      {id:'soft_6',name:'شويبس (Schweppes)',desc:'مياه غازية',price:28,img:'assets/images/placeholder-106.png'},
      {id:'soft_7',name:'فيروز',desc:'عصير فيروز',price:28,img:'assets/images/placeholder-107.png'},
      {id:'soft_8',name:'جهينه طبيعي مانجو',desc:'جهينه مانجو',price:35,img:'assets/images/placeholder-108.png'},
      {id:'soft_9',name:'جهينه طبيعي تفاح',desc:'جهينه تفاح',price:35,img:'assets/images/placeholder-109.png'},
      {id:'soft_10',name:'جهينه ميكس فراولة لبن',desc:'مزيج فراولة لبن',price:35,img:'assets/images/placeholder-110.png'}
    ]
  },

  dessert: {
    title: 'ديزيرت (حلويات)',
    items: [
      {id:'dess_1',name:'وافل كلاسيك',desc:'وافل تقليدي',price:55,img:'assets/images/placeholder-121.png'},
      {id:'dess_2',name:'وافل نوتيلا',desc:'وافل مع نوتيلا',price:75,img:'assets/images/placeholder-122.png'},
      {id:'dess_3',name:'وافل أوريو',desc:'وافل أوريو',price:70,img:'assets/images/placeholder-123.png'},
      {id:'dess_4',name:'وافل لوتس',desc:'وافل لوتس',price:70,img:'assets/images/placeholder-124.png'},
      {id:'dess_5',name:'وافل بستاشيو',desc:'وافل بستاشيو',price:80,img:'assets/images/placeholder-125.png'},
      {id:'dess_6',name:'وافل فواكه',desc:'وافل مع فواكه',price:85,img:'assets/images/placeholder-126.png'},
      {id:'dess_7',name:'مولتن',desc:'مولتن شوكليت',price:90,img:'assets/images/placeholder-127.png'},
      {id:'dess_8',name:'تشيز كيك',desc:'تشيز كيك ناعم',price:95,img:'assets/images/placeholder-128.png'},
      {id:'dess_9',name:'شوكليت كيك',desc:'كيك شوكليت',price:95,img:'assets/images/placeholder-129.png'}
    ]
  },

  special: {
    title: 'مميز نيو',
    items: [
      {id:'sp_1',name:'بطاطا فواكه ومكسرات وعسل',desc:'طبق فواكه ومكسرات',price:65,img:'assets/images/placeholder-141.png'},
      {id:'sp_2',name:'اندومي بقطع الفراخ بتتبيلة نيو',desc:'اندومي بطبخة نيو',price:55,img:'assets/images/placeholder-142.png'},
      {id:'sp_3',name:'كوكتيل نيو المميز',desc:'فاكهة فاخرة مع سموزي',price:120,img:'assets/images/placeholder-143.png'}
    ]
  },

  fun: {
    title: 'دلع نفسك في نيو — (مجانًا)',
    items: [
      {id:'fun_1',name:'لعبة دومينو',desc:'مجموعة دومينو مجانية',price:0,img:'assets/images/placeholder-151.png'},
      {id:'fun_2',name:'كوتشينة (كوتشينه)',desc:'طقم كوتشينة',price:0,img:'assets/images/placeholder-152.png'},
      {id:'fun_3',name:'شطرنج',desc:'لوحة شطرنج',price:0,img:'assets/images/placeholder-153.png'},
      {id:'fun_4',name:'قول أميم',desc:'لعبة قول أميم',price:0,img:'assets/images/placeholder-154.png'},
      {id:'fun_5',name:'افتح توبيك',desc:'ابدأ موضوع نقاش',price:0,img:'assets/images/placeholder-155.png'}
    ]
  }
};

/* ------------- STORAGE HELPERS ------------- */
function getCart(){
  try{ const d = localStorage.getItem(CART_KEY); return d ? JSON.parse(d) : []; } catch(e){ return []; }
}
function setCart(cart){
  try{ localStorage.setItem(CART_KEY, JSON.stringify(cart)); renderCartCount(true); } catch(e){ console.error(e); }
}
function calcCartTotals(cart){
  let qty=0, total=0;
  (cart||[]).forEach(i=>{ qty += Number(i.qty||0); total += Number(i.qty||0) * Number(i.price||0); });
  return {qty, total};
}

/* ------------- ADD TO CART (single source) ------------- */
function addToCart(id, name, price){
  // central atomic update - increases qty by exactly 1
  const cart = getCart();
  const found = cart.find(x=> x.id === id);
  if(found){
    found.qty = Number(found.qty) + 1;
  } else {
    cart.push({ id, name, price: Number(price||0), qty: 1 });
  }
  setCart(cart);
}

/* ------------- RENDER UI ------------- */
const sectionsEl = document.getElementById('sections');

function createTitle(text){ const d = document.createElement('div'); d.className='section-title'; d.textContent = text; return d; }

function createGrid(items){
  const grid = document.createElement('div'); grid.className='grid';
  items.forEach(it=>{
    const card = document.createElement('div'); card.className='product-card';
    card.innerHTML = `
      <img class="product-img" src="${it.img}" alt="${escapeHtml(it.name)}" onerror="this.src='https://via.placeholder.com/600x400?text=NEO'">
      <div class="product-body">
        <div class="row-title">
          <div class="product-name">${escapeHtml(it.name)}</div>
          <div class="price">${it.price===0?'مجانًا':it.price + ' ج'}</div>
        </div>
        <div class="product-desc">${escapeHtml(it.desc)}</div>
        <div class="product-footer">
          <div></div>
          <button class="add-btn" data-id="${it.id}" data-name="${escapeHtml(it.name)}" data-price="${it.price}">أضف</button>
        </div>
      </div>
    `;
    grid.appendChild(card);
  });
  return grid;
}

/* render all sections */
function renderSections(){
  sectionsEl.innerHTML = '';

  // HOT
  const hot = document.createElement('div'); hot.className='section';
  hot.appendChild(createTitle(MENU.hot.title));
  hot.appendChild(createGrid(MENU.hot.items));
  sectionsEl.appendChild(hot);

  // COLD - we render preview subcat buttons and user can open modal for subcat
  const cold = document.createElement('div'); cold.className='section';
  cold.appendChild(createTitle(MENU.cold.title));
  const preview = document.createElement('div'); preview.style.display='flex'; preview.style.flexWrap='wrap'; preview.style.gap='10px';
  MENU.cold.subcats.forEach(sc=>{
    const btn = document.createElement('div'); btn.className='cat'; btn.textContent = sc.title; btn.dataset.sub = sc.key; preview.appendChild(btn);
  });
  cold.appendChild(preview);
  sectionsEl.appendChild(cold);

  // render other sections
  const soft = document.createElement('div'); soft.className='section';
  soft.appendChild(createTitle(MENU.soft.title));
  soft.appendChild(createGrid(MENU.soft.items));
  sectionsEl.appendChild(soft);

  const dessert = document.createElement('div'); dessert.className='section';
  dessert.appendChild(createTitle(MENU.dessert.title));
  dessert.appendChild(createGrid(MENU.dessert.items));
  sectionsEl.appendChild(dessert);

  const special = document.createElement('div'); special.className='section';
  special.appendChild(createTitle(MENU.special.title));
  special.appendChild(createGrid(MENU.special.items));
  sectionsEl.appendChild(special);

  const fun = document.createElement('div'); fun.className='section';
  fun.appendChild(createTitle(MENU.fun.title));
  fun.appendChild(createGrid(MENU.fun.items));
  sectionsEl.appendChild(fun);
}

/* ------------- MODAL LOGIC (subcat & cart preview) ------------- */
const modalBackdrop = document.getElementById('modalBackdrop');
const modalTitle = document.getElementById('modalTitle');
const modalList  = document.getElementById('modalList');
const closeModal = document.getElementById('closeModal');
const checkoutNow = document.getElementById('checkoutNow');

function openSubcat(key){
  const sc = MENU.cold.subcats.find(s=> s.key === key);
  if(!sc) return;
  modalTitle.textContent = sc.title;
  modalList.innerHTML = '';
  sc.items.forEach(it=>{
    const row = document.createElement('div'); row.className='item';
    row.innerHTML = `
      <div style="flex:1">
        <div style="font-weight:900">${escapeHtml(it.name)}</div>
        <div style="color:var(--muted);font-size:13px">${escapeHtml(it.desc)}</div>
      </div>
      <div style="display:flex;flex-direction:column;align-items:flex-end;gap:8px">
        <div style="font-weight:900;color:var(--neo-green)">${it.price===0?'مجانًا':it.price + ' ج'}</div>
        <button class="add-btn" data-id="${it.id}" data-name="${escapeHtml(it.name)}" data-price="${it.price}">أضف</button>
      </div>`;
    modalList.appendChild(row);
  });
  modalBackdrop.classList.add('show');
  modalBackdrop.setAttribute('aria-hidden','false');
}

closeModal.addEventListener('click', ()=> { modalBackdrop.classList.remove('show'); modalBackdrop.setAttribute('aria-hidden','true'); });
modalBackdrop.addEventListener('click',(e)=>{ if(e.target === modalBackdrop){ modalBackdrop.classList.remove('show'); modalBackdrop.setAttribute('aria-hidden','true'); } });

checkoutNow.addEventListener('click', ()=>{
  // redirect to checkout page (if you have one). If not, we can open checkout.html when you add it.
  window.location.href = 'checkout.html';
});

/* ------------- CLICK DELEGATION with anti-double-add guard ------------- */
/* ensure exactly one listener handles add clicks; guard prevents adding twice per quick double-click */
const __neo_last_clicks = {}; // id -> timestamp
const __NEO_GUARD_MS = 600; // ignore repeated clicks on same product within this ms

document.addEventListener('click', function(e){
  // handle add button
  const addBtn = e.target.closest('.add-btn');
  if(addBtn && addBtn.dataset && addBtn.dataset.id){
    e.preventDefault();
    e.stopPropagation();

    const id = String(addBtn.dataset.id);
    const name = addBtn.dataset.name || (addBtn.closest('.product-card')?.querySelector('.product-name')?.textContent || 'منتج');
    const price = Number(addBtn.dataset.price || 0);

    const now = Date.now();
    if(__neo_last_clicks[id] && (now - __neo_last_clicks[id] < __NEO_GUARD_MS)){
      // ignore quick duplicate
      return;
    }
    __neo_last_clicks[id] = now;
    setTimeout(()=> { __neo_last_clicks[id] = 0; }, __NEO_GUARD_MS + 50);

    // centralized add
    addToCart(id, name, price);
    showToast(`${name} اتضاف للسلة`);
    animateCartPulse();

    return;
  }

  // open subcategory modal
  const subBtn = e.target.closest('.cat[data-sub]');
  if(subBtn && subBtn.dataset.sub){
    e.preventDefault();
    e.stopPropagation();
    openSubcat(subBtn.dataset.sub);
    return;
  }

  // category filter
  const catBtn = e.target.closest('.cat[data-cat]');
  if(catBtn && catBtn.dataset.cat){
    e.preventDefault();
    e.stopPropagation();
    document.querySelectorAll('.cat').forEach(c=>c.classList.remove('active'));
    catBtn.classList.add('active');
    filterCategory(catBtn.dataset.cat);
    return;
  }

  // cart btn click -> open cart preview modal
  const cartBtn = e.target.closest('#cartBtn');
  if(cartBtn){
    e.preventDefault();
    e.stopPropagation();
    openCartPreview();
    return;
  }
});

/* ------------- CART UI ------------- */
function renderCartCount(animate=false){
  const el = document.getElementById('cartCount');
  const cart = getCart();
  const totals = calcCartTotals(cart);
  el.textContent = totals.qty;
  if(animate){
    el.animate([{ transform: 'scale(1)' }, { transform:'scale(1.18)' }, { transform:'scale(1)' }], { duration: 700 });
  }
}

/* pulse animation when item added - grows then back */
let cartPulseTimeout = null;
function animateCartPulse(){
  const btn = document.querySelector('.cart-btn');
  if(!btn) return;
  btn.style.transition = 'transform .18s';
  btn.style.transform = 'scale(1.18)';
  clearTimeout(cartPulseTimeout);
  cartPulseTimeout = setTimeout(()=> { btn.style.transform = 'scale(1)'; }, 2000); // stays bigger then shrink
}

/* ------------- TOAST ------------- */
let toastTimer = null;
function showToast(txt){
  const el = document.getElementById('miniToast');
  el.textContent = txt;
  el.style.opacity = '1';
  clearTimeout(toastTimer);
  toastTimer = setTimeout(()=> { el.style.opacity = '0'; }, 1200);
}

/* ------------- FILTER ------------- */
function filterCategory(cat){
  const sections = document.querySelectorAll('.section');
  sections.forEach(s=> s.style.display = 'none');
  if(cat === 'all'){ sections.forEach(s=> s.style.display = 'block'); window.scrollTo({ top:120, behavior:'smooth' }); return; }
  const map = { hot:0, cold:1, soft:2, dessert:3, special:4, fun:5 };
  const idx = map[cat];
  const secList = document.querySelectorAll('.section');
  if(typeof idx === 'number' && secList[idx]) secList[idx].style.display = 'block';
  window.scrollTo({ top:120, behavior:'smooth' });
}

/* ------------- MODAL: open cart preview ------------- */
function openCartPreview(){
  const cart = getCart();
  modalTitle.textContent = 'السلة';
  modalList.innerHTML = '';
  if(!cart.length){
    modalList.innerHTML = '<div style="padding:12px;color:var(--muted)">السلة فارغة — اذهب للمنيو لإضافة طلبات</div>';
  } else {
    cart.forEach((it, idx)=>{
      const row = document.createElement('div'); row.className='item';
      row.innerHTML = `
        <div style="flex:1">
          <div style="font-weight:900">${escapeHtml(it.name)}</div>
          <div style="color:var(--muted);font-size:13px">${it.price} ج لكل وحدة</div>
        </div>
        <div style="display:flex;flex-direction:column;align-items:flex-end;gap:8px">
          <div style="display:flex;gap:6px;align-items:center">
            <button class="qty-btn" data-action="inc" data-id="${it.id}" style="background:#eee;border-radius:6px;padding:6px 8px;border:0">+</button>
            <div style="min-width:28px;text-align:center;font-weight:900">${it.qty}</div>
            <button class="qty-btn" data-action="dec" data-id="${it.id}" style="background:#eee;border-radius:6px;padding:6px 8px;border:0">-</button>
          </div>
          <button class="remove-btn" data-id="${it.id}" style="background:transparent;border:0;color:#d9534f;font-weight:900">حذف</button>
        </div>
      `;
      modalList.appendChild(row);
    });
    const totals = calcCartTotals(cart);
    const totRow = document.createElement('div');
    totRow.style.padding = '10px 6px';
    totRow.innerHTML = `<div style="font-weight:900;color:var(--neo-green)">الإجمالي: ${totals.total} ج</div>`;
    modalList.appendChild(totRow);
  }
  modalBackdrop.classList.add('show');
  modalBackdrop.setAttribute('aria-hidden','false');
}

/* handle quantity changes / remove from cart within modal */
modalList.addEventListener('click', function(e){
  const btn = e.target.closest('.qty-btn');
  if(btn){
    e.preventDefault(); e.stopPropagation();
    const id = btn.dataset.id;
    const action = btn.dataset.action;
    changeQty(id, action === 'inc' ? 1 : -1);
    openCartPreview(); // re-render
    return;
  }
  const rem = e.target.closest('.remove-btn');
  if(rem){
    e.preventDefault(); e.stopPropagation();
    const id = rem.dataset.id;
    removeFromCart(id);
    openCartPreview();
    return;
  }
});

/* change qty function */
function changeQty(id, delta){
  const cart = getCart();
  const found = cart.find(x=>x.id===id);
  if(!found) return;
  found.qty = Math.max(0, Number(found.qty) + Number(delta));
  // remove if zero
  const newCart = cart.filter(x=> Number(x.qty) > 0);
  setCart(newCart);
}

/* remove */
function removeFromCart(id){
  const cart = getCart().filter(x=> x.id !== id);
  setCart(cart);
}

/* ------------- UTILS ------------- */
function escapeHtml(s){ return String(s||'').replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }

/* ------------- INIT & BINDINGS ------------- */
function init(){
  renderSections();
  renderCartCount(false);

  // close modal
  document.getElementById('closeModal').addEventListener('click',()=>{ modalBackdrop.classList.remove('show'); modalBackdrop.setAttribute('aria-hidden','true'); });
  modalBackdrop.addEventListener('click',(e)=>{ if(e.target === modalBackdrop){ modalBackdrop.classList.remove('show'); modalBackdrop.setAttribute('aria-hidden','true'); } });

  // qty buttons inside modal - handled above by event delegation

  // cart button opens preview
  document.getElementById('cartBtn').addEventListener('click', (e)=>{ e.preventDefault(); openCartPreview(); });

  // important: after render, ensure categories with data-sub have attribute for click handling
  // already set during renderSections

  // small safety: focus top to make mobile open fully
  window.scrollTo(0,0);
}

init();
renderCartCount(false);

/* ------------- renderSections function declared after to ensure MENU used earlier ------------- */
function renderSections(){
  sectionsEl.innerHTML = '';

  // HOT
  const hot = document.createElement('div'); hot.className='section';
  hot.appendChild(createTitle(MENU.hot.title));
  hot.appendChild(createGrid(MENU.hot.items));
  sectionsEl.appendChild(hot);

  // COLD (subcat buttons)
  const cold = document.createElement('div'); cold.className='section';
  cold.appendChild(createTitle(MENU.cold.title));
  const preview = document.createElement('div'); preview.style.display='flex'; preview.style.flexWrap='wrap'; preview.style.gap='10px';
  MENU.cold.subcats.forEach(sc=>{
    const btn = document.createElement('div'); btn.className='cat'; btn.textContent = sc.title; btn.dataset.sub = sc.key; preview.appendChild(btn);
  });
  cold.appendChild(preview);
  sectionsEl.appendChild(cold);

  // SOFT
  const soft = document.createElement('div'); soft.className='section';
  soft.appendChild(createTitle(MENU.soft.title));
  soft.appendChild(createGrid(MENU.soft.items));
  sectionsEl.appendChild(soft);

  // DESSERT
  const dessert = document.createElement('div'); dessert.className='section';
  dessert.appendChild(createTitle(MENU.dessert.title));
  dessert.appendChild(createGrid(MENU.dessert.items));
  sectionsEl.appendChild(dessert);

  // SPECIAL
  const sp = document.createElement('div'); sp.className='section';
  sp.appendChild(createTitle(MENU.special.title));
  sp.appendChild(createGrid(MENU.special.items));
  sectionsEl.appendChild(sp);

  // FUN
  const fun = document.createElement('div'); fun.className='section';
  fun.appendChild(createTitle(MENU.fun.title));
  fun.appendChild(createGrid(MENU.fun.items));
  sectionsEl.appendChild(fun);
}

/* duplicate helper to create grid (needed because of function hoisting) */
function createGrid(items){
  const grid = document.createElement('div'); grid.className='grid';
  items.forEach(it=>{
    const card = document.createElement('div'); card.className='product-card';
    card.innerHTML = `
      <img class="product-img" src="${it.img}" alt="${escapeHtml(it.name)}" onerror="this.src='https://via.placeholder.com/600x400?text=NEO'">
      <div class="product-body">
        <div class="row-title">
          <div class="product-name">${escapeHtml(it.name)}</div>
          <div class="price">${it.price===0?'مجانًا':it.price + ' ج'}</div>
        </div>
        <div class="product-desc">${escapeHtml(it.desc)}</div>
        <div class="product-footer">
          <div></div>
          <button class="add-btn" data-id="${it.id}" data-name="${escapeHtml(it.name)}" data-price="${it.price}">أضف</button>
        </div>
      </div>
    `;
    grid.appendChild(card);
  });
  return grid;
}

/* ensure cart count re-renders when storage changes elsewhere (not likely) */
window.addEventListener('storage', ()=> renderCartCount(false));

/* ensure cartCount shows correct value at start */
renderCartCount(false);
</script>
</body>
</html>
